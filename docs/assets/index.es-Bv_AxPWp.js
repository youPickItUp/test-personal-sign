const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./secp256k1-CYzQuYxp.js","./index-CillhSDD.js","./index-D8b4DHJx.css","./index-C889p4e7.js"])))=>i.map(i=>d[i]);
import{g as wc,a as Xn,k as T0,_ as Fd,c as Ot}from"./index-CillhSDD.js";import{r as N0}from"./events-DQ172AOg.js";const F0={},q0=Object.freeze(Object.defineProperty({__proto__:null,default:F0},Symbol.toStringTag,{value:"Module"})),qd=wc(q0);var gn={exports:{}},ah;function Zn(){return ah||(ah=1,typeof Object.create=="function"?gn.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:gn.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}),gn.exports}var Lt=N0();const _c=Xn(Lt);var oh=function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))},B0=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),L0=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),j0=function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r}(),U0=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),z0=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),k0=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,H0=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ch=3,K0=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",k0]],hh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function V0(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new z0:typeof navigator<"u"?G0(navigator.userAgent):Y0()}function W0(r){return r!==""&&K0.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var n=s.exec(r);return!!n&&[i,n]},!1)}function G0(r){var e=W0(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new U0;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<ch&&(s=oh(oh([],s,!0),X0(ch-s.length),!0)):s=[];var n=s.join("."),a=J0(r),o=H0.exec(r);return o&&o[1]?new j0(t,n,a,o[1]):new B0(t,n,a)}function J0(r){for(var e=0,t=hh.length;e<t;e++){var i=hh[e],s=i[0],n=i[1],a=n.exec(r);if(a)return s}return null}function Y0(){var r=typeof process<"u"&&process.version;return r?new L0(process.version.slice(1)):null}function X0(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var wa={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var To=function(r,e){return To=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},To(r,e)};function Z0(r,e){To(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var No=function(){return No=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},No.apply(this,arguments)};function Q0(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function e1(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function t1(r,e){return function(t,i){e(t,i,r)}}function r1(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function i1(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(f){try{c(i.next(f))}catch(l){a(l)}}function h(f){try{c(i.throw(f))}catch(l){a(l)}}function c(f){f.done?n(f.value):s(f.value).then(o,h)}c((i=i.apply(r,e||[])).next())})}function s1(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(f){return h([c,f])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(f){c=[6,f],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function n1(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function a1(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Fo(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bd(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function o1(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Bd(arguments[e]));return r}function c1(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function Ls(r){return this instanceof Ls?(this.v=r,this):new Ls(r)}function h1(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(v){i[v]&&(s[v]=function(w){return new Promise(function(m,_){n.push([v,w,m,_])>1||o(v,w)})})}function o(v,w){try{h(i[v](w))}catch(m){l(n[0][3],m)}}function h(v){v.value instanceof Ls?Promise.resolve(v.value.v).then(c,f):l(n[0][2],v)}function c(v){o("next",v)}function f(v){o("throw",v)}function l(v,w){v(w),n.shift(),n.length&&o(n[0][0],n[0][1])}}function u1(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:Ls(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function f1(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Fo=="function"?Fo(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(o,h){a=r[n](a),s(o,h,a.done,a.value)})}}function s(n,a,o,h){Promise.resolve(h).then(function(c){n({value:c,done:o})},a)}}function d1(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function l1(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function p1(r){return r&&r.__esModule?r:{default:r}}function b1(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function g1(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const v1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return No},__asyncDelegator:u1,__asyncGenerator:h1,__asyncValues:f1,__await:Ls,__awaiter:i1,__classPrivateFieldGet:b1,__classPrivateFieldSet:g1,__createBinding:n1,__decorate:e1,__exportStar:a1,__extends:Z0,__generator:s1,__importDefault:p1,__importStar:l1,__makeTemplateObject:d1,__metadata:r1,__param:t1,__read:Bd,__rest:Q0,__spread:o1,__spreadArrays:c1,__values:Fo},Symbol.toStringTag,{value:"Module"})),Qn=wc(v1);var _a={},ws={},uh;function y1(){if(uh)return ws;uh=1,Object.defineProperty(ws,"__esModule",{value:!0}),ws.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return ws.delay=r,ws}var Zr={},Ea={},Qr={},fh;function m1(){return fh||(fh=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.ONE_THOUSAND=Qr.ONE_HUNDRED=void 0,Qr.ONE_HUNDRED=100,Qr.ONE_THOUSAND=1e3),Qr}var xa={},dh;function w1(){return dh||(dh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(xa)),xa}var lh;function Ld(){return lh||(lh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Qn;e.__exportStar(m1(),r),e.__exportStar(w1(),r)}(Ea)),Ea}var ph;function _1(){if(ph)return Zr;ph=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.fromMiliseconds=Zr.toMiliseconds=void 0;const r=Ld();function e(i){return i*r.ONE_THOUSAND}Zr.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Zr.fromMiliseconds=t,Zr}var bh;function E1(){return bh||(bh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Qn;e.__exportStar(y1(),r),e.__exportStar(_1(),r)}(_a)),_a}var _i={},gh;function x1(){if(gh)return _i;gh=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return _i.Watch=r,_i.default=r,_i}var Sa={},_s={},vh;function S1(){if(vh)return _s;vh=1,Object.defineProperty(_s,"__esModule",{value:!0}),_s.IWatch=void 0;class r{}return _s.IWatch=r,_s}var yh;function $1(){return yh||(yh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Qn.__exportStar(S1(),r)}(Sa)),Sa}var mh;function I1(){return mh||(mh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Qn;e.__exportStar(E1(),r),e.__exportStar(x1(),r),e.__exportStar($1(),r),e.__exportStar(Ld(),r)}(wa)),wa}var V=I1(),Se={},wh;function jd(){if(wh)return Se;wh=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.getLocalStorage=Se.getLocalStorageOrThrow=Se.getCrypto=Se.getCryptoOrThrow=Se.getLocation=Se.getLocationOrThrow=Se.getNavigator=Se.getNavigatorOrThrow=Se.getDocument=Se.getDocumentOrThrow=Se.getFromWindowOrThrow=Se.getFromWindow=void 0;function r(v){let w;return typeof window<"u"&&typeof window[v]<"u"&&(w=window[v]),w}Se.getFromWindow=r;function e(v){const w=r(v);if(!w)throw new Error(`${v} is not defined in Window`);return w}Se.getFromWindowOrThrow=e;function t(){return e("document")}Se.getDocumentOrThrow=t;function i(){return r("document")}Se.getDocument=i;function s(){return e("navigator")}Se.getNavigatorOrThrow=s;function n(){return r("navigator")}Se.getNavigator=n;function a(){return e("location")}Se.getLocationOrThrow=a;function o(){return r("location")}Se.getLocation=o;function h(){return e("crypto")}Se.getCryptoOrThrow=h;function c(){return r("crypto")}Se.getCrypto=c;function f(){return e("localStorage")}Se.getLocalStorageOrThrow=f;function l(){return r("localStorage")}return Se.getLocalStorage=l,Se}var ci=jd(),Es={},_h;function D1(){if(_h)return Es;_h=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.getWindowMetadata=void 0;const r=jd();function e(){let t,i;try{t=r.getDocumentOrThrow(),i=r.getLocationOrThrow()}catch{return null}function s(){const w=t.getElementsByTagName("link"),m=[];for(let _=0;_<w.length;_++){const O=w[_],D=O.getAttribute("rel");if(D&&D.toLowerCase().indexOf("icon")>-1){const A=O.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let M=i.protocol+"//"+i.host;if(A.indexOf("/")===0)M+=A;else{const R=i.pathname.split("/");R.pop();const T=R.join("/");M+=T+"/"+A}m.push(M)}else if(A.indexOf("//")===0){const M=i.protocol+A;m.push(M)}else m.push(A)}}return m}function n(...w){const m=t.getElementsByTagName("meta");for(let _=0;_<m.length;_++){const O=m[_],D=["itemprop","property","name"].map(A=>O.getAttribute(A)).filter(A=>A?w.includes(A):!1);if(D.length&&D){const A=O.getAttribute("content");if(A)return A}}return""}function a(){let w=n("name","og:site_name","og:title","twitter:title");return w||(w=t.title),w}function o(){return n("description","og:description","twitter:description","keywords")}const h=a(),c=o(),f=i.origin,l=s();return{description:c,url:f,icons:l,name:h}}return Es.getWindowMetadata=e,Es}var A1=D1();function js(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function Eh(r){return js(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const Ud="2.23.2";let xs={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${Ud}`};class hi extends Error{constructor(e,t={}){var o;const i=(()=>{var h;return t.cause instanceof hi?t.cause.details:(h=t.cause)!=null&&h.message?t.cause.message:t.details})(),s=t.cause instanceof hi&&t.cause.docsPath||t.docsPath,n=(o=xs.getDocsUrl)==null?void 0:o.call(xs,{...t,docsPath:s}),a=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...xs.version?[`Version: ${xs.version}`]:[]].join(`
`);super(a,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=Ud}walk(e){return zd(this,e)}}function zd(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?zd(r.cause,e):e?null:r}class kd extends hi{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Yi(r,{dir:e,size:t=32}={}){return typeof r=="string"?P1(r,{dir:e,size:t}):O1(r,{dir:e,size:t})}function P1(r,{dir:e,size:t=32}={}){if(t===null)return r;const i=r.replace("0x","");if(i.length>t*2)throw new kd({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function O1(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new kd({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";i[n?s:t-s-1]=r[n?s:r.length-s-1]}return i}class M1 extends hi{constructor({max:e,min:t,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class C1 extends hi{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Xi(r,{size:e}){if(Eh(r)>e)throw new C1({givenSize:Eh(r),maxSize:e})}function qo(r,e={}){const{signed:t}=e;e.size&&Xi(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function R1(r,e={}){return Number(qo(r,e))}const T1=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Bo(r,e={}){return typeof r=="number"||typeof r=="bigint"?Kd(r,e):typeof r=="string"?q1(r,e):typeof r=="boolean"?N1(r,e):Hd(r,e)}function N1(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(Xi(t,{size:e.size}),Yi(t,{size:e.size})):t}function Hd(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=T1[r[s]];const i=`0x${t}`;return typeof e.size=="number"?(Xi(i,{size:e.size}),Yi(i,{dir:"right",size:e.size})):i}function Kd(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let n;i?t?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const a=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<a){const h=typeof r=="bigint"?"n":"";throw new M1({max:n?`${n}${h}`:void 0,min:`${a}${h}`,signed:t,size:i,value:`${r}${h}`})}const o=`0x${(t&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Yi(o,{size:i}):o}const F1=new TextEncoder;function q1(r,e={}){const t=F1.encode(r);return Hd(t,e)}const B1=new TextEncoder;function L1(r,e={}){return typeof r=="number"||typeof r=="bigint"?U1(r,e):typeof r=="boolean"?j1(r,e):js(r)?Vd(r,e):Wd(r,e)}function j1(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(Xi(t,{size:e.size}),Yi(t,{size:e.size})):t}const xr={zero:48,nine:57,A:65,F:70,a:97,f:102};function xh(r){if(r>=xr.zero&&r<=xr.nine)return r-xr.zero;if(r>=xr.A&&r<=xr.F)return r-(xr.A-10);if(r>=xr.a&&r<=xr.f)return r-(xr.a-10)}function Vd(r,e={}){let t=r;e.size&&(Xi(t,{size:e.size}),t=Yi(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let a=0,o=0;a<s;a++){const h=xh(i.charCodeAt(o++)),c=xh(i.charCodeAt(o++));if(h===void 0||c===void 0)throw new hi(`Invalid byte sequence ("${i[o-2]}${i[o-1]}" in "${i}").`);n[a]=h*16+c}return n}function U1(r,e){const t=Kd(r,e);return Vd(t)}function Wd(r,e={}){const t=B1.encode(r);return typeof e.size=="number"?(Xi(t,{size:e.size}),Yi(t,{dir:"right",size:e.size})):t}function Gd(r,e){const t=e||"hex",i=T0(js(r,{strict:!1})?L1(r):r);return t==="bytes"?i:Bo(i)}class z1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const $a=new z1(8192);function k1(r,e){if($a.has(`${r}.${e}`))return $a.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),i=Gd(Wd(t),"bytes"),s=t.split("");for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&s[a]&&(s[a]=s[a].toUpperCase()),(i[a>>1]&15)>=8&&s[a+1]&&(s[a+1]=s[a+1].toUpperCase());const n=`0x${s.join("")}`;return $a.set(`${r}.${e}`,n),n}function H1(r){const e=Gd(`0x${r.substring(4)}`).substring(26);return k1(`0x${e}`)}async function K1({hash:r,signature:e}){const t=js(r)?r:Bo(r),{secp256k1:i}=await Fd(async()=>{const{secp256k1:a}=await import("./secp256k1-CYzQuYxp.js");return{secp256k1:a}},__vite__mapDeps([0,1,2]),import.meta.url);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:c,s:f,v:l,yParity:v}=e,w=Number(v??l),m=Sh(w);return new i.Signature(qo(c),qo(f)).addRecoveryBit(m)}const a=js(e)?e:Bo(e),o=R1(`0x${a.slice(130)}`),h=Sh(o);return i.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(h)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Sh(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function V1({hash:r,signature:e}){return H1(await K1({hash:r,signature:e}))}const W1=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),G1=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ui(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return G1(r)}catch{return r}}function Cr(r){return typeof r=="string"?r:W1(r)||""}function J1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Jd(r,...e){if(!J1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function $h(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Y1(r,e){Jd(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Ei=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ia=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function X1(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Yd(r){return typeof r=="string"&&(r=X1(r)),Jd(r),r}let Z1=class{clone(){return this._cloneInto()}};function Q1(r){const e=i=>r().update(Yd(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Xd(r=32){if(Ei&&typeof Ei.getRandomValues=="function")return Ei.getRandomValues(new Uint8Array(r));if(Ei&&typeof Ei.randomBytes=="function")return Ei.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function eb(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n),h=i?4:0,c=i?0:4;r.setUint32(e+h,a,i),r.setUint32(e+c,o,i)}let tb=class extends Z1{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ia(this.buffer)}update(e){$h(this);const{view:t,buffer:i,blockLen:s}=this;e=Yd(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const h=Ia(e);for(;s<=n-a;a+=s)this.process(h,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$h(this),Y1(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)t[l]=0;eb(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=Ia(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=h/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,f[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%t&&e.buffer.set(i),e}};const vn=BigInt(2**32-1),Lo=BigInt(32);function Zd(r,e=!1){return e?{h:Number(r&vn),l:Number(r>>Lo&vn)}:{h:Number(r>>Lo&vn)|0,l:Number(r&vn)|0}}function rb(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:a}=Zd(r[s],e);[t[s],i[s]]=[n,a]}return[t,i]}const ib=(r,e)=>BigInt(r>>>0)<<Lo|BigInt(e>>>0),sb=(r,e,t)=>r>>>t,nb=(r,e,t)=>r<<32-t|e>>>t,ab=(r,e,t)=>r>>>t|e<<32-t,ob=(r,e,t)=>r<<32-t|e>>>t,cb=(r,e,t)=>r<<64-t|e>>>t-32,hb=(r,e,t)=>r>>>t-32|e<<64-t,ub=(r,e)=>e,fb=(r,e)=>r,db=(r,e,t)=>r<<t|e>>>32-t,lb=(r,e,t)=>e<<t|r>>>32-t,pb=(r,e,t)=>e<<t-32|r>>>64-t,bb=(r,e,t)=>r<<t-32|e>>>64-t;function gb(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const vb=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),yb=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,mb=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),wb=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,_b=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),Eb=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,te={fromBig:Zd,split:rb,toBig:ib,shrSH:sb,shrSL:nb,rotrSH:ab,rotrSL:ob,rotrBH:cb,rotrBL:hb,rotr32H:ub,rotr32L:fb,rotlSH:db,rotlSL:lb,rotlBH:pb,rotlBL:bb,add:gb,add3L:vb,add3H:yb,add4L:mb,add4H:wb,add5H:Eb,add5L:_b},[xb,Sb]=te.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Br=new Uint32Array(80),Lr=new Uint32Array(80);let $b=class extends tb{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:a,Dh:o,Dl:h,Eh:c,El:f,Fh:l,Fl:v,Gh:w,Gl:m,Hh:_,Hl:O}=this;return[e,t,i,s,n,a,o,h,c,f,l,v,w,m,_,O]}set(e,t,i,s,n,a,o,h,c,f,l,v,w,m,_,O){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=a|0,this.Dh=o|0,this.Dl=h|0,this.Eh=c|0,this.El=f|0,this.Fh=l|0,this.Fl=v|0,this.Gh=w|0,this.Gl=m|0,this.Hh=_|0,this.Hl=O|0}process(e,t){for(let M=0;M<16;M++,t+=4)Br[M]=e.getUint32(t),Lr[M]=e.getUint32(t+=4);for(let M=16;M<80;M++){const R=Br[M-15]|0,T=Lr[M-15]|0,C=te.rotrSH(R,T,1)^te.rotrSH(R,T,8)^te.shrSH(R,T,7),q=te.rotrSL(R,T,1)^te.rotrSL(R,T,8)^te.shrSL(R,T,7),B=Br[M-2]|0,N=Lr[M-2]|0,k=te.rotrSH(B,N,19)^te.rotrBH(B,N,61)^te.shrSH(B,N,6),I=te.rotrSL(B,N,19)^te.rotrBL(B,N,61)^te.shrSL(B,N,6),u=te.add4L(q,I,Lr[M-7],Lr[M-16]),p=te.add4H(u,C,k,Br[M-7],Br[M-16]);Br[M]=p|0,Lr[M]=u|0}let{Ah:i,Al:s,Bh:n,Bl:a,Ch:o,Cl:h,Dh:c,Dl:f,Eh:l,El:v,Fh:w,Fl:m,Gh:_,Gl:O,Hh:D,Hl:A}=this;for(let M=0;M<80;M++){const R=te.rotrSH(l,v,14)^te.rotrSH(l,v,18)^te.rotrBH(l,v,41),T=te.rotrSL(l,v,14)^te.rotrSL(l,v,18)^te.rotrBL(l,v,41),C=l&w^~l&_,q=v&m^~v&O,B=te.add5L(A,T,q,Sb[M],Lr[M]),N=te.add5H(B,D,R,C,xb[M],Br[M]),k=B|0,I=te.rotrSH(i,s,28)^te.rotrBH(i,s,34)^te.rotrBH(i,s,39),u=te.rotrSL(i,s,28)^te.rotrBL(i,s,34)^te.rotrBL(i,s,39),p=i&n^i&o^n&o,y=s&a^s&h^a&h;D=_|0,A=O|0,_=w|0,O=m|0,w=l|0,m=v|0,{h:l,l:v}=te.add(c|0,f|0,N|0,k|0),c=o|0,f=h|0,o=n|0,h=a|0,n=i|0,a=s|0;const b=te.add3L(k,u,y);i=te.add3H(b,N,I,p),s=b|0}({h:i,l:s}=te.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:a}=te.add(this.Bh|0,this.Bl|0,n|0,a|0),{h:o,l:h}=te.add(this.Ch|0,this.Cl|0,o|0,h|0),{h:c,l:f}=te.add(this.Dh|0,this.Dl|0,c|0,f|0),{h:l,l:v}=te.add(this.Eh|0,this.El|0,l|0,v|0),{h:w,l:m}=te.add(this.Fh|0,this.Fl|0,w|0,m|0),{h:_,l:O}=te.add(this.Gh|0,this.Gl|0,_|0,O|0),{h:D,l:A}=te.add(this.Hh|0,this.Hl|0,D|0,A|0),this.set(i,s,n,a,o,h,c,f,l,v,w,m,_,O,D,A)}roundClean(){Br.fill(0),Lr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Ib=Q1(()=>new $b);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ec=BigInt(0),Qd=BigInt(1),Db=BigInt(2);function xc(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Sc(r){if(!xc(r))throw new Error("Uint8Array expected")}function Da(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const Ab=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function $c(r){Sc(r);let e="";for(let t=0;t<r.length;t++)e+=Ab[r[t]];return e}function el(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Ec:BigInt("0x"+r)}const Sr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ih(r){if(r>=Sr._0&&r<=Sr._9)return r-Sr._0;if(r>=Sr.A&&r<=Sr.F)return r-(Sr.A-10);if(r>=Sr.a&&r<=Sr.f)return r-(Sr.a-10)}function tl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const a=Ih(r.charCodeAt(n)),o=Ih(r.charCodeAt(n+1));if(a===void 0||o===void 0){const h=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+h+'" at index '+n)}i[s]=a*16+o}return i}function Pb(r){return el($c(r))}function Rn(r){return Sc(r),el($c(Uint8Array.from(r).reverse()))}function rl(r,e){return tl(r.toString(16).padStart(e*2,"0"))}function jo(r,e){return rl(r,e).reverse()}function $r(r,e,t){let i;if(typeof e=="string")try{i=tl(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(xc(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Dh(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Sc(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}const Aa=r=>typeof r=="bigint"&&Ec<=r;function Ob(r,e,t){return Aa(r)&&Aa(e)&&Aa(t)&&e<=r&&r<t}function Ss(r,e,t,i){if(!Ob(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Mb(r){let e;for(e=0;r>Ec;r>>=Qd,e+=1);return e}const Cb=r=>(Db<<BigInt(r-1))-Qd,Rb={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||xc(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Ic(r,e,t={}){const i=(s,n,a)=>{const o=Rb[n];if(typeof o!="function")throw new Error("invalid validator function");const h=r[s];if(!(a&&h===void 0)&&!o(h,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+h)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}function Ah(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const ft=BigInt(0),tt=BigInt(1),si=BigInt(2),Tb=BigInt(3),Uo=BigInt(4),Ph=BigInt(5),Oh=BigInt(8);function st(r,e){const t=r%e;return t>=ft?t:e+t}function Nb(r,e,t){if(e<ft)throw new Error("invalid exponent, negatives unsupported");if(t<=ft)throw new Error("invalid modulus");if(t===tt)return ft;let i=tt;for(;e>ft;)e&tt&&(i=i*r%t),r=r*r%t,e>>=tt;return i}function ur(r,e,t){let i=r;for(;e-- >ft;)i*=i,i%=t;return i}function Mh(r,e){if(r===ft)throw new Error("invert: expected non-zero number");if(e<=ft)throw new Error("invert: expected positive modulus, got "+e);let t=st(r,e),i=e,s=ft,n=tt;for(;t!==ft;){const a=i/t,o=i%t,h=s-n*a;i=t,t=o,s=n,n=h}if(i!==tt)throw new Error("invert: does not exist");return st(s,e)}function Fb(r){const e=(r-tt)/si;let t,i,s;for(t=r-tt,i=0;t%si===ft;t/=si,i++);for(s=si;s<r&&Nb(s,e,r)!==r-tt;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const a=(r+tt)/Uo;return function(o,h){const c=o.pow(h,a);if(!o.eql(o.sqr(c),h))throw new Error("Cannot find square root");return c}}const n=(t+tt)/si;return function(a,o){if(a.pow(o,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let h=i,c=a.pow(a.mul(a.ONE,s),t),f=a.pow(o,n),l=a.pow(o,t);for(;!a.eql(l,a.ONE);){if(a.eql(l,a.ZERO))return a.ZERO;let v=1;for(let m=a.sqr(l);v<h&&!a.eql(m,a.ONE);v++)m=a.sqr(m);const w=a.pow(c,tt<<BigInt(h-v-1));c=a.sqr(w),f=a.mul(f,w),l=a.mul(l,c),h=v}return f}}function qb(r){if(r%Uo===Tb){const e=(r+tt)/Uo;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Oh===Ph){const e=(r-Ph)/Oh;return function(t,i){const s=t.mul(i,si),n=t.pow(s,e),a=t.mul(i,n),o=t.mul(t.mul(a,si),n),h=t.mul(a,t.sub(o,t.ONE));if(!t.eql(t.sqr(h),i))throw new Error("Cannot find square root");return h}}return Fb(r)}const Bb=(r,e)=>(st(r,e)&tt)===tt,Lb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jb(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Lb.reduce((i,s)=>(i[s]="function",i),e);return Ic(r,t)}function Ub(r,e,t){if(t<ft)throw new Error("invalid exponent, negatives unsupported");if(t===ft)return r.ONE;if(t===tt)return e;let i=r.ONE,s=e;for(;t>ft;)t&tt&&(i=r.mul(i,s)),s=r.sqr(s),t>>=tt;return i}function zb(r,e){const t=new Array(e.length),i=e.reduce((n,a,o)=>r.is0(a)?n:(t[o]=n,r.mul(n,a)),r.ONE),s=r.inv(i);return e.reduceRight((n,a,o)=>r.is0(a)?n:(t[o]=r.mul(n,t[o]),r.mul(n,a)),s),t}function il(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function sl(r,e,t=!1,i={}){if(r<=ft)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=il(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const o=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:Cb(s),ZERO:ft,ONE:tt,create:h=>st(h,r),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return ft<=h&&h<r},is0:h=>h===ft,isOdd:h=>(h&tt)===tt,neg:h=>st(-h,r),eql:(h,c)=>h===c,sqr:h=>st(h*h,r),add:(h,c)=>st(h+c,r),sub:(h,c)=>st(h-c,r),mul:(h,c)=>st(h*c,r),pow:(h,c)=>Ub(o,h,c),div:(h,c)=>st(h*Mh(c,r),r),sqrN:h=>h*h,addN:(h,c)=>h+c,subN:(h,c)=>h-c,mulN:(h,c)=>h*c,inv:h=>Mh(h,r),sqrt:i.sqrt||(h=>(a||(a=qb(r)),a(o,h))),invertBatch:h=>zb(o,h),cmov:(h,c,f)=>f?c:h,toBytes:h=>t?jo(h,n):rl(h,n),fromBytes:h=>{if(h.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+h.length);return t?Rn(h):Pb(h)}});return Object.freeze(o)}const Ch=BigInt(0),yn=BigInt(1);function Pa(r,e){const t=e.negate();return r?t:e}function nl(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Oa(r,e){nl(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function kb(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function Hb(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const Ma=new WeakMap,al=new WeakMap;function Ca(r){return al.get(r)||1}function Kb(r,e){return{constTimeNegate:Pa,hasPrecomputes(t){return Ca(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>Ch;)i&yn&&(s=s.add(n)),n=n.double(),i>>=yn;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=Oa(i,e),a=[];let o=t,h=o;for(let c=0;c<s;c++){h=o,a.push(h);for(let f=1;f<n;f++)h=h.add(o),a.push(h);o=h.double()}return a},wNAF(t,i,s){const{windows:n,windowSize:a}=Oa(t,e);let o=r.ZERO,h=r.BASE;const c=BigInt(2**t-1),f=2**t,l=BigInt(t);for(let v=0;v<n;v++){const w=v*a;let m=Number(s&c);s>>=l,m>a&&(m-=f,s+=yn);const _=w,O=w+Math.abs(m)-1,D=v%2!==0,A=m<0;m===0?h=h.add(Pa(D,i[_])):o=o.add(Pa(A,i[O]))}return{p:o,f:h}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:a,windowSize:o}=Oa(t,e),h=BigInt(2**t-1),c=2**t,f=BigInt(t);for(let l=0;l<a;l++){const v=l*o;if(s===Ch)break;let w=Number(s&h);if(s>>=f,w>o&&(w-=c,s+=yn),w===0)continue;let m=i[v+Math.abs(w)-1];w<0&&(m=m.negate()),n=n.add(m)}return n},getPrecomputes(t,i,s){let n=Ma.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&Ma.set(i,s(n))),n},wNAFCached(t,i,s){const n=Ca(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const a=Ca(t);return a===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),i,n)},setWindowSize(t,i){nl(i,e),al.set(t,i),Ma.delete(t)}}}function Vb(r,e,t,i){if(kb(t,r),Hb(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=Mb(BigInt(t.length)),a=n>12?n-3:n>4?n-2:n?2:1,o=(1<<a)-1,h=new Array(o+1).fill(s),c=Math.floor((e.BITS-1)/a)*a;let f=s;for(let l=c;l>=0;l-=a){h.fill(s);for(let w=0;w<i.length;w++){const m=i[w],_=Number(m>>BigInt(l)&BigInt(o));h[_]=h[_].add(t[w])}let v=s;for(let w=h.length-1,m=s;w>0;w--)m=m.add(h[w]),v=v.add(m);if(f=f.add(v),l!==0)for(let w=0;w<a;w++)f=f.double()}return f}function Wb(r){return jb(r.Fp),Ic(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...il(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const Qt=BigInt(0),$t=BigInt(1),mn=BigInt(2),Gb=BigInt(8),Jb={zip215:!0};function Yb(r){const e=Wb(r);return Ic(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Xb(r){const e=Yb(r),{Fp:t,n:i,prehash:s,hash:n,randomBytes:a,nByteLength:o,h}=e,c=mn<<BigInt(o*8)-$t,f=t.create,l=sl(e.n,e.nBitLength),v=e.uvRatio||((b,g)=>{try{return{isValid:!0,value:t.sqrt(b*t.inv(g))}}catch{return{isValid:!1,value:Qt}}}),w=e.adjustScalarBytes||(b=>b),m=e.domain||((b,g,x)=>{if(Da("phflag",x),g.length||x)throw new Error("Contexts/pre-hash are not supported");return b});function _(b,g){Ss("coordinate "+b,g,Qt,c)}function O(b){if(!(b instanceof M))throw new Error("ExtendedPoint expected")}const D=Ah((b,g)=>{const{ex:x,ey:$,ez:E}=b,d=b.is0();g==null&&(g=d?Gb:t.inv(E));const S=f(x*g),L=f($*g),j=f(E*g);if(d)return{x:Qt,y:$t};if(j!==$t)throw new Error("invZ was invalid");return{x:S,y:L}}),A=Ah(b=>{const{a:g,d:x}=e;if(b.is0())throw new Error("bad point: ZERO");const{ex:$,ey:E,ez:d,et:S}=b,L=f($*$),j=f(E*E),U=f(d*d),z=f(U*U),G=f(L*g),X=f(U*f(G+j)),Z=f(z+f(x*f(L*j)));if(X!==Z)throw new Error("bad point: equation left != right (1)");const Y=f($*E),Q=f(d*S);if(Y!==Q)throw new Error("bad point: equation left != right (2)");return!0});class M{constructor(g,x,$,E){this.ex=g,this.ey=x,this.ez=$,this.et=E,_("x",g),_("y",x),_("z",$),_("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(g){if(g instanceof M)throw new Error("extended point not allowed");const{x,y:$}=g||{};return _("x",x),_("y",$),new M(x,$,$t,f(x*$))}static normalizeZ(g){const x=t.invertBatch(g.map($=>$.ez));return g.map(($,E)=>$.toAffine(x[E])).map(M.fromAffine)}static msm(g,x){return Vb(M,l,g,x)}_setWindowSize(g){C.setWindowSize(this,g)}assertValidity(){A(this)}equals(g){O(g);const{ex:x,ey:$,ez:E}=this,{ex:d,ey:S,ez:L}=g,j=f(x*L),U=f(d*E),z=f($*L),G=f(S*E);return j===U&&z===G}is0(){return this.equals(M.ZERO)}negate(){return new M(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){const{a:g}=e,{ex:x,ey:$,ez:E}=this,d=f(x*x),S=f($*$),L=f(mn*f(E*E)),j=f(g*d),U=x+$,z=f(f(U*U)-d-S),G=j+S,X=G-L,Z=j-S,Y=f(z*X),Q=f(G*Z),Qe=f(z*Z),re=f(X*G);return new M(Y,Q,re,Qe)}add(g){O(g);const{a:x,d:$}=e,{ex:E,ey:d,ez:S,et:L}=this,{ex:j,ey:U,ez:z,et:G}=g;if(x===BigInt(-1)){const ye=f((d-E)*(U+j)),ar=f((d+E)*(U-j)),ge=f(ar-ye);if(ge===Qt)return this.double();const me=f(S*mn*G),or=f(L*mn*z),de=or+me,le=ar+ye,cr=or-me,pe=f(de*ge),$e=f(le*cr),Gr=f(de*cr),ae=f(ge*le);return new M(pe,$e,ae,Gr)}const X=f(E*j),Z=f(d*U),Y=f(L*$*G),Q=f(S*z),Qe=f((E+d)*(j+U)-X-Z),re=Q-Y,ie=Q+Y,nt=f(Z-x*X),oe=f(Qe*re),fe=f(ie*nt),jt=f(Qe*nt),xe=f(re*ie);return new M(oe,fe,xe,jt)}subtract(g){return this.add(g.negate())}wNAF(g){return C.wNAFCached(this,g,M.normalizeZ)}multiply(g){const x=g;Ss("scalar",x,$t,i);const{p:$,f:E}=this.wNAF(x);return M.normalizeZ([$,E])[0]}multiplyUnsafe(g,x=M.ZERO){const $=g;return Ss("scalar",$,Qt,i),$===Qt?T:this.is0()||$===$t?this:C.wNAFCachedUnsafe(this,$,M.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(h).is0()}isTorsionFree(){return C.unsafeLadder(this,i).is0()}toAffine(g){return D(this,g)}clearCofactor(){const{h:g}=e;return g===$t?this:this.multiplyUnsafe(g)}static fromHex(g,x=!1){const{d:$,a:E}=e,d=t.BYTES;g=$r("pointHex",g,d),Da("zip215",x);const S=g.slice(),L=g[d-1];S[d-1]=L&-129;const j=Rn(S),U=x?c:t.ORDER;Ss("pointHex.y",j,Qt,U);const z=f(j*j),G=f(z-$t),X=f($*z-E);let{isValid:Z,value:Y}=v(G,X);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const Q=(Y&$t)===$t,Qe=(L&128)!==0;if(!x&&Y===Qt&&Qe)throw new Error("Point.fromHex: x=0 and x_0=1");return Qe!==Q&&(Y=f(-Y)),M.fromAffine({x:Y,y:j})}static fromPrivateKey(g){return N(g).point}toRawBytes(){const{x:g,y:x}=this.toAffine(),$=jo(x,t.BYTES);return $[$.length-1]|=g&$t?128:0,$}toHex(){return $c(this.toRawBytes())}}M.BASE=new M(e.Gx,e.Gy,$t,f(e.Gx*e.Gy)),M.ZERO=new M(Qt,$t,$t,Qt);const{BASE:R,ZERO:T}=M,C=Kb(M,o*8);function q(b){return st(b,i)}function B(b){return q(Rn(b))}function N(b){const g=t.BYTES;b=$r("private key",b,g);const x=$r("hashed private key",n(b),2*g),$=w(x.slice(0,g)),E=x.slice(g,2*g),d=B($),S=R.multiply(d),L=S.toRawBytes();return{head:$,prefix:E,scalar:d,point:S,pointBytes:L}}function k(b){return N(b).pointBytes}function I(b=new Uint8Array,...g){const x=Dh(...g);return B(n(m(x,$r("context",b),!!s)))}function u(b,g,x={}){b=$r("message",b),s&&(b=s(b));const{prefix:$,scalar:E,pointBytes:d}=N(g),S=I(x.context,$,b),L=R.multiply(S).toRawBytes(),j=I(x.context,L,d,b),U=q(S+j*E);Ss("signature.s",U,Qt,i);const z=Dh(L,jo(U,t.BYTES));return $r("result",z,t.BYTES*2)}const p=Jb;function y(b,g,x,$=p){const{context:E,zip215:d}=$,S=t.BYTES;b=$r("signature",b,2*S),g=$r("message",g),x=$r("publicKey",x,S),d!==void 0&&Da("zip215",d),s&&(g=s(g));const L=Rn(b.slice(S,2*S));let j,U,z;try{j=M.fromHex(x,d),U=M.fromHex(b.slice(0,S),d),z=R.multiplyUnsafe(L)}catch{return!1}if(!d&&j.isSmallOrder())return!1;const G=I(E,U.toRawBytes(),j.toRawBytes(),g);return U.add(j.multiplyUnsafe(G)).subtract(z).clearCofactor().equals(M.ZERO)}return R._setWindowSize(8),{CURVE:e,getPublicKey:k,sign:u,verify:y,ExtendedPoint:M,utils:{getExtendedPublicKey:N,randomPrivateKey:()=>a(t.BYTES),precompute(b=8,g=M.BASE){return g._setWindowSize(b),g.multiply(BigInt(3)),g}}}}BigInt(0),BigInt(1);const Dc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Rh=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Zb=BigInt(1),Th=BigInt(2);BigInt(3);const Qb=BigInt(5),eg=BigInt(8);function tg(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Dc,a=r*r%n*r%n,o=ur(a,Th,n)*a%n,h=ur(o,Zb,n)*r%n,c=ur(h,Qb,n)*h%n,f=ur(c,e,n)*c%n,l=ur(f,t,n)*f%n,v=ur(l,i,n)*l%n,w=ur(v,s,n)*v%n,m=ur(w,s,n)*v%n,_=ur(m,e,n)*c%n;return{pow_p_5_8:ur(_,Th,n)*r%n,b2:a}}function rg(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function ig(r,e){const t=Dc,i=st(e*e*e,t),s=st(i*i*e,t),n=tg(r*s).pow_p_5_8;let a=st(r*i*n,t);const o=st(e*a*a,t),h=a,c=st(a*Rh,t),f=o===r,l=o===st(-r,t),v=o===st(-r*Rh,t);return f&&(a=h),(l||v)&&(a=c),Bb(a,t)&&(a=st(-a,t)),{isValid:f||l,value:a}}const sg=sl(Dc,void 0,!0),ng={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:sg,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:eg,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Ib,randomBytes:Xd,adjustScalarBytes:rg,uvRatio:ig},ol=Xb(ng),ag="EdDSA",og="JWT",Un=".",ea="base64url",cl="utf8",hl="utf8",cg=":",hg="did",ug="key",Nh="base58btc",fg="z",dg="K36",lg=32;function Ac(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function ul(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ac(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function fl(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=ul(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return Ac(t)}function pg(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,h=r.charAt(0),c=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var _=0,O=0,D=0,A=m.length;D!==A&&m[D]===0;)D++,_++;for(var M=(A-D)*f+1>>>0,R=new Uint8Array(M);D!==A;){for(var T=m[D],C=0,q=M-1;(T!==0||C<O)&&q!==-1;q--,C++)T+=256*R[q]>>>0,R[q]=T%o>>>0,T=T/o>>>0;if(T!==0)throw new Error("Non-zero carry");O=C,D++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var N=h.repeat(_);B<M;++B)N+=r.charAt(R[B]);return N}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var _=0;if(m[_]!==" "){for(var O=0,D=0;m[_]===h;)O++,_++;for(var A=(m.length-_)*c+1>>>0,M=new Uint8Array(A);m[_];){var R=t[m.charCodeAt(_)];if(R===255)return;for(var T=0,C=A-1;(R!==0||T<D)&&C!==-1;C--,T++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");D=T,_++}if(m[_]!==" "){for(var q=A-D;q!==A&&M[q]===0;)q++;for(var B=new Uint8Array(O+(A-q)),N=O;q!==A;)B[N++]=M[q++];return B}}}function w(m){var _=v(m);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:w}}var bg=pg,gg=bg;const dl=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},vg=r=>new TextEncoder().encode(r),yg=r=>new TextDecoder().decode(r);let mg=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},wg=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ll(this,e)}},_g=class{constructor(e){this.decoders=e}or(e){return ll(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ll=(r,e)=>new _g({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Eg=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new mg(e,t,i),this.decoder=new wg(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ta=({name:r,prefix:e,encode:t,decode:i})=>new Eg(r,e,t,i),Vs=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=gg(t,e);return ta({prefix:r,name:e,encode:i,decode:n=>dl(s(n))})},xg=(r,e,t,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,c=0;for(let f=0;f<n;++f){const l=s[r[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return a},Sg=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},gt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ta({prefix:e,name:r,encode(s){return Sg(s,i,t)},decode(s){return xg(s,i,t,r)}}),$g=ta({prefix:"\0",name:"identity",encode:r=>yg(r),decode:r=>vg(r)});var Ig=Object.freeze({__proto__:null,identity:$g});const Dg=gt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ag=Object.freeze({__proto__:null,base2:Dg});const Pg=gt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Og=Object.freeze({__proto__:null,base8:Pg});const Mg=Vs({prefix:"9",name:"base10",alphabet:"0123456789"});var Cg=Object.freeze({__proto__:null,base10:Mg});const Rg=gt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Tg=gt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ng=Object.freeze({__proto__:null,base16:Rg,base16upper:Tg});const Fg=gt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qg=gt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bg=gt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Lg=gt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jg=gt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ug=gt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),zg=gt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kg=gt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Hg=gt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Kg=Object.freeze({__proto__:null,base32:Fg,base32upper:qg,base32pad:Bg,base32padupper:Lg,base32hex:jg,base32hexupper:Ug,base32hexpad:zg,base32hexpadupper:kg,base32z:Hg});const Vg=Vs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wg=Vs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Gg=Object.freeze({__proto__:null,base36:Vg,base36upper:Wg});const Jg=Vs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Yg=Vs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xg=Object.freeze({__proto__:null,base58btc:Jg,base58flickr:Yg});const Zg=gt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qg=gt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ev=gt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),tv=gt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var rv=Object.freeze({__proto__:null,base64:Zg,base64pad:Qg,base64url:ev,base64urlpad:tv});const pl=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),iv=pl.reduce((r,e,t)=>(r[t]=e,r),[]),sv=pl.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function nv(r){return r.reduce((e,t)=>(e+=iv[t],e),"")}function av(r){const e=[];for(const t of r){const i=sv[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ov=ta({prefix:"🚀",name:"base256emoji",encode:nv,decode:av});var cv=Object.freeze({__proto__:null,base256emoji:ov}),hv=bl,Fh=128,uv=-128,fv=Math.pow(2,31);function bl(r,e,t){e=e||[],t=t||0;for(var i=t;r>=fv;)e[t++]=r&255|Fh,r/=128;for(;r&uv;)e[t++]=r&255|Fh,r>>>=7;return e[t]=r|0,bl.bytes=t-i+1,e}var dv=zo,lv=128,qh=127;function zo(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw zo.bytes=0,new RangeError("Could not decode varint");a=r[n++],t+=s<28?(a&qh)<<s:(a&qh)*Math.pow(2,s),s+=7}while(a>=lv);return zo.bytes=n-i,t}var pv=Math.pow(2,7),bv=Math.pow(2,14),gv=Math.pow(2,21),vv=Math.pow(2,28),yv=Math.pow(2,35),mv=Math.pow(2,42),wv=Math.pow(2,49),_v=Math.pow(2,56),Ev=Math.pow(2,63),xv=function(r){return r<pv?1:r<bv?2:r<gv?3:r<vv?4:r<yv?5:r<mv?6:r<wv?7:r<_v?8:r<Ev?9:10},Sv={encode:hv,decode:dv,encodingLength:xv},gl=Sv;const Bh=(r,e,t=0)=>(gl.encode(r,e,t),e),Lh=r=>gl.encodingLength(r),ko=(r,e)=>{const t=e.byteLength,i=Lh(r),s=i+Lh(t),n=new Uint8Array(s+t);return Bh(r,n,0),Bh(t,n,i),n.set(e,s),new $v(r,t,e,n)};let $v=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const vl=({name:r,code:e,encode:t})=>new Iv(r,e,t);let Iv=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ko(this.code,t):t.then(i=>ko(this.code,i))}else throw Error("Unknown type, must be binary type")}};const yl=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Dv=vl({name:"sha2-256",code:18,encode:yl("SHA-256")}),Av=vl({name:"sha2-512",code:19,encode:yl("SHA-512")});var Pv=Object.freeze({__proto__:null,sha256:Dv,sha512:Av});const ml=0,Ov="identity",wl=dl,Mv=r=>ko(ml,wl(r)),Cv={code:ml,name:Ov,encode:wl,digest:Mv};var Rv=Object.freeze({__proto__:null,identity:Cv});new TextEncoder,new TextDecoder;const jh={...Ig,...Ag,...Og,...Cg,...Ng,...Kg,...Gg,...Xg,...rv,...cv};({...Pv,...Rv});function _l(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Uh=_l("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Ra=_l("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=ul(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),El={utf8:Uh,"utf-8":Uh,hex:jh.base16,latin1:Ra,ascii:Ra,binary:Ra,...jh};function ra(r,e="utf8"){const t=El[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Zi(r,e="utf8"){const t=El[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ac(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function zh(r){return ui(ra(Zi(r,ea),cl))}function zn(r){return ra(Zi(Cr(r),cl),ea)}function xl(r){const e=Zi(dg,Nh),t=fg+ra(fl([e,r]),Nh);return[hg,ug,t].join(cg)}function Tv(r){return ra(r,ea)}function Nv(r){return Zi(r,ea)}function Fv(r){return Zi([zn(r.header),zn(r.payload)].join(Un),hl)}function qv(r){return[zn(r.header),zn(r.payload),Tv(r.signature)].join(Un)}function Ho(r){const e=r.split(Un),t=zh(e[0]),i=zh(e[1]),s=Nv(e[2]),n=Zi(e.slice(0,2).join(Un),hl);return{header:t,payload:i,signature:s,data:n}}function kh(r=Xd(lg)){const e=ol.getPublicKey(r);return{secretKey:fl([r,e]),publicKey:e}}async function Bv(r,e,t,i,s=V.fromMiliseconds(Date.now())){const n={alg:ag,typ:og},a=xl(i.publicKey),o=s+t,h={iss:a,sub:r,aud:e,iat:s,exp:o},c=Fv({header:n,payload:h}),f=ol.sign(c,i.secretKey.slice(0,32));return qv({header:n,payload:h,signature:f})}function Sl(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Ta(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Sl(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}function Lv(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,h=r.charAt(0),c=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var _=0,O=0,D=0,A=m.length;D!==A&&m[D]===0;)D++,_++;for(var M=(A-D)*f+1>>>0,R=new Uint8Array(M);D!==A;){for(var T=m[D],C=0,q=M-1;(T!==0||C<O)&&q!==-1;q--,C++)T+=256*R[q]>>>0,R[q]=T%o>>>0,T=T/o>>>0;if(T!==0)throw new Error("Non-zero carry");O=C,D++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var N=h.repeat(_);B<M;++B)N+=r.charAt(R[B]);return N}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var _=0;if(m[_]!==" "){for(var O=0,D=0;m[_]===h;)O++,_++;for(var A=(m.length-_)*c+1>>>0,M=new Uint8Array(A);m[_];){var R=t[m.charCodeAt(_)];if(R===255)return;for(var T=0,C=A-1;(R!==0||T<D)&&C!==-1;C--,T++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");D=T,_++}if(m[_]!==" "){for(var q=A-D;q!==A&&M[q]===0;)q++;for(var B=new Uint8Array(O+(A-q)),N=O;q!==A;)B[N++]=M[q++];return B}}}function w(m){var _=v(m);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:w}}var jv=Lv,Uv=jv;const zv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},kv=r=>new TextEncoder().encode(r),Hv=r=>new TextDecoder().decode(r);class Kv{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Vv{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $l(this,e)}}class Wv{constructor(e){this.decoders=e}or(e){return $l(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $l=(r,e)=>new Wv({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Gv{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Kv(e,t,i),this.decoder=new Vv(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ia=({name:r,prefix:e,encode:t,decode:i})=>new Gv(r,e,t,i),Ws=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Uv(t,e);return ia({prefix:r,name:e,encode:i,decode:n=>zv(s(n))})},Jv=(r,e,t,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,c=0;for(let f=0;f<n;++f){const l=s[r[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return a},Yv=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},vt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ia({prefix:e,name:r,encode(s){return Yv(s,i,t)},decode(s){return Jv(s,i,t,r)}}),Xv=ia({prefix:"\0",name:"identity",encode:r=>Hv(r),decode:r=>kv(r)}),Zv=Object.freeze(Object.defineProperty({__proto__:null,identity:Xv},Symbol.toStringTag,{value:"Module"})),Qv=vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ey=Object.freeze(Object.defineProperty({__proto__:null,base2:Qv},Symbol.toStringTag,{value:"Module"})),ty=vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ry=Object.freeze(Object.defineProperty({__proto__:null,base8:ty},Symbol.toStringTag,{value:"Module"})),iy=Ws({prefix:"9",name:"base10",alphabet:"0123456789"}),sy=Object.freeze(Object.defineProperty({__proto__:null,base10:iy},Symbol.toStringTag,{value:"Module"})),ny=vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ay=vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),oy=Object.freeze(Object.defineProperty({__proto__:null,base16:ny,base16upper:ay},Symbol.toStringTag,{value:"Module"})),cy=vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hy=vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),uy=vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),fy=vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dy=vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ly=vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),py=vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),by=vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gy=vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vy=Object.freeze(Object.defineProperty({__proto__:null,base32:cy,base32hex:dy,base32hexpad:py,base32hexpadupper:by,base32hexupper:ly,base32pad:uy,base32padupper:fy,base32upper:hy,base32z:gy},Symbol.toStringTag,{value:"Module"})),yy=Ws({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),my=Ws({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),wy=Object.freeze(Object.defineProperty({__proto__:null,base36:yy,base36upper:my},Symbol.toStringTag,{value:"Module"})),_y=Ws({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ey=Ws({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),xy=Object.freeze(Object.defineProperty({__proto__:null,base58btc:_y,base58flickr:Ey},Symbol.toStringTag,{value:"Module"})),Sy=vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),$y=vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Iy=vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Dy=vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ay=Object.freeze(Object.defineProperty({__proto__:null,base64:Sy,base64pad:$y,base64url:Iy,base64urlpad:Dy},Symbol.toStringTag,{value:"Module"})),Il=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Py=Il.reduce((r,e,t)=>(r[t]=e,r),[]),Oy=Il.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function My(r){return r.reduce((e,t)=>(e+=Py[t],e),"")}function Cy(r){const e=[];for(const t of r){const i=Oy[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Ry=ia({prefix:"🚀",name:"base256emoji",encode:My,decode:Cy}),Ty=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Ry},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Hh={...Zv,...ey,...ry,...sy,...oy,...vy,...wy,...xy,...Ay,...Ty};function Dl(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Kh=Dl("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Na=Dl("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Sl(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Al={utf8:Kh,"utf-8":Kh,hex:Hh.base16,latin1:Na,ascii:Na,binary:Na,...Hh};function Wt(r,e="utf8"){const t=Al[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function xt(r,e="utf8"){const t=Al[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Fa={};const Ny="6.6.1",Fy={version:Ny};var qa={},Tn={exports:{}},qy=Tn.exports,Vh;function Rr(){return Vh||(Vh=1,function(r){(function(e,t){function i(I,u){if(!I)throw new Error(u||"Assertion failed")}function s(I,u){I.super_=u;var p=function(){};p.prototype=u.prototype,I.prototype=new p,I.prototype.constructor=I}function n(I,u,p){if(n.isBN(I))return I;this.negative=0,this.words=null,this.length=0,this.red=null,I!==null&&((u==="le"||u==="be")&&(p=u,u=10),this._init(I||0,u||10,p||"be"))}typeof e=="object"?e.exports=n:t.BN=n,n.BN=n,n.wordSize=26;var a;try{typeof window<"u"&&typeof window.Buffer<"u"?a=window.Buffer:a=qd.Buffer}catch{}n.isBN=function(u){return u instanceof n?!0:u!==null&&typeof u=="object"&&u.constructor.wordSize===n.wordSize&&Array.isArray(u.words)},n.max=function(u,p){return u.cmp(p)>0?u:p},n.min=function(u,p){return u.cmp(p)<0?u:p},n.prototype._init=function(u,p,y){if(typeof u=="number")return this._initNumber(u,p,y);if(typeof u=="object")return this._initArray(u,p,y);p==="hex"&&(p=16),i(p===(p|0)&&p>=2&&p<=36),u=u.toString().replace(/\s+/g,"");var b=0;u[0]==="-"&&(b++,this.negative=1),b<u.length&&(p===16?this._parseHex(u,b,y):(this._parseBase(u,p,b),y==="le"&&this._initArray(this.toArray(),p,y)))},n.prototype._initNumber=function(u,p,y){u<0&&(this.negative=1,u=-u),u<67108864?(this.words=[u&67108863],this.length=1):u<4503599627370496?(this.words=[u&67108863,u/67108864&67108863],this.length=2):(i(u<9007199254740992),this.words=[u&67108863,u/67108864&67108863,1],this.length=3),y==="le"&&this._initArray(this.toArray(),p,y)},n.prototype._initArray=function(u,p,y){if(i(typeof u.length=="number"),u.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(u.length/3),this.words=new Array(this.length);for(var b=0;b<this.length;b++)this.words[b]=0;var g,x,$=0;if(y==="be")for(b=u.length-1,g=0;b>=0;b-=3)x=u[b]|u[b-1]<<8|u[b-2]<<16,this.words[g]|=x<<$&67108863,this.words[g+1]=x>>>26-$&67108863,$+=24,$>=26&&($-=26,g++);else if(y==="le")for(b=0,g=0;b<u.length;b+=3)x=u[b]|u[b+1]<<8|u[b+2]<<16,this.words[g]|=x<<$&67108863,this.words[g+1]=x>>>26-$&67108863,$+=24,$>=26&&($-=26,g++);return this.strip()};function o(I,u){var p=I.charCodeAt(u);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function h(I,u,p){var y=o(I,p);return p-1>=u&&(y|=o(I,p-1)<<4),y}n.prototype._parseHex=function(u,p,y){this.length=Math.ceil((u.length-p)/6),this.words=new Array(this.length);for(var b=0;b<this.length;b++)this.words[b]=0;var g=0,x=0,$;if(y==="be")for(b=u.length-1;b>=p;b-=2)$=h(u,p,b)<<g,this.words[x]|=$&67108863,g>=18?(g-=18,x+=1,this.words[x]|=$>>>26):g+=8;else{var E=u.length-p;for(b=E%2===0?p+1:p;b<u.length;b+=2)$=h(u,p,b)<<g,this.words[x]|=$&67108863,g>=18?(g-=18,x+=1,this.words[x]|=$>>>26):g+=8}this.strip()};function c(I,u,p,y){for(var b=0,g=Math.min(I.length,p),x=u;x<g;x++){var $=I.charCodeAt(x)-48;b*=y,$>=49?b+=$-49+10:$>=17?b+=$-17+10:b+=$}return b}n.prototype._parseBase=function(u,p,y){this.words=[0],this.length=1;for(var b=0,g=1;g<=67108863;g*=p)b++;b--,g=g/p|0;for(var x=u.length-y,$=x%b,E=Math.min(x,x-$)+y,d=0,S=y;S<E;S+=b)d=c(u,S,S+b,p),this.imuln(g),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if($!==0){var L=1;for(d=c(u,S,u.length,p),S=0;S<$;S++)L*=p;this.imuln(L),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this.strip()},n.prototype.copy=function(u){u.words=new Array(this.length);for(var p=0;p<this.length;p++)u.words[p]=this.words[p];u.length=this.length,u.negative=this.negative,u.red=this.red},n.prototype.clone=function(){var u=new n(null);return this.copy(u),u},n.prototype._expand=function(u){for(;this.length<u;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},n.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],v=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];n.prototype.toString=function(u,p){u=u||10,p=p|0||1;var y;if(u===16||u==="hex"){y="";for(var b=0,g=0,x=0;x<this.length;x++){var $=this.words[x],E=(($<<b|g)&16777215).toString(16);g=$>>>24-b&16777215,b+=2,b>=26&&(b-=26,x--),g!==0||x!==this.length-1?y=f[6-E.length]+E+y:y=E+y}for(g!==0&&(y=g.toString(16)+y);y.length%p!==0;)y="0"+y;return this.negative!==0&&(y="-"+y),y}if(u===(u|0)&&u>=2&&u<=36){var d=l[u],S=v[u];y="";var L=this.clone();for(L.negative=0;!L.isZero();){var j=L.modn(S).toString(u);L=L.idivn(S),L.isZero()?y=j+y:y=f[d-j.length]+j+y}for(this.isZero()&&(y="0"+y);y.length%p!==0;)y="0"+y;return this.negative!==0&&(y="-"+y),y}i(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var u=this.words[0];return this.length===2?u+=this.words[1]*67108864:this.length===3&&this.words[2]===1?u+=4503599627370496+this.words[1]*67108864:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-u:u},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(u,p){return i(typeof a<"u"),this.toArrayLike(a,u,p)},n.prototype.toArray=function(u,p){return this.toArrayLike(Array,u,p)},n.prototype.toArrayLike=function(u,p,y){var b=this.byteLength(),g=y||Math.max(1,b);i(b<=g,"byte array longer than desired length"),i(g>0,"Requested array length <= 0"),this.strip();var x=p==="le",$=new u(g),E,d,S=this.clone();if(x){for(d=0;!S.isZero();d++)E=S.andln(255),S.iushrn(8),$[d]=E;for(;d<g;d++)$[d]=0}else{for(d=0;d<g-b;d++)$[d]=0;for(d=0;!S.isZero();d++)E=S.andln(255),S.iushrn(8),$[g-d-1]=E}return $},Math.clz32?n.prototype._countBits=function(u){return 32-Math.clz32(u)}:n.prototype._countBits=function(u){var p=u,y=0;return p>=4096&&(y+=13,p>>>=13),p>=64&&(y+=7,p>>>=7),p>=8&&(y+=4,p>>>=4),p>=2&&(y+=2,p>>>=2),y+p},n.prototype._zeroBits=function(u){if(u===0)return 26;var p=u,y=0;return(p&8191)===0&&(y+=13,p>>>=13),(p&127)===0&&(y+=7,p>>>=7),(p&15)===0&&(y+=4,p>>>=4),(p&3)===0&&(y+=2,p>>>=2),(p&1)===0&&y++,y},n.prototype.bitLength=function(){var u=this.words[this.length-1],p=this._countBits(u);return(this.length-1)*26+p};function w(I){for(var u=new Array(I.bitLength()),p=0;p<u.length;p++){var y=p/26|0,b=p%26;u[p]=(I.words[y]&1<<b)>>>b}return u}n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var u=0,p=0;p<this.length;p++){var y=this._zeroBits(this.words[p]);if(u+=y,y!==26)break}return u},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(u){return this.negative!==0?this.abs().inotn(u).iaddn(1):this.clone()},n.prototype.fromTwos=function(u){return this.testn(u-1)?this.notn(u).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return this.negative!==0},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(u){for(;this.length<u.length;)this.words[this.length++]=0;for(var p=0;p<u.length;p++)this.words[p]=this.words[p]|u.words[p];return this.strip()},n.prototype.ior=function(u){return i((this.negative|u.negative)===0),this.iuor(u)},n.prototype.or=function(u){return this.length>u.length?this.clone().ior(u):u.clone().ior(this)},n.prototype.uor=function(u){return this.length>u.length?this.clone().iuor(u):u.clone().iuor(this)},n.prototype.iuand=function(u){var p;this.length>u.length?p=u:p=this;for(var y=0;y<p.length;y++)this.words[y]=this.words[y]&u.words[y];return this.length=p.length,this.strip()},n.prototype.iand=function(u){return i((this.negative|u.negative)===0),this.iuand(u)},n.prototype.and=function(u){return this.length>u.length?this.clone().iand(u):u.clone().iand(this)},n.prototype.uand=function(u){return this.length>u.length?this.clone().iuand(u):u.clone().iuand(this)},n.prototype.iuxor=function(u){var p,y;this.length>u.length?(p=this,y=u):(p=u,y=this);for(var b=0;b<y.length;b++)this.words[b]=p.words[b]^y.words[b];if(this!==p)for(;b<p.length;b++)this.words[b]=p.words[b];return this.length=p.length,this.strip()},n.prototype.ixor=function(u){return i((this.negative|u.negative)===0),this.iuxor(u)},n.prototype.xor=function(u){return this.length>u.length?this.clone().ixor(u):u.clone().ixor(this)},n.prototype.uxor=function(u){return this.length>u.length?this.clone().iuxor(u):u.clone().iuxor(this)},n.prototype.inotn=function(u){i(typeof u=="number"&&u>=0);var p=Math.ceil(u/26)|0,y=u%26;this._expand(p),y>0&&p--;for(var b=0;b<p;b++)this.words[b]=~this.words[b]&67108863;return y>0&&(this.words[b]=~this.words[b]&67108863>>26-y),this.strip()},n.prototype.notn=function(u){return this.clone().inotn(u)},n.prototype.setn=function(u,p){i(typeof u=="number"&&u>=0);var y=u/26|0,b=u%26;return this._expand(y+1),p?this.words[y]=this.words[y]|1<<b:this.words[y]=this.words[y]&~(1<<b),this.strip()},n.prototype.iadd=function(u){var p;if(this.negative!==0&&u.negative===0)return this.negative=0,p=this.isub(u),this.negative^=1,this._normSign();if(this.negative===0&&u.negative!==0)return u.negative=0,p=this.isub(u),u.negative=1,p._normSign();var y,b;this.length>u.length?(y=this,b=u):(y=u,b=this);for(var g=0,x=0;x<b.length;x++)p=(y.words[x]|0)+(b.words[x]|0)+g,this.words[x]=p&67108863,g=p>>>26;for(;g!==0&&x<y.length;x++)p=(y.words[x]|0)+g,this.words[x]=p&67108863,g=p>>>26;if(this.length=y.length,g!==0)this.words[this.length]=g,this.length++;else if(y!==this)for(;x<y.length;x++)this.words[x]=y.words[x];return this},n.prototype.add=function(u){var p;return u.negative!==0&&this.negative===0?(u.negative=0,p=this.sub(u),u.negative^=1,p):u.negative===0&&this.negative!==0?(this.negative=0,p=u.sub(this),this.negative=1,p):this.length>u.length?this.clone().iadd(u):u.clone().iadd(this)},n.prototype.isub=function(u){if(u.negative!==0){u.negative=0;var p=this.iadd(u);return u.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(u),this.negative=1,this._normSign();var y=this.cmp(u);if(y===0)return this.negative=0,this.length=1,this.words[0]=0,this;var b,g;y>0?(b=this,g=u):(b=u,g=this);for(var x=0,$=0;$<g.length;$++)p=(b.words[$]|0)-(g.words[$]|0)+x,x=p>>26,this.words[$]=p&67108863;for(;x!==0&&$<b.length;$++)p=(b.words[$]|0)+x,x=p>>26,this.words[$]=p&67108863;if(x===0&&$<b.length&&b!==this)for(;$<b.length;$++)this.words[$]=b.words[$];return this.length=Math.max(this.length,$),b!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(u){return this.clone().isub(u)};function m(I,u,p){p.negative=u.negative^I.negative;var y=I.length+u.length|0;p.length=y,y=y-1|0;var b=I.words[0]|0,g=u.words[0]|0,x=b*g,$=x&67108863,E=x/67108864|0;p.words[0]=$;for(var d=1;d<y;d++){for(var S=E>>>26,L=E&67108863,j=Math.min(d,u.length-1),U=Math.max(0,d-I.length+1);U<=j;U++){var z=d-U|0;b=I.words[z]|0,g=u.words[U]|0,x=b*g+L,S+=x/67108864|0,L=x&67108863}p.words[d]=L|0,E=S|0}return E!==0?p.words[d]=E|0:p.length--,p.strip()}var _=function(u,p,y){var b=u.words,g=p.words,x=y.words,$=0,E,d,S,L=b[0]|0,j=L&8191,U=L>>>13,z=b[1]|0,G=z&8191,X=z>>>13,Z=b[2]|0,Y=Z&8191,Q=Z>>>13,Qe=b[3]|0,re=Qe&8191,ie=Qe>>>13,nt=b[4]|0,oe=nt&8191,fe=nt>>>13,jt=b[5]|0,xe=jt&8191,ye=jt>>>13,ar=b[6]|0,ge=ar&8191,me=ar>>>13,or=b[7]|0,de=or&8191,le=or>>>13,cr=b[8]|0,pe=cr&8191,$e=cr>>>13,Gr=b[9]|0,ae=Gr&8191,Ne=Gr>>>13,rs=g[0]|0,ke=rs&8191,Fe=rs>>>13,Jr=g[1]|0,qe=Jr&8191,Be=Jr>>>13,an=g[2]|0,we=an&8191,Le=an>>>13,on=g[3]|0,He=on&8191,Me=on>>>13,Tr=g[4]|0,Ce=Tr&8191,Re=Tr>>>13,mi=g[5]|0,Ie=mi&8191,Ke=mi>>>13,cn=g[6]|0,Ve=cn&8191,We=cn>>>13,hn=g[7]|0,je=hn&8191,Te=hn>>>13,hr=g[8]|0,Ge=hr&8191,Je=hr>>>13,un=g[9]|0,Ye=un&8191,Xe=un>>>13;y.negative=u.negative^p.negative,y.length=19,E=Math.imul(j,ke),d=Math.imul(j,Fe),d=d+Math.imul(U,ke)|0,S=Math.imul(U,Fe);var Ct=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,E=Math.imul(G,ke),d=Math.imul(G,Fe),d=d+Math.imul(X,ke)|0,S=Math.imul(X,Fe),E=E+Math.imul(j,qe)|0,d=d+Math.imul(j,Be)|0,d=d+Math.imul(U,qe)|0,S=S+Math.imul(U,Be)|0;var is=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(is>>>26)|0,is&=67108863,E=Math.imul(Y,ke),d=Math.imul(Y,Fe),d=d+Math.imul(Q,ke)|0,S=Math.imul(Q,Fe),E=E+Math.imul(G,qe)|0,d=d+Math.imul(G,Be)|0,d=d+Math.imul(X,qe)|0,S=S+Math.imul(X,Be)|0,E=E+Math.imul(j,we)|0,d=d+Math.imul(j,Le)|0,d=d+Math.imul(U,we)|0,S=S+Math.imul(U,Le)|0;var ss=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(ss>>>26)|0,ss&=67108863,E=Math.imul(re,ke),d=Math.imul(re,Fe),d=d+Math.imul(ie,ke)|0,S=Math.imul(ie,Fe),E=E+Math.imul(Y,qe)|0,d=d+Math.imul(Y,Be)|0,d=d+Math.imul(Q,qe)|0,S=S+Math.imul(Q,Be)|0,E=E+Math.imul(G,we)|0,d=d+Math.imul(G,Le)|0,d=d+Math.imul(X,we)|0,S=S+Math.imul(X,Le)|0,E=E+Math.imul(j,He)|0,d=d+Math.imul(j,Me)|0,d=d+Math.imul(U,He)|0,S=S+Math.imul(U,Me)|0;var ns=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(ns>>>26)|0,ns&=67108863,E=Math.imul(oe,ke),d=Math.imul(oe,Fe),d=d+Math.imul(fe,ke)|0,S=Math.imul(fe,Fe),E=E+Math.imul(re,qe)|0,d=d+Math.imul(re,Be)|0,d=d+Math.imul(ie,qe)|0,S=S+Math.imul(ie,Be)|0,E=E+Math.imul(Y,we)|0,d=d+Math.imul(Y,Le)|0,d=d+Math.imul(Q,we)|0,S=S+Math.imul(Q,Le)|0,E=E+Math.imul(G,He)|0,d=d+Math.imul(G,Me)|0,d=d+Math.imul(X,He)|0,S=S+Math.imul(X,Me)|0,E=E+Math.imul(j,Ce)|0,d=d+Math.imul(j,Re)|0,d=d+Math.imul(U,Ce)|0,S=S+Math.imul(U,Re)|0;var as=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(as>>>26)|0,as&=67108863,E=Math.imul(xe,ke),d=Math.imul(xe,Fe),d=d+Math.imul(ye,ke)|0,S=Math.imul(ye,Fe),E=E+Math.imul(oe,qe)|0,d=d+Math.imul(oe,Be)|0,d=d+Math.imul(fe,qe)|0,S=S+Math.imul(fe,Be)|0,E=E+Math.imul(re,we)|0,d=d+Math.imul(re,Le)|0,d=d+Math.imul(ie,we)|0,S=S+Math.imul(ie,Le)|0,E=E+Math.imul(Y,He)|0,d=d+Math.imul(Y,Me)|0,d=d+Math.imul(Q,He)|0,S=S+Math.imul(Q,Me)|0,E=E+Math.imul(G,Ce)|0,d=d+Math.imul(G,Re)|0,d=d+Math.imul(X,Ce)|0,S=S+Math.imul(X,Re)|0,E=E+Math.imul(j,Ie)|0,d=d+Math.imul(j,Ke)|0,d=d+Math.imul(U,Ie)|0,S=S+Math.imul(U,Ke)|0;var os=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(os>>>26)|0,os&=67108863,E=Math.imul(ge,ke),d=Math.imul(ge,Fe),d=d+Math.imul(me,ke)|0,S=Math.imul(me,Fe),E=E+Math.imul(xe,qe)|0,d=d+Math.imul(xe,Be)|0,d=d+Math.imul(ye,qe)|0,S=S+Math.imul(ye,Be)|0,E=E+Math.imul(oe,we)|0,d=d+Math.imul(oe,Le)|0,d=d+Math.imul(fe,we)|0,S=S+Math.imul(fe,Le)|0,E=E+Math.imul(re,He)|0,d=d+Math.imul(re,Me)|0,d=d+Math.imul(ie,He)|0,S=S+Math.imul(ie,Me)|0,E=E+Math.imul(Y,Ce)|0,d=d+Math.imul(Y,Re)|0,d=d+Math.imul(Q,Ce)|0,S=S+Math.imul(Q,Re)|0,E=E+Math.imul(G,Ie)|0,d=d+Math.imul(G,Ke)|0,d=d+Math.imul(X,Ie)|0,S=S+Math.imul(X,Ke)|0,E=E+Math.imul(j,Ve)|0,d=d+Math.imul(j,We)|0,d=d+Math.imul(U,Ve)|0,S=S+Math.imul(U,We)|0;var Xt=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,E=Math.imul(de,ke),d=Math.imul(de,Fe),d=d+Math.imul(le,ke)|0,S=Math.imul(le,Fe),E=E+Math.imul(ge,qe)|0,d=d+Math.imul(ge,Be)|0,d=d+Math.imul(me,qe)|0,S=S+Math.imul(me,Be)|0,E=E+Math.imul(xe,we)|0,d=d+Math.imul(xe,Le)|0,d=d+Math.imul(ye,we)|0,S=S+Math.imul(ye,Le)|0,E=E+Math.imul(oe,He)|0,d=d+Math.imul(oe,Me)|0,d=d+Math.imul(fe,He)|0,S=S+Math.imul(fe,Me)|0,E=E+Math.imul(re,Ce)|0,d=d+Math.imul(re,Re)|0,d=d+Math.imul(ie,Ce)|0,S=S+Math.imul(ie,Re)|0,E=E+Math.imul(Y,Ie)|0,d=d+Math.imul(Y,Ke)|0,d=d+Math.imul(Q,Ie)|0,S=S+Math.imul(Q,Ke)|0,E=E+Math.imul(G,Ve)|0,d=d+Math.imul(G,We)|0,d=d+Math.imul(X,Ve)|0,S=S+Math.imul(X,We)|0,E=E+Math.imul(j,je)|0,d=d+Math.imul(j,Te)|0,d=d+Math.imul(U,je)|0,S=S+Math.imul(U,Te)|0;var cs=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(cs>>>26)|0,cs&=67108863,E=Math.imul(pe,ke),d=Math.imul(pe,Fe),d=d+Math.imul($e,ke)|0,S=Math.imul($e,Fe),E=E+Math.imul(de,qe)|0,d=d+Math.imul(de,Be)|0,d=d+Math.imul(le,qe)|0,S=S+Math.imul(le,Be)|0,E=E+Math.imul(ge,we)|0,d=d+Math.imul(ge,Le)|0,d=d+Math.imul(me,we)|0,S=S+Math.imul(me,Le)|0,E=E+Math.imul(xe,He)|0,d=d+Math.imul(xe,Me)|0,d=d+Math.imul(ye,He)|0,S=S+Math.imul(ye,Me)|0,E=E+Math.imul(oe,Ce)|0,d=d+Math.imul(oe,Re)|0,d=d+Math.imul(fe,Ce)|0,S=S+Math.imul(fe,Re)|0,E=E+Math.imul(re,Ie)|0,d=d+Math.imul(re,Ke)|0,d=d+Math.imul(ie,Ie)|0,S=S+Math.imul(ie,Ke)|0,E=E+Math.imul(Y,Ve)|0,d=d+Math.imul(Y,We)|0,d=d+Math.imul(Q,Ve)|0,S=S+Math.imul(Q,We)|0,E=E+Math.imul(G,je)|0,d=d+Math.imul(G,Te)|0,d=d+Math.imul(X,je)|0,S=S+Math.imul(X,Te)|0,E=E+Math.imul(j,Ge)|0,d=d+Math.imul(j,Je)|0,d=d+Math.imul(U,Ge)|0,S=S+Math.imul(U,Je)|0;var hs=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(hs>>>26)|0,hs&=67108863,E=Math.imul(ae,ke),d=Math.imul(ae,Fe),d=d+Math.imul(Ne,ke)|0,S=Math.imul(Ne,Fe),E=E+Math.imul(pe,qe)|0,d=d+Math.imul(pe,Be)|0,d=d+Math.imul($e,qe)|0,S=S+Math.imul($e,Be)|0,E=E+Math.imul(de,we)|0,d=d+Math.imul(de,Le)|0,d=d+Math.imul(le,we)|0,S=S+Math.imul(le,Le)|0,E=E+Math.imul(ge,He)|0,d=d+Math.imul(ge,Me)|0,d=d+Math.imul(me,He)|0,S=S+Math.imul(me,Me)|0,E=E+Math.imul(xe,Ce)|0,d=d+Math.imul(xe,Re)|0,d=d+Math.imul(ye,Ce)|0,S=S+Math.imul(ye,Re)|0,E=E+Math.imul(oe,Ie)|0,d=d+Math.imul(oe,Ke)|0,d=d+Math.imul(fe,Ie)|0,S=S+Math.imul(fe,Ke)|0,E=E+Math.imul(re,Ve)|0,d=d+Math.imul(re,We)|0,d=d+Math.imul(ie,Ve)|0,S=S+Math.imul(ie,We)|0,E=E+Math.imul(Y,je)|0,d=d+Math.imul(Y,Te)|0,d=d+Math.imul(Q,je)|0,S=S+Math.imul(Q,Te)|0,E=E+Math.imul(G,Ge)|0,d=d+Math.imul(G,Je)|0,d=d+Math.imul(X,Ge)|0,S=S+Math.imul(X,Je)|0,E=E+Math.imul(j,Ye)|0,d=d+Math.imul(j,Xe)|0,d=d+Math.imul(U,Ye)|0,S=S+Math.imul(U,Xe)|0;var us=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(us>>>26)|0,us&=67108863,E=Math.imul(ae,qe),d=Math.imul(ae,Be),d=d+Math.imul(Ne,qe)|0,S=Math.imul(Ne,Be),E=E+Math.imul(pe,we)|0,d=d+Math.imul(pe,Le)|0,d=d+Math.imul($e,we)|0,S=S+Math.imul($e,Le)|0,E=E+Math.imul(de,He)|0,d=d+Math.imul(de,Me)|0,d=d+Math.imul(le,He)|0,S=S+Math.imul(le,Me)|0,E=E+Math.imul(ge,Ce)|0,d=d+Math.imul(ge,Re)|0,d=d+Math.imul(me,Ce)|0,S=S+Math.imul(me,Re)|0,E=E+Math.imul(xe,Ie)|0,d=d+Math.imul(xe,Ke)|0,d=d+Math.imul(ye,Ie)|0,S=S+Math.imul(ye,Ke)|0,E=E+Math.imul(oe,Ve)|0,d=d+Math.imul(oe,We)|0,d=d+Math.imul(fe,Ve)|0,S=S+Math.imul(fe,We)|0,E=E+Math.imul(re,je)|0,d=d+Math.imul(re,Te)|0,d=d+Math.imul(ie,je)|0,S=S+Math.imul(ie,Te)|0,E=E+Math.imul(Y,Ge)|0,d=d+Math.imul(Y,Je)|0,d=d+Math.imul(Q,Ge)|0,S=S+Math.imul(Q,Je)|0,E=E+Math.imul(G,Ye)|0,d=d+Math.imul(G,Xe)|0,d=d+Math.imul(X,Ye)|0,S=S+Math.imul(X,Xe)|0;var fs=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(fs>>>26)|0,fs&=67108863,E=Math.imul(ae,we),d=Math.imul(ae,Le),d=d+Math.imul(Ne,we)|0,S=Math.imul(Ne,Le),E=E+Math.imul(pe,He)|0,d=d+Math.imul(pe,Me)|0,d=d+Math.imul($e,He)|0,S=S+Math.imul($e,Me)|0,E=E+Math.imul(de,Ce)|0,d=d+Math.imul(de,Re)|0,d=d+Math.imul(le,Ce)|0,S=S+Math.imul(le,Re)|0,E=E+Math.imul(ge,Ie)|0,d=d+Math.imul(ge,Ke)|0,d=d+Math.imul(me,Ie)|0,S=S+Math.imul(me,Ke)|0,E=E+Math.imul(xe,Ve)|0,d=d+Math.imul(xe,We)|0,d=d+Math.imul(ye,Ve)|0,S=S+Math.imul(ye,We)|0,E=E+Math.imul(oe,je)|0,d=d+Math.imul(oe,Te)|0,d=d+Math.imul(fe,je)|0,S=S+Math.imul(fe,Te)|0,E=E+Math.imul(re,Ge)|0,d=d+Math.imul(re,Je)|0,d=d+Math.imul(ie,Ge)|0,S=S+Math.imul(ie,Je)|0,E=E+Math.imul(Y,Ye)|0,d=d+Math.imul(Y,Xe)|0,d=d+Math.imul(Q,Ye)|0,S=S+Math.imul(Q,Xe)|0;var ds=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(ds>>>26)|0,ds&=67108863,E=Math.imul(ae,He),d=Math.imul(ae,Me),d=d+Math.imul(Ne,He)|0,S=Math.imul(Ne,Me),E=E+Math.imul(pe,Ce)|0,d=d+Math.imul(pe,Re)|0,d=d+Math.imul($e,Ce)|0,S=S+Math.imul($e,Re)|0,E=E+Math.imul(de,Ie)|0,d=d+Math.imul(de,Ke)|0,d=d+Math.imul(le,Ie)|0,S=S+Math.imul(le,Ke)|0,E=E+Math.imul(ge,Ve)|0,d=d+Math.imul(ge,We)|0,d=d+Math.imul(me,Ve)|0,S=S+Math.imul(me,We)|0,E=E+Math.imul(xe,je)|0,d=d+Math.imul(xe,Te)|0,d=d+Math.imul(ye,je)|0,S=S+Math.imul(ye,Te)|0,E=E+Math.imul(oe,Ge)|0,d=d+Math.imul(oe,Je)|0,d=d+Math.imul(fe,Ge)|0,S=S+Math.imul(fe,Je)|0,E=E+Math.imul(re,Ye)|0,d=d+Math.imul(re,Xe)|0,d=d+Math.imul(ie,Ye)|0,S=S+Math.imul(ie,Xe)|0;var Nr=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(Nr>>>26)|0,Nr&=67108863,E=Math.imul(ae,Ce),d=Math.imul(ae,Re),d=d+Math.imul(Ne,Ce)|0,S=Math.imul(Ne,Re),E=E+Math.imul(pe,Ie)|0,d=d+Math.imul(pe,Ke)|0,d=d+Math.imul($e,Ie)|0,S=S+Math.imul($e,Ke)|0,E=E+Math.imul(de,Ve)|0,d=d+Math.imul(de,We)|0,d=d+Math.imul(le,Ve)|0,S=S+Math.imul(le,We)|0,E=E+Math.imul(ge,je)|0,d=d+Math.imul(ge,Te)|0,d=d+Math.imul(me,je)|0,S=S+Math.imul(me,Te)|0,E=E+Math.imul(xe,Ge)|0,d=d+Math.imul(xe,Je)|0,d=d+Math.imul(ye,Ge)|0,S=S+Math.imul(ye,Je)|0,E=E+Math.imul(oe,Ye)|0,d=d+Math.imul(oe,Xe)|0,d=d+Math.imul(fe,Ye)|0,S=S+Math.imul(fe,Xe)|0;var ls=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(ls>>>26)|0,ls&=67108863,E=Math.imul(ae,Ie),d=Math.imul(ae,Ke),d=d+Math.imul(Ne,Ie)|0,S=Math.imul(Ne,Ke),E=E+Math.imul(pe,Ve)|0,d=d+Math.imul(pe,We)|0,d=d+Math.imul($e,Ve)|0,S=S+Math.imul($e,We)|0,E=E+Math.imul(de,je)|0,d=d+Math.imul(de,Te)|0,d=d+Math.imul(le,je)|0,S=S+Math.imul(le,Te)|0,E=E+Math.imul(ge,Ge)|0,d=d+Math.imul(ge,Je)|0,d=d+Math.imul(me,Ge)|0,S=S+Math.imul(me,Je)|0,E=E+Math.imul(xe,Ye)|0,d=d+Math.imul(xe,Xe)|0,d=d+Math.imul(ye,Ye)|0,S=S+Math.imul(ye,Xe)|0;var ps=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(ps>>>26)|0,ps&=67108863,E=Math.imul(ae,Ve),d=Math.imul(ae,We),d=d+Math.imul(Ne,Ve)|0,S=Math.imul(Ne,We),E=E+Math.imul(pe,je)|0,d=d+Math.imul(pe,Te)|0,d=d+Math.imul($e,je)|0,S=S+Math.imul($e,Te)|0,E=E+Math.imul(de,Ge)|0,d=d+Math.imul(de,Je)|0,d=d+Math.imul(le,Ge)|0,S=S+Math.imul(le,Je)|0,E=E+Math.imul(ge,Ye)|0,d=d+Math.imul(ge,Xe)|0,d=d+Math.imul(me,Ye)|0,S=S+Math.imul(me,Xe)|0;var Ut=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(Ut>>>26)|0,Ut&=67108863,E=Math.imul(ae,je),d=Math.imul(ae,Te),d=d+Math.imul(Ne,je)|0,S=Math.imul(Ne,Te),E=E+Math.imul(pe,Ge)|0,d=d+Math.imul(pe,Je)|0,d=d+Math.imul($e,Ge)|0,S=S+Math.imul($e,Je)|0,E=E+Math.imul(de,Ye)|0,d=d+Math.imul(de,Xe)|0,d=d+Math.imul(le,Ye)|0,S=S+Math.imul(le,Xe)|0;var bs=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(bs>>>26)|0,bs&=67108863,E=Math.imul(ae,Ge),d=Math.imul(ae,Je),d=d+Math.imul(Ne,Ge)|0,S=Math.imul(Ne,Je),E=E+Math.imul(pe,Ye)|0,d=d+Math.imul(pe,Xe)|0,d=d+Math.imul($e,Ye)|0,S=S+Math.imul($e,Xe)|0;var gs=($+E|0)+((d&8191)<<13)|0;$=(S+(d>>>13)|0)+(gs>>>26)|0,gs&=67108863,E=Math.imul(ae,Ye),d=Math.imul(ae,Xe),d=d+Math.imul(Ne,Ye)|0,S=Math.imul(Ne,Xe);var vs=($+E|0)+((d&8191)<<13)|0;return $=(S+(d>>>13)|0)+(vs>>>26)|0,vs&=67108863,x[0]=Ct,x[1]=is,x[2]=ss,x[3]=ns,x[4]=as,x[5]=os,x[6]=Xt,x[7]=cs,x[8]=hs,x[9]=us,x[10]=fs,x[11]=ds,x[12]=Nr,x[13]=ls,x[14]=ps,x[15]=Ut,x[16]=bs,x[17]=gs,x[18]=vs,$!==0&&(x[19]=$,y.length++),y};Math.imul||(_=m);function O(I,u,p){p.negative=u.negative^I.negative,p.length=I.length+u.length;for(var y=0,b=0,g=0;g<p.length-1;g++){var x=b;b=0;for(var $=y&67108863,E=Math.min(g,u.length-1),d=Math.max(0,g-I.length+1);d<=E;d++){var S=g-d,L=I.words[S]|0,j=u.words[d]|0,U=L*j,z=U&67108863;x=x+(U/67108864|0)|0,z=z+$|0,$=z&67108863,x=x+(z>>>26)|0,b+=x>>>26,x&=67108863}p.words[g]=$,y=x,x=b}return y!==0?p.words[g]=y:p.length--,p.strip()}function D(I,u,p){var y=new A;return y.mulp(I,u,p)}n.prototype.mulTo=function(u,p){var y,b=this.length+u.length;return this.length===10&&u.length===10?y=_(this,u,p):b<63?y=m(this,u,p):b<1024?y=O(this,u,p):y=D(this,u,p),y};function A(I,u){this.x=I,this.y=u}A.prototype.makeRBT=function(u){for(var p=new Array(u),y=n.prototype._countBits(u)-1,b=0;b<u;b++)p[b]=this.revBin(b,y,u);return p},A.prototype.revBin=function(u,p,y){if(u===0||u===y-1)return u;for(var b=0,g=0;g<p;g++)b|=(u&1)<<p-g-1,u>>=1;return b},A.prototype.permute=function(u,p,y,b,g,x){for(var $=0;$<x;$++)b[$]=p[u[$]],g[$]=y[u[$]]},A.prototype.transform=function(u,p,y,b,g,x){this.permute(x,u,p,y,b,g);for(var $=1;$<g;$<<=1)for(var E=$<<1,d=Math.cos(2*Math.PI/E),S=Math.sin(2*Math.PI/E),L=0;L<g;L+=E)for(var j=d,U=S,z=0;z<$;z++){var G=y[L+z],X=b[L+z],Z=y[L+z+$],Y=b[L+z+$],Q=j*Z-U*Y;Y=j*Y+U*Z,Z=Q,y[L+z]=G+Z,b[L+z]=X+Y,y[L+z+$]=G-Z,b[L+z+$]=X-Y,z!==E&&(Q=d*j-S*U,U=d*U+S*j,j=Q)}},A.prototype.guessLen13b=function(u,p){var y=Math.max(p,u)|1,b=y&1,g=0;for(y=y/2|0;y;y=y>>>1)g++;return 1<<g+1+b},A.prototype.conjugate=function(u,p,y){if(!(y<=1))for(var b=0;b<y/2;b++){var g=u[b];u[b]=u[y-b-1],u[y-b-1]=g,g=p[b],p[b]=-p[y-b-1],p[y-b-1]=-g}},A.prototype.normalize13b=function(u,p){for(var y=0,b=0;b<p/2;b++){var g=Math.round(u[2*b+1]/p)*8192+Math.round(u[2*b]/p)+y;u[b]=g&67108863,g<67108864?y=0:y=g/67108864|0}return u},A.prototype.convert13b=function(u,p,y,b){for(var g=0,x=0;x<p;x++)g=g+(u[x]|0),y[2*x]=g&8191,g=g>>>13,y[2*x+1]=g&8191,g=g>>>13;for(x=2*p;x<b;++x)y[x]=0;i(g===0),i((g&-8192)===0)},A.prototype.stub=function(u){for(var p=new Array(u),y=0;y<u;y++)p[y]=0;return p},A.prototype.mulp=function(u,p,y){var b=2*this.guessLen13b(u.length,p.length),g=this.makeRBT(b),x=this.stub(b),$=new Array(b),E=new Array(b),d=new Array(b),S=new Array(b),L=new Array(b),j=new Array(b),U=y.words;U.length=b,this.convert13b(u.words,u.length,$,b),this.convert13b(p.words,p.length,S,b),this.transform($,x,E,d,b,g),this.transform(S,x,L,j,b,g);for(var z=0;z<b;z++){var G=E[z]*L[z]-d[z]*j[z];d[z]=E[z]*j[z]+d[z]*L[z],E[z]=G}return this.conjugate(E,d,b),this.transform(E,d,U,x,b,g),this.conjugate(U,x,b),this.normalize13b(U,b),y.negative=u.negative^p.negative,y.length=u.length+p.length,y.strip()},n.prototype.mul=function(u){var p=new n(null);return p.words=new Array(this.length+u.length),this.mulTo(u,p)},n.prototype.mulf=function(u){var p=new n(null);return p.words=new Array(this.length+u.length),D(this,u,p)},n.prototype.imul=function(u){return this.clone().mulTo(u,this)},n.prototype.imuln=function(u){i(typeof u=="number"),i(u<67108864);for(var p=0,y=0;y<this.length;y++){var b=(this.words[y]|0)*u,g=(b&67108863)+(p&67108863);p>>=26,p+=b/67108864|0,p+=g>>>26,this.words[y]=g&67108863}return p!==0&&(this.words[y]=p,this.length++),this},n.prototype.muln=function(u){return this.clone().imuln(u)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(u){var p=w(u);if(p.length===0)return new n(1);for(var y=this,b=0;b<p.length&&p[b]===0;b++,y=y.sqr());if(++b<p.length)for(var g=y.sqr();b<p.length;b++,g=g.sqr())p[b]!==0&&(y=y.mul(g));return y},n.prototype.iushln=function(u){i(typeof u=="number"&&u>=0);var p=u%26,y=(u-p)/26,b=67108863>>>26-p<<26-p,g;if(p!==0){var x=0;for(g=0;g<this.length;g++){var $=this.words[g]&b,E=(this.words[g]|0)-$<<p;this.words[g]=E|x,x=$>>>26-p}x&&(this.words[g]=x,this.length++)}if(y!==0){for(g=this.length-1;g>=0;g--)this.words[g+y]=this.words[g];for(g=0;g<y;g++)this.words[g]=0;this.length+=y}return this.strip()},n.prototype.ishln=function(u){return i(this.negative===0),this.iushln(u)},n.prototype.iushrn=function(u,p,y){i(typeof u=="number"&&u>=0);var b;p?b=(p-p%26)/26:b=0;var g=u%26,x=Math.min((u-g)/26,this.length),$=67108863^67108863>>>g<<g,E=y;if(b-=x,b=Math.max(0,b),E){for(var d=0;d<x;d++)E.words[d]=this.words[d];E.length=x}if(x!==0)if(this.length>x)for(this.length-=x,d=0;d<this.length;d++)this.words[d]=this.words[d+x];else this.words[0]=0,this.length=1;var S=0;for(d=this.length-1;d>=0&&(S!==0||d>=b);d--){var L=this.words[d]|0;this.words[d]=S<<26-g|L>>>g,S=L&$}return E&&S!==0&&(E.words[E.length++]=S),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(u,p,y){return i(this.negative===0),this.iushrn(u,p,y)},n.prototype.shln=function(u){return this.clone().ishln(u)},n.prototype.ushln=function(u){return this.clone().iushln(u)},n.prototype.shrn=function(u){return this.clone().ishrn(u)},n.prototype.ushrn=function(u){return this.clone().iushrn(u)},n.prototype.testn=function(u){i(typeof u=="number"&&u>=0);var p=u%26,y=(u-p)/26,b=1<<p;if(this.length<=y)return!1;var g=this.words[y];return!!(g&b)},n.prototype.imaskn=function(u){i(typeof u=="number"&&u>=0);var p=u%26,y=(u-p)/26;if(i(this.negative===0,"imaskn works only with positive numbers"),this.length<=y)return this;if(p!==0&&y++,this.length=Math.min(y,this.length),p!==0){var b=67108863^67108863>>>p<<p;this.words[this.length-1]&=b}return this.strip()},n.prototype.maskn=function(u){return this.clone().imaskn(u)},n.prototype.iaddn=function(u){return i(typeof u=="number"),i(u<67108864),u<0?this.isubn(-u):this.negative!==0?this.length===1&&(this.words[0]|0)<u?(this.words[0]=u-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(u),this.negative=1,this):this._iaddn(u)},n.prototype._iaddn=function(u){this.words[0]+=u;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},n.prototype.isubn=function(u){if(i(typeof u=="number"),i(u<67108864),u<0)return this.iaddn(-u);if(this.negative!==0)return this.negative=0,this.iaddn(u),this.negative=1,this;if(this.words[0]-=u,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},n.prototype.addn=function(u){return this.clone().iaddn(u)},n.prototype.subn=function(u){return this.clone().isubn(u)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(u,p,y){var b=u.length+y,g;this._expand(b);var x,$=0;for(g=0;g<u.length;g++){x=(this.words[g+y]|0)+$;var E=(u.words[g]|0)*p;x-=E&67108863,$=(x>>26)-(E/67108864|0),this.words[g+y]=x&67108863}for(;g<this.length-y;g++)x=(this.words[g+y]|0)+$,$=x>>26,this.words[g+y]=x&67108863;if($===0)return this.strip();for(i($===-1),$=0,g=0;g<this.length;g++)x=-(this.words[g]|0)+$,$=x>>26,this.words[g]=x&67108863;return this.negative=1,this.strip()},n.prototype._wordDiv=function(u,p){var y=this.length-u.length,b=this.clone(),g=u,x=g.words[g.length-1]|0,$=this._countBits(x);y=26-$,y!==0&&(g=g.ushln(y),b.iushln(y),x=g.words[g.length-1]|0);var E=b.length-g.length,d;if(p!=="mod"){d=new n(null),d.length=E+1,d.words=new Array(d.length);for(var S=0;S<d.length;S++)d.words[S]=0}var L=b.clone()._ishlnsubmul(g,1,E);L.negative===0&&(b=L,d&&(d.words[E]=1));for(var j=E-1;j>=0;j--){var U=(b.words[g.length+j]|0)*67108864+(b.words[g.length+j-1]|0);for(U=Math.min(U/x|0,67108863),b._ishlnsubmul(g,U,j);b.negative!==0;)U--,b.negative=0,b._ishlnsubmul(g,1,j),b.isZero()||(b.negative^=1);d&&(d.words[j]=U)}return d&&d.strip(),b.strip(),p!=="div"&&y!==0&&b.iushrn(y),{div:d||null,mod:b}},n.prototype.divmod=function(u,p,y){if(i(!u.isZero()),this.isZero())return{div:new n(0),mod:new n(0)};var b,g,x;return this.negative!==0&&u.negative===0?(x=this.neg().divmod(u,p),p!=="mod"&&(b=x.div.neg()),p!=="div"&&(g=x.mod.neg(),y&&g.negative!==0&&g.iadd(u)),{div:b,mod:g}):this.negative===0&&u.negative!==0?(x=this.divmod(u.neg(),p),p!=="mod"&&(b=x.div.neg()),{div:b,mod:x.mod}):(this.negative&u.negative)!==0?(x=this.neg().divmod(u.neg(),p),p!=="div"&&(g=x.mod.neg(),y&&g.negative!==0&&g.isub(u)),{div:x.div,mod:g}):u.length>this.length||this.cmp(u)<0?{div:new n(0),mod:this}:u.length===1?p==="div"?{div:this.divn(u.words[0]),mod:null}:p==="mod"?{div:null,mod:new n(this.modn(u.words[0]))}:{div:this.divn(u.words[0]),mod:new n(this.modn(u.words[0]))}:this._wordDiv(u,p)},n.prototype.div=function(u){return this.divmod(u,"div",!1).div},n.prototype.mod=function(u){return this.divmod(u,"mod",!1).mod},n.prototype.umod=function(u){return this.divmod(u,"mod",!0).mod},n.prototype.divRound=function(u){var p=this.divmod(u);if(p.mod.isZero())return p.div;var y=p.div.negative!==0?p.mod.isub(u):p.mod,b=u.ushrn(1),g=u.andln(1),x=y.cmp(b);return x<0||g===1&&x===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},n.prototype.modn=function(u){i(u<=67108863);for(var p=(1<<26)%u,y=0,b=this.length-1;b>=0;b--)y=(p*y+(this.words[b]|0))%u;return y},n.prototype.idivn=function(u){i(u<=67108863);for(var p=0,y=this.length-1;y>=0;y--){var b=(this.words[y]|0)+p*67108864;this.words[y]=b/u|0,p=b%u}return this.strip()},n.prototype.divn=function(u){return this.clone().idivn(u)},n.prototype.egcd=function(u){i(u.negative===0),i(!u.isZero());var p=this,y=u.clone();p.negative!==0?p=p.umod(u):p=p.clone();for(var b=new n(1),g=new n(0),x=new n(0),$=new n(1),E=0;p.isEven()&&y.isEven();)p.iushrn(1),y.iushrn(1),++E;for(var d=y.clone(),S=p.clone();!p.isZero();){for(var L=0,j=1;(p.words[0]&j)===0&&L<26;++L,j<<=1);if(L>0)for(p.iushrn(L);L-- >0;)(b.isOdd()||g.isOdd())&&(b.iadd(d),g.isub(S)),b.iushrn(1),g.iushrn(1);for(var U=0,z=1;(y.words[0]&z)===0&&U<26;++U,z<<=1);if(U>0)for(y.iushrn(U);U-- >0;)(x.isOdd()||$.isOdd())&&(x.iadd(d),$.isub(S)),x.iushrn(1),$.iushrn(1);p.cmp(y)>=0?(p.isub(y),b.isub(x),g.isub($)):(y.isub(p),x.isub(b),$.isub(g))}return{a:x,b:$,gcd:y.iushln(E)}},n.prototype._invmp=function(u){i(u.negative===0),i(!u.isZero());var p=this,y=u.clone();p.negative!==0?p=p.umod(u):p=p.clone();for(var b=new n(1),g=new n(0),x=y.clone();p.cmpn(1)>0&&y.cmpn(1)>0;){for(var $=0,E=1;(p.words[0]&E)===0&&$<26;++$,E<<=1);if($>0)for(p.iushrn($);$-- >0;)b.isOdd()&&b.iadd(x),b.iushrn(1);for(var d=0,S=1;(y.words[0]&S)===0&&d<26;++d,S<<=1);if(d>0)for(y.iushrn(d);d-- >0;)g.isOdd()&&g.iadd(x),g.iushrn(1);p.cmp(y)>=0?(p.isub(y),b.isub(g)):(y.isub(p),g.isub(b))}var L;return p.cmpn(1)===0?L=b:L=g,L.cmpn(0)<0&&L.iadd(u),L},n.prototype.gcd=function(u){if(this.isZero())return u.abs();if(u.isZero())return this.abs();var p=this.clone(),y=u.clone();p.negative=0,y.negative=0;for(var b=0;p.isEven()&&y.isEven();b++)p.iushrn(1),y.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;y.isEven();)y.iushrn(1);var g=p.cmp(y);if(g<0){var x=p;p=y,y=x}else if(g===0||y.cmpn(1)===0)break;p.isub(y)}while(!0);return y.iushln(b)},n.prototype.invm=function(u){return this.egcd(u).a.umod(u)},n.prototype.isEven=function(){return(this.words[0]&1)===0},n.prototype.isOdd=function(){return(this.words[0]&1)===1},n.prototype.andln=function(u){return this.words[0]&u},n.prototype.bincn=function(u){i(typeof u=="number");var p=u%26,y=(u-p)/26,b=1<<p;if(this.length<=y)return this._expand(y+1),this.words[y]|=b,this;for(var g=b,x=y;g!==0&&x<this.length;x++){var $=this.words[x]|0;$+=g,g=$>>>26,$&=67108863,this.words[x]=$}return g!==0&&(this.words[x]=g,this.length++),this},n.prototype.isZero=function(){return this.length===1&&this.words[0]===0},n.prototype.cmpn=function(u){var p=u<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var y;if(this.length>1)y=1;else{p&&(u=-u),i(u<=67108863,"Number is too big");var b=this.words[0]|0;y=b===u?0:b<u?-1:1}return this.negative!==0?-y|0:y},n.prototype.cmp=function(u){if(this.negative!==0&&u.negative===0)return-1;if(this.negative===0&&u.negative!==0)return 1;var p=this.ucmp(u);return this.negative!==0?-p|0:p},n.prototype.ucmp=function(u){if(this.length>u.length)return 1;if(this.length<u.length)return-1;for(var p=0,y=this.length-1;y>=0;y--){var b=this.words[y]|0,g=u.words[y]|0;if(b!==g){b<g?p=-1:b>g&&(p=1);break}}return p},n.prototype.gtn=function(u){return this.cmpn(u)===1},n.prototype.gt=function(u){return this.cmp(u)===1},n.prototype.gten=function(u){return this.cmpn(u)>=0},n.prototype.gte=function(u){return this.cmp(u)>=0},n.prototype.ltn=function(u){return this.cmpn(u)===-1},n.prototype.lt=function(u){return this.cmp(u)===-1},n.prototype.lten=function(u){return this.cmpn(u)<=0},n.prototype.lte=function(u){return this.cmp(u)<=0},n.prototype.eqn=function(u){return this.cmpn(u)===0},n.prototype.eq=function(u){return this.cmp(u)===0},n.red=function(u){return new N(u)},n.prototype.toRed=function(u){return i(!this.red,"Already a number in reduction context"),i(this.negative===0,"red works only with positives"),u.convertTo(this)._forceRed(u)},n.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(u){return this.red=u,this},n.prototype.forceRed=function(u){return i(!this.red,"Already a number in reduction context"),this._forceRed(u)},n.prototype.redAdd=function(u){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,u)},n.prototype.redIAdd=function(u){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,u)},n.prototype.redSub=function(u){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,u)},n.prototype.redISub=function(u){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,u)},n.prototype.redShl=function(u){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,u)},n.prototype.redMul=function(u){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,u),this.red.mul(this,u)},n.prototype.redIMul=function(u){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,u),this.red.imul(this,u)},n.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(u){return i(this.red&&!u.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,u)};var M={k256:null,p224:null,p192:null,p25519:null};function R(I,u){this.name=I,this.p=new n(u,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}R.prototype._tmp=function(){var u=new n(null);return u.words=new Array(Math.ceil(this.n/13)),u},R.prototype.ireduce=function(u){var p=u,y;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),y=p.bitLength();while(y>this.n);var b=y<this.n?-1:p.ucmp(this.p);return b===0?(p.words[0]=0,p.length=1):b>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},R.prototype.split=function(u,p){u.iushrn(this.n,0,p)},R.prototype.imulK=function(u){return u.imul(this.k)};function T(){R.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}s(T,R),T.prototype.split=function(u,p){for(var y=4194303,b=Math.min(u.length,9),g=0;g<b;g++)p.words[g]=u.words[g];if(p.length=b,u.length<=9){u.words[0]=0,u.length=1;return}var x=u.words[9];for(p.words[p.length++]=x&y,g=10;g<u.length;g++){var $=u.words[g]|0;u.words[g-10]=($&y)<<4|x>>>22,x=$}x>>>=22,u.words[g-10]=x,x===0&&u.length>10?u.length-=10:u.length-=9},T.prototype.imulK=function(u){u.words[u.length]=0,u.words[u.length+1]=0,u.length+=2;for(var p=0,y=0;y<u.length;y++){var b=u.words[y]|0;p+=b*977,u.words[y]=p&67108863,p=b*64+(p/67108864|0)}return u.words[u.length-1]===0&&(u.length--,u.words[u.length-1]===0&&u.length--),u};function C(){R.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}s(C,R);function q(){R.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}s(q,R);function B(){R.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}s(B,R),B.prototype.imulK=function(u){for(var p=0,y=0;y<u.length;y++){var b=(u.words[y]|0)*19+p,g=b&67108863;b>>>=26,u.words[y]=g,p=b}return p!==0&&(u.words[u.length++]=p),u},n._prime=function(u){if(M[u])return M[u];var p;if(u==="k256")p=new T;else if(u==="p224")p=new C;else if(u==="p192")p=new q;else if(u==="p25519")p=new B;else throw new Error("Unknown prime "+u);return M[u]=p,p};function N(I){if(typeof I=="string"){var u=n._prime(I);this.m=u.p,this.prime=u}else i(I.gtn(1),"modulus must be greater than 1"),this.m=I,this.prime=null}N.prototype._verify1=function(u){i(u.negative===0,"red works only with positives"),i(u.red,"red works only with red numbers")},N.prototype._verify2=function(u,p){i((u.negative|p.negative)===0,"red works only with positives"),i(u.red&&u.red===p.red,"red works only with red numbers")},N.prototype.imod=function(u){return this.prime?this.prime.ireduce(u)._forceRed(this):u.umod(this.m)._forceRed(this)},N.prototype.neg=function(u){return u.isZero()?u.clone():this.m.sub(u)._forceRed(this)},N.prototype.add=function(u,p){this._verify2(u,p);var y=u.add(p);return y.cmp(this.m)>=0&&y.isub(this.m),y._forceRed(this)},N.prototype.iadd=function(u,p){this._verify2(u,p);var y=u.iadd(p);return y.cmp(this.m)>=0&&y.isub(this.m),y},N.prototype.sub=function(u,p){this._verify2(u,p);var y=u.sub(p);return y.cmpn(0)<0&&y.iadd(this.m),y._forceRed(this)},N.prototype.isub=function(u,p){this._verify2(u,p);var y=u.isub(p);return y.cmpn(0)<0&&y.iadd(this.m),y},N.prototype.shl=function(u,p){return this._verify1(u),this.imod(u.ushln(p))},N.prototype.imul=function(u,p){return this._verify2(u,p),this.imod(u.imul(p))},N.prototype.mul=function(u,p){return this._verify2(u,p),this.imod(u.mul(p))},N.prototype.isqr=function(u){return this.imul(u,u.clone())},N.prototype.sqr=function(u){return this.mul(u,u)},N.prototype.sqrt=function(u){if(u.isZero())return u.clone();var p=this.m.andln(3);if(i(p%2===1),p===3){var y=this.m.add(new n(1)).iushrn(2);return this.pow(u,y)}for(var b=this.m.subn(1),g=0;!b.isZero()&&b.andln(1)===0;)g++,b.iushrn(1);i(!b.isZero());var x=new n(1).toRed(this),$=x.redNeg(),E=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);this.pow(d,E).cmp($)!==0;)d.redIAdd($);for(var S=this.pow(d,b),L=this.pow(u,b.addn(1).iushrn(1)),j=this.pow(u,b),U=g;j.cmp(x)!==0;){for(var z=j,G=0;z.cmp(x)!==0;G++)z=z.redSqr();i(G<U);var X=this.pow(S,new n(1).iushln(U-G-1));L=L.redMul(X),S=X.redSqr(),j=j.redMul(S),U=G}return L},N.prototype.invm=function(u){var p=u._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},N.prototype.pow=function(u,p){if(p.isZero())return new n(1).toRed(this);if(p.cmpn(1)===0)return u.clone();var y=4,b=new Array(1<<y);b[0]=new n(1).toRed(this),b[1]=u;for(var g=2;g<b.length;g++)b[g]=this.mul(b[g-1],u);var x=b[0],$=0,E=0,d=p.bitLength()%26;for(d===0&&(d=26),g=p.length-1;g>=0;g--){for(var S=p.words[g],L=d-1;L>=0;L--){var j=S>>L&1;if(x!==b[0]&&(x=this.sqr(x)),j===0&&$===0){E=0;continue}$<<=1,$|=j,E++,!(E!==y&&(g!==0||L!==0))&&(x=this.mul(x,b[$]),E=0,$=0)}d=26}return x},N.prototype.convertTo=function(u){var p=u.umod(this.m);return p===u?p.clone():p},N.prototype.convertFrom=function(u){var p=u.clone();return p.red=null,p},n.mont=function(u){return new k(u)};function k(I){N.call(this,I),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}s(k,N),k.prototype.convertTo=function(u){return this.imod(u.ushln(this.shift))},k.prototype.convertFrom=function(u){var p=this.imod(u.mul(this.rinv));return p.red=null,p},k.prototype.imul=function(u,p){if(u.isZero()||p.isZero())return u.words[0]=0,u.length=1,u;var y=u.imul(p),b=y.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),g=y.isub(b).iushrn(this.shift),x=g;return g.cmp(this.m)>=0?x=g.isub(this.m):g.cmpn(0)<0&&(x=g.iadd(this.m)),x._forceRed(this)},k.prototype.mul=function(u,p){if(u.isZero()||p.isZero())return new n(0)._forceRed(this);var y=u.mul(p),b=y.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),g=y.isub(b).iushrn(this.shift),x=g;return g.cmp(this.m)>=0?x=g.isub(this.m):g.cmpn(0)<0&&(x=g.iadd(this.m)),x._forceRed(this)},k.prototype.invm=function(u){var p=this.imod(u._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(r,qy)}(Tn)),Tn.exports}var Ba,Wh;function li(){if(Wh)return Ba;Wh=1,Ba=r;function r(e,t){if(!e)throw new Error(t||"Assertion failed")}return r.equal=function(t,i,s){if(t!=i)throw new Error(s||"Assertion failed: "+t+" != "+i)},Ba}var La={},Gh;function Pl(){return Gh||(Gh=1,function(r){var e=r;function t(n,a){if(Array.isArray(n))return n.slice();if(!n)return[];var o=[];if(typeof n!="string"){for(var h=0;h<n.length;h++)o[h]=n[h]|0;return o}if(a==="hex"){n=n.replace(/[^a-z0-9]+/ig,""),n.length%2!==0&&(n="0"+n);for(var h=0;h<n.length;h+=2)o.push(parseInt(n[h]+n[h+1],16))}else for(var h=0;h<n.length;h++){var c=n.charCodeAt(h),f=c>>8,l=c&255;f?o.push(f,l):o.push(l)}return o}e.toArray=t;function i(n){return n.length===1?"0"+n:n}e.zero2=i;function s(n){for(var a="",o=0;o<n.length;o++)a+=i(n[o].toString(16));return a}e.toHex=s,e.encode=function(a,o){return o==="hex"?s(a):a}}(La)),La}var Jh;function Gt(){return Jh||(Jh=1,function(r){var e=r,t=Rr(),i=li(),s=Pl();e.assert=i,e.toArray=s.toArray,e.zero2=s.zero2,e.toHex=s.toHex,e.encode=s.encode;function n(f,l,v){var w=new Array(Math.max(f.bitLength(),v)+1),m;for(m=0;m<w.length;m+=1)w[m]=0;var _=1<<l+1,O=f.clone();for(m=0;m<w.length;m++){var D,A=O.andln(_-1);O.isOdd()?(A>(_>>1)-1?D=(_>>1)-A:D=A,O.isubn(D)):D=0,w[m]=D,O.iushrn(1)}return w}e.getNAF=n;function a(f,l){var v=[[],[]];f=f.clone(),l=l.clone();for(var w=0,m=0,_;f.cmpn(-w)>0||l.cmpn(-m)>0;){var O=f.andln(3)+w&3,D=l.andln(3)+m&3;O===3&&(O=-1),D===3&&(D=-1);var A;(O&1)===0?A=0:(_=f.andln(7)+w&7,(_===3||_===5)&&D===2?A=-O:A=O),v[0].push(A);var M;(D&1)===0?M=0:(_=l.andln(7)+m&7,(_===3||_===5)&&O===2?M=-D:M=D),v[1].push(M),2*w===A+1&&(w=1-w),2*m===M+1&&(m=1-m),f.iushrn(1),l.iushrn(1)}return v}e.getJSF=a;function o(f,l,v){var w="_"+l;f.prototype[l]=function(){return this[w]!==void 0?this[w]:this[w]=v.call(this)}}e.cachedProperty=o;function h(f){return typeof f=="string"?e.toArray(f,"hex"):f}e.parseBytes=h;function c(f){return new t(f,"hex","le")}e.intFromLE=c}(qa)),qa}var wn={exports:{}},Yh;function Ol(){if(Yh)return wn.exports;Yh=1;var r;wn.exports=function(s){return r||(r=new e(null)),r.generate(s)};function e(i){this.rand=i}if(wn.exports.Rand=e,e.prototype.generate=function(s){return this._rand(s)},e.prototype._rand=function(s){if(this.rand.getBytes)return this.rand.getBytes(s);for(var n=new Uint8Array(s),a=0;a<n.length;a++)n[a]=this.rand.getByte();return n},typeof self=="object")self.crypto&&self.crypto.getRandomValues?e.prototype._rand=function(s){var n=new Uint8Array(s);return self.crypto.getRandomValues(n),n}:self.msCrypto&&self.msCrypto.getRandomValues?e.prototype._rand=function(s){var n=new Uint8Array(s);return self.msCrypto.getRandomValues(n),n}:typeof window=="object"&&(e.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var t=qd;if(typeof t.randomBytes!="function")throw new Error("Not supported");e.prototype._rand=function(s){return t.randomBytes(s)}}catch{}return wn.exports}var ja={},Ua,Xh;function sa(){if(Xh)return Ua;Xh=1;var r=Rr(),e=Gt(),t=e.getNAF,i=e.getJSF,s=e.assert;function n(o,h){this.type=o,this.p=new r(h.p,16),this.red=h.prime?r.red(h.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=h.n&&new r(h.n,16),this.g=h.g&&this.pointFromJSON(h.g,h.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var c=this.n&&this.p.div(this.n);!c||c.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}Ua=n,n.prototype.point=function(){throw new Error("Not implemented")},n.prototype.validate=function(){throw new Error("Not implemented")},n.prototype._fixedNafMul=function(h,c){s(h.precomputed);var f=h._getDoubles(),l=t(c,1,this._bitLength),v=(1<<f.step+1)-(f.step%2===0?2:1);v/=3;var w=[],m,_;for(m=0;m<l.length;m+=f.step){_=0;for(var O=m+f.step-1;O>=m;O--)_=(_<<1)+l[O];w.push(_)}for(var D=this.jpoint(null,null,null),A=this.jpoint(null,null,null),M=v;M>0;M--){for(m=0;m<w.length;m++)_=w[m],_===M?A=A.mixedAdd(f.points[m]):_===-M&&(A=A.mixedAdd(f.points[m].neg()));D=D.add(A)}return D.toP()},n.prototype._wnafMul=function(h,c){var f=4,l=h._getNAFPoints(f);f=l.wnd;for(var v=l.points,w=t(c,f,this._bitLength),m=this.jpoint(null,null,null),_=w.length-1;_>=0;_--){for(var O=0;_>=0&&w[_]===0;_--)O++;if(_>=0&&O++,m=m.dblp(O),_<0)break;var D=w[_];s(D!==0),h.type==="affine"?D>0?m=m.mixedAdd(v[D-1>>1]):m=m.mixedAdd(v[-D-1>>1].neg()):D>0?m=m.add(v[D-1>>1]):m=m.add(v[-D-1>>1].neg())}return h.type==="affine"?m.toP():m},n.prototype._wnafMulAdd=function(h,c,f,l,v){var w=this._wnafT1,m=this._wnafT2,_=this._wnafT3,O=0,D,A,M;for(D=0;D<l;D++){M=c[D];var R=M._getNAFPoints(h);w[D]=R.wnd,m[D]=R.points}for(D=l-1;D>=1;D-=2){var T=D-1,C=D;if(w[T]!==1||w[C]!==1){_[T]=t(f[T],w[T],this._bitLength),_[C]=t(f[C],w[C],this._bitLength),O=Math.max(_[T].length,O),O=Math.max(_[C].length,O);continue}var q=[c[T],null,null,c[C]];c[T].y.cmp(c[C].y)===0?(q[1]=c[T].add(c[C]),q[2]=c[T].toJ().mixedAdd(c[C].neg())):c[T].y.cmp(c[C].y.redNeg())===0?(q[1]=c[T].toJ().mixedAdd(c[C]),q[2]=c[T].add(c[C].neg())):(q[1]=c[T].toJ().mixedAdd(c[C]),q[2]=c[T].toJ().mixedAdd(c[C].neg()));var B=[-3,-1,-5,-7,0,7,5,1,3],N=i(f[T],f[C]);for(O=Math.max(N[0].length,O),_[T]=new Array(O),_[C]=new Array(O),A=0;A<O;A++){var k=N[0][A]|0,I=N[1][A]|0;_[T][A]=B[(k+1)*3+(I+1)],_[C][A]=0,m[T]=q}}var u=this.jpoint(null,null,null),p=this._wnafT4;for(D=O;D>=0;D--){for(var y=0;D>=0;){var b=!0;for(A=0;A<l;A++)p[A]=_[A][D]|0,p[A]!==0&&(b=!1);if(!b)break;y++,D--}if(D>=0&&y++,u=u.dblp(y),D<0)break;for(A=0;A<l;A++){var g=p[A];g!==0&&(g>0?M=m[A][g-1>>1]:g<0&&(M=m[A][-g-1>>1].neg()),M.type==="affine"?u=u.mixedAdd(M):u=u.add(M))}}for(D=0;D<l;D++)m[D]=null;return v?u:u.toP()};function a(o,h){this.curve=o,this.type=h,this.precomputed=null}return n.BasePoint=a,a.prototype.eq=function(){throw new Error("Not implemented")},a.prototype.validate=function(){return this.curve.validate(this)},n.prototype.decodePoint=function(h,c){h=e.toArray(h,c);var f=this.p.byteLength();if((h[0]===4||h[0]===6||h[0]===7)&&h.length-1===2*f){h[0]===6?s(h[h.length-1]%2===0):h[0]===7&&s(h[h.length-1]%2===1);var l=this.point(h.slice(1,1+f),h.slice(1+f,1+2*f));return l}else if((h[0]===2||h[0]===3)&&h.length-1===f)return this.pointFromX(h.slice(1,1+f),h[0]===3);throw new Error("Unknown point format")},a.prototype.encodeCompressed=function(h){return this.encode(h,!0)},a.prototype._encode=function(h){var c=this.curve.p.byteLength(),f=this.getX().toArray("be",c);return h?[this.getY().isEven()?2:3].concat(f):[4].concat(f,this.getY().toArray("be",c))},a.prototype.encode=function(h,c){return e.encode(this._encode(c),h)},a.prototype.precompute=function(h){if(this.precomputed)return this;var c={doubles:null,naf:null,beta:null};return c.naf=this._getNAFPoints(8),c.doubles=this._getDoubles(4,h),c.beta=this._getBeta(),this.precomputed=c,this},a.prototype._hasDoubles=function(h){if(!this.precomputed)return!1;var c=this.precomputed.doubles;return c?c.points.length>=Math.ceil((h.bitLength()+1)/c.step):!1},a.prototype._getDoubles=function(h,c){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var f=[this],l=this,v=0;v<c;v+=h){for(var w=0;w<h;w++)l=l.dbl();f.push(l)}return{step:h,points:f}},a.prototype._getNAFPoints=function(h){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var c=[this],f=(1<<h)-1,l=f===1?null:this.dbl(),v=1;v<f;v++)c[v]=c[v-1].add(l);return{wnd:h,points:c}},a.prototype._getBeta=function(){return null},a.prototype.dblp=function(h){for(var c=this,f=0;f<h;f++)c=c.dbl();return c},Ua}var za,Zh;function By(){if(Zh)return za;Zh=1;var r=Gt(),e=Rr(),t=Zn(),i=sa(),s=r.assert;function n(h){i.call(this,"short",h),this.a=new e(h.a,16).toRed(this.red),this.b=new e(h.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(h),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}t(n,i),za=n,n.prototype._getEndomorphism=function(c){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var f,l;if(c.beta)f=new e(c.beta,16).toRed(this.red);else{var v=this._getEndoRoots(this.p);f=v[0].cmp(v[1])<0?v[0]:v[1],f=f.toRed(this.red)}if(c.lambda)l=new e(c.lambda,16);else{var w=this._getEndoRoots(this.n);this.g.mul(w[0]).x.cmp(this.g.x.redMul(f))===0?l=w[0]:(l=w[1],s(this.g.mul(l).x.cmp(this.g.x.redMul(f))===0))}var m;return c.basis?m=c.basis.map(function(_){return{a:new e(_.a,16),b:new e(_.b,16)}}):m=this._getEndoBasis(l),{beta:f,lambda:l,basis:m}}},n.prototype._getEndoRoots=function(c){var f=c===this.p?this.red:e.mont(c),l=new e(2).toRed(f).redInvm(),v=l.redNeg(),w=new e(3).toRed(f).redNeg().redSqrt().redMul(l),m=v.redAdd(w).fromRed(),_=v.redSub(w).fromRed();return[m,_]},n.prototype._getEndoBasis=function(c){for(var f=this.n.ushrn(Math.floor(this.n.bitLength()/2)),l=c,v=this.n.clone(),w=new e(1),m=new e(0),_=new e(0),O=new e(1),D,A,M,R,T,C,q,B=0,N,k;l.cmpn(0)!==0;){var I=v.div(l);N=v.sub(I.mul(l)),k=_.sub(I.mul(w));var u=O.sub(I.mul(m));if(!M&&N.cmp(f)<0)D=q.neg(),A=w,M=N.neg(),R=k;else if(M&&++B===2)break;q=N,v=l,l=N,_=w,w=k,O=m,m=u}T=N.neg(),C=k;var p=M.sqr().add(R.sqr()),y=T.sqr().add(C.sqr());return y.cmp(p)>=0&&(T=D,C=A),M.negative&&(M=M.neg(),R=R.neg()),T.negative&&(T=T.neg(),C=C.neg()),[{a:M,b:R},{a:T,b:C}]},n.prototype._endoSplit=function(c){var f=this.endo.basis,l=f[0],v=f[1],w=v.b.mul(c).divRound(this.n),m=l.b.neg().mul(c).divRound(this.n),_=w.mul(l.a),O=m.mul(v.a),D=w.mul(l.b),A=m.mul(v.b),M=c.sub(_).sub(O),R=D.add(A).neg();return{k1:M,k2:R}},n.prototype.pointFromX=function(c,f){c=new e(c,16),c.red||(c=c.toRed(this.red));var l=c.redSqr().redMul(c).redIAdd(c.redMul(this.a)).redIAdd(this.b),v=l.redSqrt();if(v.redSqr().redSub(l).cmp(this.zero)!==0)throw new Error("invalid point");var w=v.fromRed().isOdd();return(f&&!w||!f&&w)&&(v=v.redNeg()),this.point(c,v)},n.prototype.validate=function(c){if(c.inf)return!0;var f=c.x,l=c.y,v=this.a.redMul(f),w=f.redSqr().redMul(f).redIAdd(v).redIAdd(this.b);return l.redSqr().redISub(w).cmpn(0)===0},n.prototype._endoWnafMulAdd=function(c,f,l){for(var v=this._endoWnafT1,w=this._endoWnafT2,m=0;m<c.length;m++){var _=this._endoSplit(f[m]),O=c[m],D=O._getBeta();_.k1.negative&&(_.k1.ineg(),O=O.neg(!0)),_.k2.negative&&(_.k2.ineg(),D=D.neg(!0)),v[m*2]=O,v[m*2+1]=D,w[m*2]=_.k1,w[m*2+1]=_.k2}for(var A=this._wnafMulAdd(1,v,w,m*2,l),M=0;M<m*2;M++)v[M]=null,w[M]=null;return A};function a(h,c,f,l){i.BasePoint.call(this,h,"affine"),c===null&&f===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new e(c,16),this.y=new e(f,16),l&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}t(a,i.BasePoint),n.prototype.point=function(c,f,l){return new a(this,c,f,l)},n.prototype.pointFromJSON=function(c,f){return a.fromJSON(this,c,f)},a.prototype._getBeta=function(){if(this.curve.endo){var c=this.precomputed;if(c&&c.beta)return c.beta;var f=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(c){var l=this.curve,v=function(w){return l.point(w.x.redMul(l.endo.beta),w.y)};c.beta=f,f.precomputed={beta:null,naf:c.naf&&{wnd:c.naf.wnd,points:c.naf.points.map(v)},doubles:c.doubles&&{step:c.doubles.step,points:c.doubles.points.map(v)}}}return f}},a.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},a.fromJSON=function(c,f,l){typeof f=="string"&&(f=JSON.parse(f));var v=c.point(f[0],f[1],l);if(!f[2])return v;function w(_){return c.point(_[0],_[1],l)}var m=f[2];return v.precomputed={beta:null,doubles:m.doubles&&{step:m.doubles.step,points:[v].concat(m.doubles.points.map(w))},naf:m.naf&&{wnd:m.naf.wnd,points:[v].concat(m.naf.points.map(w))}},v},a.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},a.prototype.isInfinity=function(){return this.inf},a.prototype.add=function(c){if(this.inf)return c;if(c.inf)return this;if(this.eq(c))return this.dbl();if(this.neg().eq(c))return this.curve.point(null,null);if(this.x.cmp(c.x)===0)return this.curve.point(null,null);var f=this.y.redSub(c.y);f.cmpn(0)!==0&&(f=f.redMul(this.x.redSub(c.x).redInvm()));var l=f.redSqr().redISub(this.x).redISub(c.x),v=f.redMul(this.x.redSub(l)).redISub(this.y);return this.curve.point(l,v)},a.prototype.dbl=function(){if(this.inf)return this;var c=this.y.redAdd(this.y);if(c.cmpn(0)===0)return this.curve.point(null,null);var f=this.curve.a,l=this.x.redSqr(),v=c.redInvm(),w=l.redAdd(l).redIAdd(l).redIAdd(f).redMul(v),m=w.redSqr().redISub(this.x.redAdd(this.x)),_=w.redMul(this.x.redSub(m)).redISub(this.y);return this.curve.point(m,_)},a.prototype.getX=function(){return this.x.fromRed()},a.prototype.getY=function(){return this.y.fromRed()},a.prototype.mul=function(c){return c=new e(c,16),this.isInfinity()?this:this._hasDoubles(c)?this.curve._fixedNafMul(this,c):this.curve.endo?this.curve._endoWnafMulAdd([this],[c]):this.curve._wnafMul(this,c)},a.prototype.mulAdd=function(c,f,l){var v=[this,f],w=[c,l];return this.curve.endo?this.curve._endoWnafMulAdd(v,w):this.curve._wnafMulAdd(1,v,w,2)},a.prototype.jmulAdd=function(c,f,l){var v=[this,f],w=[c,l];return this.curve.endo?this.curve._endoWnafMulAdd(v,w,!0):this.curve._wnafMulAdd(1,v,w,2,!0)},a.prototype.eq=function(c){return this===c||this.inf===c.inf&&(this.inf||this.x.cmp(c.x)===0&&this.y.cmp(c.y)===0)},a.prototype.neg=function(c){if(this.inf)return this;var f=this.curve.point(this.x,this.y.redNeg());if(c&&this.precomputed){var l=this.precomputed,v=function(w){return w.neg()};f.precomputed={naf:l.naf&&{wnd:l.naf.wnd,points:l.naf.points.map(v)},doubles:l.doubles&&{step:l.doubles.step,points:l.doubles.points.map(v)}}}return f},a.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var c=this.curve.jpoint(this.x,this.y,this.curve.one);return c};function o(h,c,f,l){i.BasePoint.call(this,h,"jacobian"),c===null&&f===null&&l===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new e(0)):(this.x=new e(c,16),this.y=new e(f,16),this.z=new e(l,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}return t(o,i.BasePoint),n.prototype.jpoint=function(c,f,l){return new o(this,c,f,l)},o.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var c=this.z.redInvm(),f=c.redSqr(),l=this.x.redMul(f),v=this.y.redMul(f).redMul(c);return this.curve.point(l,v)},o.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},o.prototype.add=function(c){if(this.isInfinity())return c;if(c.isInfinity())return this;var f=c.z.redSqr(),l=this.z.redSqr(),v=this.x.redMul(f),w=c.x.redMul(l),m=this.y.redMul(f.redMul(c.z)),_=c.y.redMul(l.redMul(this.z)),O=v.redSub(w),D=m.redSub(_);if(O.cmpn(0)===0)return D.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var A=O.redSqr(),M=A.redMul(O),R=v.redMul(A),T=D.redSqr().redIAdd(M).redISub(R).redISub(R),C=D.redMul(R.redISub(T)).redISub(m.redMul(M)),q=this.z.redMul(c.z).redMul(O);return this.curve.jpoint(T,C,q)},o.prototype.mixedAdd=function(c){if(this.isInfinity())return c.toJ();if(c.isInfinity())return this;var f=this.z.redSqr(),l=this.x,v=c.x.redMul(f),w=this.y,m=c.y.redMul(f).redMul(this.z),_=l.redSub(v),O=w.redSub(m);if(_.cmpn(0)===0)return O.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var D=_.redSqr(),A=D.redMul(_),M=l.redMul(D),R=O.redSqr().redIAdd(A).redISub(M).redISub(M),T=O.redMul(M.redISub(R)).redISub(w.redMul(A)),C=this.z.redMul(_);return this.curve.jpoint(R,T,C)},o.prototype.dblp=function(c){if(c===0)return this;if(this.isInfinity())return this;if(!c)return this.dbl();var f;if(this.curve.zeroA||this.curve.threeA){var l=this;for(f=0;f<c;f++)l=l.dbl();return l}var v=this.curve.a,w=this.curve.tinv,m=this.x,_=this.y,O=this.z,D=O.redSqr().redSqr(),A=_.redAdd(_);for(f=0;f<c;f++){var M=m.redSqr(),R=A.redSqr(),T=R.redSqr(),C=M.redAdd(M).redIAdd(M).redIAdd(v.redMul(D)),q=m.redMul(R),B=C.redSqr().redISub(q.redAdd(q)),N=q.redISub(B),k=C.redMul(N);k=k.redIAdd(k).redISub(T);var I=A.redMul(O);f+1<c&&(D=D.redMul(T)),m=B,O=I,A=k}return this.curve.jpoint(m,A.redMul(w),O)},o.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},o.prototype._zeroDbl=function(){var c,f,l;if(this.zOne){var v=this.x.redSqr(),w=this.y.redSqr(),m=w.redSqr(),_=this.x.redAdd(w).redSqr().redISub(v).redISub(m);_=_.redIAdd(_);var O=v.redAdd(v).redIAdd(v),D=O.redSqr().redISub(_).redISub(_),A=m.redIAdd(m);A=A.redIAdd(A),A=A.redIAdd(A),c=D,f=O.redMul(_.redISub(D)).redISub(A),l=this.y.redAdd(this.y)}else{var M=this.x.redSqr(),R=this.y.redSqr(),T=R.redSqr(),C=this.x.redAdd(R).redSqr().redISub(M).redISub(T);C=C.redIAdd(C);var q=M.redAdd(M).redIAdd(M),B=q.redSqr(),N=T.redIAdd(T);N=N.redIAdd(N),N=N.redIAdd(N),c=B.redISub(C).redISub(C),f=q.redMul(C.redISub(c)).redISub(N),l=this.y.redMul(this.z),l=l.redIAdd(l)}return this.curve.jpoint(c,f,l)},o.prototype._threeDbl=function(){var c,f,l;if(this.zOne){var v=this.x.redSqr(),w=this.y.redSqr(),m=w.redSqr(),_=this.x.redAdd(w).redSqr().redISub(v).redISub(m);_=_.redIAdd(_);var O=v.redAdd(v).redIAdd(v).redIAdd(this.curve.a),D=O.redSqr().redISub(_).redISub(_);c=D;var A=m.redIAdd(m);A=A.redIAdd(A),A=A.redIAdd(A),f=O.redMul(_.redISub(D)).redISub(A),l=this.y.redAdd(this.y)}else{var M=this.z.redSqr(),R=this.y.redSqr(),T=this.x.redMul(R),C=this.x.redSub(M).redMul(this.x.redAdd(M));C=C.redAdd(C).redIAdd(C);var q=T.redIAdd(T);q=q.redIAdd(q);var B=q.redAdd(q);c=C.redSqr().redISub(B),l=this.y.redAdd(this.z).redSqr().redISub(R).redISub(M);var N=R.redSqr();N=N.redIAdd(N),N=N.redIAdd(N),N=N.redIAdd(N),f=C.redMul(q.redISub(c)).redISub(N)}return this.curve.jpoint(c,f,l)},o.prototype._dbl=function(){var c=this.curve.a,f=this.x,l=this.y,v=this.z,w=v.redSqr().redSqr(),m=f.redSqr(),_=l.redSqr(),O=m.redAdd(m).redIAdd(m).redIAdd(c.redMul(w)),D=f.redAdd(f);D=D.redIAdd(D);var A=D.redMul(_),M=O.redSqr().redISub(A.redAdd(A)),R=A.redISub(M),T=_.redSqr();T=T.redIAdd(T),T=T.redIAdd(T),T=T.redIAdd(T);var C=O.redMul(R).redISub(T),q=l.redAdd(l).redMul(v);return this.curve.jpoint(M,C,q)},o.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var c=this.x.redSqr(),f=this.y.redSqr(),l=this.z.redSqr(),v=f.redSqr(),w=c.redAdd(c).redIAdd(c),m=w.redSqr(),_=this.x.redAdd(f).redSqr().redISub(c).redISub(v);_=_.redIAdd(_),_=_.redAdd(_).redIAdd(_),_=_.redISub(m);var O=_.redSqr(),D=v.redIAdd(v);D=D.redIAdd(D),D=D.redIAdd(D),D=D.redIAdd(D);var A=w.redIAdd(_).redSqr().redISub(m).redISub(O).redISub(D),M=f.redMul(A);M=M.redIAdd(M),M=M.redIAdd(M);var R=this.x.redMul(O).redISub(M);R=R.redIAdd(R),R=R.redIAdd(R);var T=this.y.redMul(A.redMul(D.redISub(A)).redISub(_.redMul(O)));T=T.redIAdd(T),T=T.redIAdd(T),T=T.redIAdd(T);var C=this.z.redAdd(_).redSqr().redISub(l).redISub(O);return this.curve.jpoint(R,T,C)},o.prototype.mul=function(c,f){return c=new e(c,f),this.curve._wnafMul(this,c)},o.prototype.eq=function(c){if(c.type==="affine")return this.eq(c.toJ());if(this===c)return!0;var f=this.z.redSqr(),l=c.z.redSqr();if(this.x.redMul(l).redISub(c.x.redMul(f)).cmpn(0)!==0)return!1;var v=f.redMul(this.z),w=l.redMul(c.z);return this.y.redMul(w).redISub(c.y.redMul(v)).cmpn(0)===0},o.prototype.eqXToP=function(c){var f=this.z.redSqr(),l=c.toRed(this.curve.red).redMul(f);if(this.x.cmp(l)===0)return!0;for(var v=c.clone(),w=this.curve.redN.redMul(f);;){if(v.iadd(this.curve.n),v.cmp(this.curve.p)>=0)return!1;if(l.redIAdd(w),this.x.cmp(l)===0)return!0}},o.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},o.prototype.isInfinity=function(){return this.z.cmpn(0)===0},za}var ka,Qh;function Ly(){if(Qh)return ka;Qh=1;var r=Rr(),e=Zn(),t=sa(),i=Gt();function s(a){t.call(this,"mont",a),this.a=new r(a.a,16).toRed(this.red),this.b=new r(a.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}e(s,t),ka=s,s.prototype.validate=function(o){var h=o.normalize().x,c=h.redSqr(),f=c.redMul(h).redAdd(c.redMul(this.a)).redAdd(h),l=f.redSqrt();return l.redSqr().cmp(f)===0};function n(a,o,h){t.BasePoint.call(this,a,"projective"),o===null&&h===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(o,16),this.z=new r(h,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}return e(n,t.BasePoint),s.prototype.decodePoint=function(o,h){return this.point(i.toArray(o,h),1)},s.prototype.point=function(o,h){return new n(this,o,h)},s.prototype.pointFromJSON=function(o){return n.fromJSON(this,o)},n.prototype.precompute=function(){},n.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},n.fromJSON=function(o,h){return new n(o,h[0],h[1]||o.one)},n.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},n.prototype.isInfinity=function(){return this.z.cmpn(0)===0},n.prototype.dbl=function(){var o=this.x.redAdd(this.z),h=o.redSqr(),c=this.x.redSub(this.z),f=c.redSqr(),l=h.redSub(f),v=h.redMul(f),w=l.redMul(f.redAdd(this.curve.a24.redMul(l)));return this.curve.point(v,w)},n.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.diffAdd=function(o,h){var c=this.x.redAdd(this.z),f=this.x.redSub(this.z),l=o.x.redAdd(o.z),v=o.x.redSub(o.z),w=v.redMul(c),m=l.redMul(f),_=h.z.redMul(w.redAdd(m).redSqr()),O=h.x.redMul(w.redISub(m).redSqr());return this.curve.point(_,O)},n.prototype.mul=function(o){for(var h=o.clone(),c=this,f=this.curve.point(null,null),l=this,v=[];h.cmpn(0)!==0;h.iushrn(1))v.push(h.andln(1));for(var w=v.length-1;w>=0;w--)v[w]===0?(c=c.diffAdd(f,l),f=f.dbl()):(f=c.diffAdd(f,l),c=c.dbl());return f},n.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.eq=function(o){return this.getX().cmp(o.getX())===0},n.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},n.prototype.getX=function(){return this.normalize(),this.x.fromRed()},ka}var Ha,eu;function jy(){if(eu)return Ha;eu=1;var r=Gt(),e=Rr(),t=Zn(),i=sa(),s=r.assert;function n(o){this.twisted=(o.a|0)!==1,this.mOneA=this.twisted&&(o.a|0)===-1,this.extended=this.mOneA,i.call(this,"edwards",o),this.a=new e(o.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new e(o.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new e(o.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),s(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(o.c|0)===1}t(n,i),Ha=n,n.prototype._mulA=function(h){return this.mOneA?h.redNeg():this.a.redMul(h)},n.prototype._mulC=function(h){return this.oneC?h:this.c.redMul(h)},n.prototype.jpoint=function(h,c,f,l){return this.point(h,c,f,l)},n.prototype.pointFromX=function(h,c){h=new e(h,16),h.red||(h=h.toRed(this.red));var f=h.redSqr(),l=this.c2.redSub(this.a.redMul(f)),v=this.one.redSub(this.c2.redMul(this.d).redMul(f)),w=l.redMul(v.redInvm()),m=w.redSqrt();if(m.redSqr().redSub(w).cmp(this.zero)!==0)throw new Error("invalid point");var _=m.fromRed().isOdd();return(c&&!_||!c&&_)&&(m=m.redNeg()),this.point(h,m)},n.prototype.pointFromY=function(h,c){h=new e(h,16),h.red||(h=h.toRed(this.red));var f=h.redSqr(),l=f.redSub(this.c2),v=f.redMul(this.d).redMul(this.c2).redSub(this.a),w=l.redMul(v.redInvm());if(w.cmp(this.zero)===0){if(c)throw new Error("invalid point");return this.point(this.zero,h)}var m=w.redSqrt();if(m.redSqr().redSub(w).cmp(this.zero)!==0)throw new Error("invalid point");return m.fromRed().isOdd()!==c&&(m=m.redNeg()),this.point(m,h)},n.prototype.validate=function(h){if(h.isInfinity())return!0;h.normalize();var c=h.x.redSqr(),f=h.y.redSqr(),l=c.redMul(this.a).redAdd(f),v=this.c2.redMul(this.one.redAdd(this.d.redMul(c).redMul(f)));return l.cmp(v)===0};function a(o,h,c,f,l){i.BasePoint.call(this,o,"projective"),h===null&&c===null&&f===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new e(h,16),this.y=new e(c,16),this.z=f?new e(f,16):this.curve.one,this.t=l&&new e(l,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}return t(a,i.BasePoint),n.prototype.pointFromJSON=function(h){return a.fromJSON(this,h)},n.prototype.point=function(h,c,f,l){return new a(this,h,c,f,l)},a.fromJSON=function(h,c){return new a(h,c[0],c[1],c[2])},a.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},a.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},a.prototype._extDbl=function(){var h=this.x.redSqr(),c=this.y.redSqr(),f=this.z.redSqr();f=f.redIAdd(f);var l=this.curve._mulA(h),v=this.x.redAdd(this.y).redSqr().redISub(h).redISub(c),w=l.redAdd(c),m=w.redSub(f),_=l.redSub(c),O=v.redMul(m),D=w.redMul(_),A=v.redMul(_),M=m.redMul(w);return this.curve.point(O,D,M,A)},a.prototype._projDbl=function(){var h=this.x.redAdd(this.y).redSqr(),c=this.x.redSqr(),f=this.y.redSqr(),l,v,w,m,_,O;if(this.curve.twisted){m=this.curve._mulA(c);var D=m.redAdd(f);this.zOne?(l=h.redSub(c).redSub(f).redMul(D.redSub(this.curve.two)),v=D.redMul(m.redSub(f)),w=D.redSqr().redSub(D).redSub(D)):(_=this.z.redSqr(),O=D.redSub(_).redISub(_),l=h.redSub(c).redISub(f).redMul(O),v=D.redMul(m.redSub(f)),w=D.redMul(O))}else m=c.redAdd(f),_=this.curve._mulC(this.z).redSqr(),O=m.redSub(_).redSub(_),l=this.curve._mulC(h.redISub(m)).redMul(O),v=this.curve._mulC(m).redMul(c.redISub(f)),w=m.redMul(O);return this.curve.point(l,v,w)},a.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},a.prototype._extAdd=function(h){var c=this.y.redSub(this.x).redMul(h.y.redSub(h.x)),f=this.y.redAdd(this.x).redMul(h.y.redAdd(h.x)),l=this.t.redMul(this.curve.dd).redMul(h.t),v=this.z.redMul(h.z.redAdd(h.z)),w=f.redSub(c),m=v.redSub(l),_=v.redAdd(l),O=f.redAdd(c),D=w.redMul(m),A=_.redMul(O),M=w.redMul(O),R=m.redMul(_);return this.curve.point(D,A,R,M)},a.prototype._projAdd=function(h){var c=this.z.redMul(h.z),f=c.redSqr(),l=this.x.redMul(h.x),v=this.y.redMul(h.y),w=this.curve.d.redMul(l).redMul(v),m=f.redSub(w),_=f.redAdd(w),O=this.x.redAdd(this.y).redMul(h.x.redAdd(h.y)).redISub(l).redISub(v),D=c.redMul(m).redMul(O),A,M;return this.curve.twisted?(A=c.redMul(_).redMul(v.redSub(this.curve._mulA(l))),M=m.redMul(_)):(A=c.redMul(_).redMul(v.redSub(l)),M=this.curve._mulC(m).redMul(_)),this.curve.point(D,A,M)},a.prototype.add=function(h){return this.isInfinity()?h:h.isInfinity()?this:this.curve.extended?this._extAdd(h):this._projAdd(h)},a.prototype.mul=function(h){return this._hasDoubles(h)?this.curve._fixedNafMul(this,h):this.curve._wnafMul(this,h)},a.prototype.mulAdd=function(h,c,f){return this.curve._wnafMulAdd(1,[this,c],[h,f],2,!1)},a.prototype.jmulAdd=function(h,c,f){return this.curve._wnafMulAdd(1,[this,c],[h,f],2,!0)},a.prototype.normalize=function(){if(this.zOne)return this;var h=this.z.redInvm();return this.x=this.x.redMul(h),this.y=this.y.redMul(h),this.t&&(this.t=this.t.redMul(h)),this.z=this.curve.one,this.zOne=!0,this},a.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},a.prototype.getX=function(){return this.normalize(),this.x.fromRed()},a.prototype.getY=function(){return this.normalize(),this.y.fromRed()},a.prototype.eq=function(h){return this===h||this.getX().cmp(h.getX())===0&&this.getY().cmp(h.getY())===0},a.prototype.eqXToP=function(h){var c=h.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(c)===0)return!0;for(var f=h.clone(),l=this.curve.redN.redMul(this.z);;){if(f.iadd(this.curve.n),f.cmp(this.curve.p)>=0)return!1;if(c.redIAdd(l),this.x.cmp(c)===0)return!0}},a.prototype.toP=a.prototype.normalize,a.prototype.mixedAdd=a.prototype.add,Ha}var tu;function Ml(){return tu||(tu=1,function(r){var e=r;e.base=sa(),e.short=By(),e.mont=Ly(),e.edwards=jy()}(ja)),ja}var Ka={},Va={},_e={},ru;function _r(){if(ru)return _e;ru=1;var r=li(),e=Zn();_e.inherits=e;function t(u,p){return(u.charCodeAt(p)&64512)!==55296||p<0||p+1>=u.length?!1:(u.charCodeAt(p+1)&64512)===56320}function i(u,p){if(Array.isArray(u))return u.slice();if(!u)return[];var y=[];if(typeof u=="string")if(p){if(p==="hex")for(u=u.replace(/[^a-z0-9]+/ig,""),u.length%2!==0&&(u="0"+u),g=0;g<u.length;g+=2)y.push(parseInt(u[g]+u[g+1],16))}else for(var b=0,g=0;g<u.length;g++){var x=u.charCodeAt(g);x<128?y[b++]=x:x<2048?(y[b++]=x>>6|192,y[b++]=x&63|128):t(u,g)?(x=65536+((x&1023)<<10)+(u.charCodeAt(++g)&1023),y[b++]=x>>18|240,y[b++]=x>>12&63|128,y[b++]=x>>6&63|128,y[b++]=x&63|128):(y[b++]=x>>12|224,y[b++]=x>>6&63|128,y[b++]=x&63|128)}else for(g=0;g<u.length;g++)y[g]=u[g]|0;return y}_e.toArray=i;function s(u){for(var p="",y=0;y<u.length;y++)p+=o(u[y].toString(16));return p}_e.toHex=s;function n(u){var p=u>>>24|u>>>8&65280|u<<8&16711680|(u&255)<<24;return p>>>0}_e.htonl=n;function a(u,p){for(var y="",b=0;b<u.length;b++){var g=u[b];p==="little"&&(g=n(g)),y+=h(g.toString(16))}return y}_e.toHex32=a;function o(u){return u.length===1?"0"+u:u}_e.zero2=o;function h(u){return u.length===7?"0"+u:u.length===6?"00"+u:u.length===5?"000"+u:u.length===4?"0000"+u:u.length===3?"00000"+u:u.length===2?"000000"+u:u.length===1?"0000000"+u:u}_e.zero8=h;function c(u,p,y,b){var g=y-p;r(g%4===0);for(var x=new Array(g/4),$=0,E=p;$<x.length;$++,E+=4){var d;b==="big"?d=u[E]<<24|u[E+1]<<16|u[E+2]<<8|u[E+3]:d=u[E+3]<<24|u[E+2]<<16|u[E+1]<<8|u[E],x[$]=d>>>0}return x}_e.join32=c;function f(u,p){for(var y=new Array(u.length*4),b=0,g=0;b<u.length;b++,g+=4){var x=u[b];p==="big"?(y[g]=x>>>24,y[g+1]=x>>>16&255,y[g+2]=x>>>8&255,y[g+3]=x&255):(y[g+3]=x>>>24,y[g+2]=x>>>16&255,y[g+1]=x>>>8&255,y[g]=x&255)}return y}_e.split32=f;function l(u,p){return u>>>p|u<<32-p}_e.rotr32=l;function v(u,p){return u<<p|u>>>32-p}_e.rotl32=v;function w(u,p){return u+p>>>0}_e.sum32=w;function m(u,p,y){return u+p+y>>>0}_e.sum32_3=m;function _(u,p,y,b){return u+p+y+b>>>0}_e.sum32_4=_;function O(u,p,y,b,g){return u+p+y+b+g>>>0}_e.sum32_5=O;function D(u,p,y,b){var g=u[p],x=u[p+1],$=b+x>>>0,E=($<b?1:0)+y+g;u[p]=E>>>0,u[p+1]=$}_e.sum64=D;function A(u,p,y,b){var g=p+b>>>0,x=(g<p?1:0)+u+y;return x>>>0}_e.sum64_hi=A;function M(u,p,y,b){var g=p+b;return g>>>0}_e.sum64_lo=M;function R(u,p,y,b,g,x,$,E){var d=0,S=p;S=S+b>>>0,d+=S<p?1:0,S=S+x>>>0,d+=S<x?1:0,S=S+E>>>0,d+=S<E?1:0;var L=u+y+g+$+d;return L>>>0}_e.sum64_4_hi=R;function T(u,p,y,b,g,x,$,E){var d=p+b+x+E;return d>>>0}_e.sum64_4_lo=T;function C(u,p,y,b,g,x,$,E,d,S){var L=0,j=p;j=j+b>>>0,L+=j<p?1:0,j=j+x>>>0,L+=j<x?1:0,j=j+E>>>0,L+=j<E?1:0,j=j+S>>>0,L+=j<S?1:0;var U=u+y+g+$+d+L;return U>>>0}_e.sum64_5_hi=C;function q(u,p,y,b,g,x,$,E,d,S){var L=p+b+x+E+S;return L>>>0}_e.sum64_5_lo=q;function B(u,p,y){var b=p<<32-y|u>>>y;return b>>>0}_e.rotr64_hi=B;function N(u,p,y){var b=u<<32-y|p>>>y;return b>>>0}_e.rotr64_lo=N;function k(u,p,y){return u>>>y}_e.shr64_hi=k;function I(u,p,y){var b=u<<32-y|p>>>y;return b>>>0}return _e.shr64_lo=I,_e}var Wa={},iu;function Gs(){if(iu)return Wa;iu=1;var r=_r(),e=li();function t(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}return Wa.BlockHash=t,t.prototype.update=function(s,n){if(s=r.toArray(s,n),this.pending?this.pending=this.pending.concat(s):this.pending=s,this.pendingTotal+=s.length,this.pending.length>=this._delta8){s=this.pending;var a=s.length%this._delta8;this.pending=s.slice(s.length-a,s.length),this.pending.length===0&&(this.pending=null),s=r.join32(s,0,s.length-a,this.endian);for(var o=0;o<s.length;o+=this._delta32)this._update(s,o,o+this._delta32)}return this},t.prototype.digest=function(s){return this.update(this._pad()),e(this.pending===null),this._digest(s)},t.prototype._pad=function(){var s=this.pendingTotal,n=this._delta8,a=n-(s+this.padLength)%n,o=new Array(a+this.padLength);o[0]=128;for(var h=1;h<a;h++)o[h]=0;if(s<<=3,this.endian==="big"){for(var c=8;c<this.padLength;c++)o[h++]=0;o[h++]=0,o[h++]=0,o[h++]=0,o[h++]=0,o[h++]=s>>>24&255,o[h++]=s>>>16&255,o[h++]=s>>>8&255,o[h++]=s&255}else for(o[h++]=s&255,o[h++]=s>>>8&255,o[h++]=s>>>16&255,o[h++]=s>>>24&255,o[h++]=0,o[h++]=0,o[h++]=0,o[h++]=0,c=8;c<this.padLength;c++)o[h++]=0;return o},Wa}var ei={},fr={},su;function Cl(){if(su)return fr;su=1;var r=_r(),e=r.rotr32;function t(f,l,v,w){if(f===0)return i(l,v,w);if(f===1||f===3)return n(l,v,w);if(f===2)return s(l,v,w)}fr.ft_1=t;function i(f,l,v){return f&l^~f&v}fr.ch32=i;function s(f,l,v){return f&l^f&v^l&v}fr.maj32=s;function n(f,l,v){return f^l^v}fr.p32=n;function a(f){return e(f,2)^e(f,13)^e(f,22)}fr.s0_256=a;function o(f){return e(f,6)^e(f,11)^e(f,25)}fr.s1_256=o;function h(f){return e(f,7)^e(f,18)^f>>>3}fr.g0_256=h;function c(f){return e(f,17)^e(f,19)^f>>>10}return fr.g1_256=c,fr}var Ga,nu;function Uy(){if(nu)return Ga;nu=1;var r=_r(),e=Gs(),t=Cl(),i=r.rotl32,s=r.sum32,n=r.sum32_5,a=t.ft_1,o=e.BlockHash,h=[1518500249,1859775393,2400959708,3395469782];function c(){if(!(this instanceof c))return new c;o.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}return r.inherits(c,o),Ga=c,c.blockSize=512,c.outSize=160,c.hmacStrength=80,c.padLength=64,c.prototype._update=function(l,v){for(var w=this.W,m=0;m<16;m++)w[m]=l[v+m];for(;m<w.length;m++)w[m]=i(w[m-3]^w[m-8]^w[m-14]^w[m-16],1);var _=this.h[0],O=this.h[1],D=this.h[2],A=this.h[3],M=this.h[4];for(m=0;m<w.length;m++){var R=~~(m/20),T=n(i(_,5),a(R,O,D,A),M,w[m],h[R]);M=A,A=D,D=i(O,30),O=_,_=T}this.h[0]=s(this.h[0],_),this.h[1]=s(this.h[1],O),this.h[2]=s(this.h[2],D),this.h[3]=s(this.h[3],A),this.h[4]=s(this.h[4],M)},c.prototype._digest=function(l){return l==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},Ga}var Ja,au;function Rl(){if(au)return Ja;au=1;var r=_r(),e=Gs(),t=Cl(),i=li(),s=r.sum32,n=r.sum32_4,a=r.sum32_5,o=t.ch32,h=t.maj32,c=t.s0_256,f=t.s1_256,l=t.g0_256,v=t.g1_256,w=e.BlockHash,m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function _(){if(!(this instanceof _))return new _;w.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=m,this.W=new Array(64)}return r.inherits(_,w),Ja=_,_.blockSize=512,_.outSize=256,_.hmacStrength=192,_.padLength=64,_.prototype._update=function(D,A){for(var M=this.W,R=0;R<16;R++)M[R]=D[A+R];for(;R<M.length;R++)M[R]=n(v(M[R-2]),M[R-7],l(M[R-15]),M[R-16]);var T=this.h[0],C=this.h[1],q=this.h[2],B=this.h[3],N=this.h[4],k=this.h[5],I=this.h[6],u=this.h[7];for(i(this.k.length===M.length),R=0;R<M.length;R++){var p=a(u,f(N),o(N,k,I),this.k[R],M[R]),y=s(c(T),h(T,C,q));u=I,I=k,k=N,N=s(B,p),B=q,q=C,C=T,T=s(p,y)}this.h[0]=s(this.h[0],T),this.h[1]=s(this.h[1],C),this.h[2]=s(this.h[2],q),this.h[3]=s(this.h[3],B),this.h[4]=s(this.h[4],N),this.h[5]=s(this.h[5],k),this.h[6]=s(this.h[6],I),this.h[7]=s(this.h[7],u)},_.prototype._digest=function(D){return D==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},Ja}var Ya,ou;function zy(){if(ou)return Ya;ou=1;var r=_r(),e=Rl();function t(){if(!(this instanceof t))return new t;e.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}return r.inherits(t,e),Ya=t,t.blockSize=512,t.outSize=224,t.hmacStrength=192,t.padLength=64,t.prototype._digest=function(s){return s==="hex"?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")},Ya}var Xa,cu;function Tl(){if(cu)return Xa;cu=1;var r=_r(),e=Gs(),t=li(),i=r.rotr64_hi,s=r.rotr64_lo,n=r.shr64_hi,a=r.shr64_lo,o=r.sum64,h=r.sum64_hi,c=r.sum64_lo,f=r.sum64_4_hi,l=r.sum64_4_lo,v=r.sum64_5_hi,w=r.sum64_5_lo,m=e.BlockHash,_=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function O(){if(!(this instanceof O))return new O;m.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=_,this.W=new Array(160)}r.inherits(O,m),Xa=O,O.blockSize=1024,O.outSize=512,O.hmacStrength=192,O.padLength=128,O.prototype._prepareBlock=function(y,b){for(var g=this.W,x=0;x<32;x++)g[x]=y[b+x];for(;x<g.length;x+=2){var $=I(g[x-4],g[x-3]),E=u(g[x-4],g[x-3]),d=g[x-14],S=g[x-13],L=N(g[x-30],g[x-29]),j=k(g[x-30],g[x-29]),U=g[x-32],z=g[x-31];g[x]=f($,E,d,S,L,j,U,z),g[x+1]=l($,E,d,S,L,j,U,z)}},O.prototype._update=function(y,b){this._prepareBlock(y,b);var g=this.W,x=this.h[0],$=this.h[1],E=this.h[2],d=this.h[3],S=this.h[4],L=this.h[5],j=this.h[6],U=this.h[7],z=this.h[8],G=this.h[9],X=this.h[10],Z=this.h[11],Y=this.h[12],Q=this.h[13],Qe=this.h[14],re=this.h[15];t(this.k.length===g.length);for(var ie=0;ie<g.length;ie+=2){var nt=Qe,oe=re,fe=q(z,G),jt=B(z,G),xe=D(z,G,X,Z,Y),ye=A(z,G,X,Z,Y,Q),ar=this.k[ie],ge=this.k[ie+1],me=g[ie],or=g[ie+1],de=v(nt,oe,fe,jt,xe,ye,ar,ge,me,or),le=w(nt,oe,fe,jt,xe,ye,ar,ge,me,or);nt=T(x,$),oe=C(x,$),fe=M(x,$,E,d,S),jt=R(x,$,E,d,S,L);var cr=h(nt,oe,fe,jt),pe=c(nt,oe,fe,jt);Qe=Y,re=Q,Y=X,Q=Z,X=z,Z=G,z=h(j,U,de,le),G=c(U,U,de,le),j=S,U=L,S=E,L=d,E=x,d=$,x=h(de,le,cr,pe),$=c(de,le,cr,pe)}o(this.h,0,x,$),o(this.h,2,E,d),o(this.h,4,S,L),o(this.h,6,j,U),o(this.h,8,z,G),o(this.h,10,X,Z),o(this.h,12,Y,Q),o(this.h,14,Qe,re)},O.prototype._digest=function(y){return y==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")};function D(p,y,b,g,x){var $=p&b^~p&x;return $<0&&($+=4294967296),$}function A(p,y,b,g,x,$){var E=y&g^~y&$;return E<0&&(E+=4294967296),E}function M(p,y,b,g,x){var $=p&b^p&x^b&x;return $<0&&($+=4294967296),$}function R(p,y,b,g,x,$){var E=y&g^y&$^g&$;return E<0&&(E+=4294967296),E}function T(p,y){var b=i(p,y,28),g=i(y,p,2),x=i(y,p,7),$=b^g^x;return $<0&&($+=4294967296),$}function C(p,y){var b=s(p,y,28),g=s(y,p,2),x=s(y,p,7),$=b^g^x;return $<0&&($+=4294967296),$}function q(p,y){var b=i(p,y,14),g=i(p,y,18),x=i(y,p,9),$=b^g^x;return $<0&&($+=4294967296),$}function B(p,y){var b=s(p,y,14),g=s(p,y,18),x=s(y,p,9),$=b^g^x;return $<0&&($+=4294967296),$}function N(p,y){var b=i(p,y,1),g=i(p,y,8),x=n(p,y,7),$=b^g^x;return $<0&&($+=4294967296),$}function k(p,y){var b=s(p,y,1),g=s(p,y,8),x=a(p,y,7),$=b^g^x;return $<0&&($+=4294967296),$}function I(p,y){var b=i(p,y,19),g=i(y,p,29),x=n(p,y,6),$=b^g^x;return $<0&&($+=4294967296),$}function u(p,y){var b=s(p,y,19),g=s(y,p,29),x=a(p,y,6),$=b^g^x;return $<0&&($+=4294967296),$}return Xa}var Za,hu;function ky(){if(hu)return Za;hu=1;var r=_r(),e=Tl();function t(){if(!(this instanceof t))return new t;e.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}return r.inherits(t,e),Za=t,t.blockSize=1024,t.outSize=384,t.hmacStrength=192,t.padLength=128,t.prototype._digest=function(s){return s==="hex"?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")},Za}var uu;function Hy(){return uu||(uu=1,ei.sha1=Uy(),ei.sha224=zy(),ei.sha256=Rl(),ei.sha384=ky(),ei.sha512=Tl()),ei}var Qa={},fu;function Ky(){if(fu)return Qa;fu=1;var r=_r(),e=Gs(),t=r.rotl32,i=r.sum32,s=r.sum32_3,n=r.sum32_4,a=e.BlockHash;function o(){if(!(this instanceof o))return new o;a.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}r.inherits(o,a),Qa.ripemd160=o,o.blockSize=512,o.outSize=160,o.hmacStrength=192,o.padLength=64,o.prototype._update=function(O,D){for(var A=this.h[0],M=this.h[1],R=this.h[2],T=this.h[3],C=this.h[4],q=A,B=M,N=R,k=T,I=C,u=0;u<80;u++){var p=i(t(n(A,h(u,M,R,T),O[l[u]+D],c(u)),w[u]),C);A=C,C=T,T=t(R,10),R=M,M=p,p=i(t(n(q,h(79-u,B,N,k),O[v[u]+D],f(u)),m[u]),I),q=I,I=k,k=t(N,10),N=B,B=p}p=s(this.h[1],R,k),this.h[1]=s(this.h[2],T,I),this.h[2]=s(this.h[3],C,q),this.h[3]=s(this.h[4],A,B),this.h[4]=s(this.h[0],M,N),this.h[0]=p},o.prototype._digest=function(O){return O==="hex"?r.toHex32(this.h,"little"):r.split32(this.h,"little")};function h(_,O,D,A){return _<=15?O^D^A:_<=31?O&D|~O&A:_<=47?(O|~D)^A:_<=63?O&A|D&~A:O^(D|~A)}function c(_){return _<=15?0:_<=31?1518500249:_<=47?1859775393:_<=63?2400959708:2840853838}function f(_){return _<=15?1352829926:_<=31?1548603684:_<=47?1836072691:_<=63?2053994217:0}var l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],v=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],w=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],m=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];return Qa}var eo,du;function Vy(){if(du)return eo;du=1;var r=_r(),e=li();function t(i,s,n){if(!(this instanceof t))return new t(i,s,n);this.Hash=i,this.blockSize=i.blockSize/8,this.outSize=i.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(s,n))}return eo=t,t.prototype._init=function(s){s.length>this.blockSize&&(s=new this.Hash().update(s).digest()),e(s.length<=this.blockSize);for(var n=s.length;n<this.blockSize;n++)s.push(0);for(n=0;n<s.length;n++)s[n]^=54;for(this.inner=new this.Hash().update(s),n=0;n<s.length;n++)s[n]^=106;this.outer=new this.Hash().update(s)},t.prototype.update=function(s,n){return this.inner.update(s,n),this},t.prototype.digest=function(s){return this.outer.update(this.inner.digest()),this.outer.digest(s)},eo}var lu;function Pc(){return lu||(lu=1,function(r){var e=r;e.utils=_r(),e.common=Gs(),e.sha=Hy(),e.ripemd=Ky(),e.hmac=Vy(),e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160}(Va)),Va}var to,pu;function Wy(){return pu||(pu=1,to={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),to}var bu;function Oc(){return bu||(bu=1,function(r){var e=r,t=Pc(),i=Ml(),s=Gt(),n=s.assert;function a(c){c.type==="short"?this.curve=new i.short(c):c.type==="edwards"?this.curve=new i.edwards(c):this.curve=new i.mont(c),this.g=this.curve.g,this.n=this.curve.n,this.hash=c.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=a;function o(c,f){Object.defineProperty(e,c,{configurable:!0,enumerable:!0,get:function(){var l=new a(f);return Object.defineProperty(e,c,{configurable:!0,enumerable:!0,value:l}),l}})}o("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:t.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),o("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:t.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),o("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:t.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),o("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:t.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),o("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:t.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),o("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["9"]}),o("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var h;try{h=Wy()}catch{h=void 0}o("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:t.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",h]})}(Ka)),Ka}var ro,gu;function Gy(){if(gu)return ro;gu=1;var r=Pc(),e=Pl(),t=li();function i(s){if(!(this instanceof i))return new i(s);this.hash=s.hash,this.predResist=!!s.predResist,this.outLen=this.hash.outSize,this.minEntropy=s.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var n=e.toArray(s.entropy,s.entropyEnc||"hex"),a=e.toArray(s.nonce,s.nonceEnc||"hex"),o=e.toArray(s.pers,s.persEnc||"hex");t(n.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(n,a,o)}return ro=i,i.prototype._init=function(n,a,o){var h=n.concat(a).concat(o);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var c=0;c<this.V.length;c++)this.K[c]=0,this.V[c]=1;this._update(h),this._reseed=1,this.reseedInterval=281474976710656},i.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},i.prototype._update=function(n){var a=this._hmac().update(this.V).update([0]);n&&(a=a.update(n)),this.K=a.digest(),this.V=this._hmac().update(this.V).digest(),n&&(this.K=this._hmac().update(this.V).update([1]).update(n).digest(),this.V=this._hmac().update(this.V).digest())},i.prototype.reseed=function(n,a,o,h){typeof a!="string"&&(h=o,o=a,a=null),n=e.toArray(n,a),o=e.toArray(o,h),t(n.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(n.concat(o||[])),this._reseed=1},i.prototype.generate=function(n,a,o,h){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof a!="string"&&(h=o,o=a,a=null),o&&(o=e.toArray(o,h||"hex"),this._update(o));for(var c=[];c.length<n;)this.V=this._hmac().update(this.V).digest(),c=c.concat(this.V);var f=c.slice(0,n);return this._update(o),this._reseed++,e.encode(f,a)},ro}var io,vu;function Jy(){if(vu)return io;vu=1;var r=Rr(),e=Gt(),t=e.assert;function i(s,n){this.ec=s,this.priv=null,this.pub=null,n.priv&&this._importPrivate(n.priv,n.privEnc),n.pub&&this._importPublic(n.pub,n.pubEnc)}return io=i,i.fromPublic=function(n,a,o){return a instanceof i?a:new i(n,{pub:a,pubEnc:o})},i.fromPrivate=function(n,a,o){return a instanceof i?a:new i(n,{priv:a,privEnc:o})},i.prototype.validate=function(){var n=this.getPublic();return n.isInfinity()?{result:!1,reason:"Invalid public key"}:n.validate()?n.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},i.prototype.getPublic=function(n,a){return typeof n=="string"&&(a=n,n=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),a?this.pub.encode(a,n):this.pub},i.prototype.getPrivate=function(n){return n==="hex"?this.priv.toString(16,2):this.priv},i.prototype._importPrivate=function(n,a){this.priv=new r(n,a||16),this.priv=this.priv.umod(this.ec.curve.n)},i.prototype._importPublic=function(n,a){if(n.x||n.y){this.ec.curve.type==="mont"?t(n.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&t(n.x&&n.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(n.x,n.y);return}this.pub=this.ec.curve.decodePoint(n,a)},i.prototype.derive=function(n){return n.validate()||t(n.validate(),"public point not validated"),n.mul(this.priv).getX()},i.prototype.sign=function(n,a,o){return this.ec.sign(n,this,a,o)},i.prototype.verify=function(n,a,o){return this.ec.verify(n,a,this,void 0,o)},i.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"},io}var so,yu;function Yy(){if(yu)return so;yu=1;var r=Rr(),e=Gt(),t=e.assert;function i(h,c){if(h instanceof i)return h;this._importDER(h,c)||(t(h.r&&h.s,"Signature without r or s"),this.r=new r(h.r,16),this.s=new r(h.s,16),h.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=h.recoveryParam)}so=i;function s(){this.place=0}function n(h,c){var f=h[c.place++];if(!(f&128))return f;var l=f&15;if(l===0||l>4||h[c.place]===0)return!1;for(var v=0,w=0,m=c.place;w<l;w++,m++)v<<=8,v|=h[m],v>>>=0;return v<=127?!1:(c.place=m,v)}function a(h){for(var c=0,f=h.length-1;!h[c]&&!(h[c+1]&128)&&c<f;)c++;return c===0?h:h.slice(c)}i.prototype._importDER=function(c,f){c=e.toArray(c,f);var l=new s;if(c[l.place++]!==48)return!1;var v=n(c,l);if(v===!1||v+l.place!==c.length||c[l.place++]!==2)return!1;var w=n(c,l);if(w===!1||(c[l.place]&128)!==0)return!1;var m=c.slice(l.place,w+l.place);if(l.place+=w,c[l.place++]!==2)return!1;var _=n(c,l);if(_===!1||c.length!==_+l.place||(c[l.place]&128)!==0)return!1;var O=c.slice(l.place,_+l.place);if(m[0]===0)if(m[1]&128)m=m.slice(1);else return!1;if(O[0]===0)if(O[1]&128)O=O.slice(1);else return!1;return this.r=new r(m),this.s=new r(O),this.recoveryParam=null,!0};function o(h,c){if(c<128){h.push(c);return}var f=1+(Math.log(c)/Math.LN2>>>3);for(h.push(f|128);--f;)h.push(c>>>(f<<3)&255);h.push(c)}return i.prototype.toDER=function(c){var f=this.r.toArray(),l=this.s.toArray();for(f[0]&128&&(f=[0].concat(f)),l[0]&128&&(l=[0].concat(l)),f=a(f),l=a(l);!l[0]&&!(l[1]&128);)l=l.slice(1);var v=[2];o(v,f.length),v=v.concat(f),v.push(2),o(v,l.length);var w=v.concat(l),m=[48];return o(m,w.length),m=m.concat(w),e.encode(m,c)},so}var no,mu;function Xy(){if(mu)return no;mu=1;var r=Rr(),e=Gy(),t=Gt(),i=Oc(),s=Ol(),n=t.assert,a=Jy(),o=Yy();function h(c){if(!(this instanceof h))return new h(c);typeof c=="string"&&(n(Object.prototype.hasOwnProperty.call(i,c),"Unknown curve "+c),c=i[c]),c instanceof i.PresetCurve&&(c={curve:c}),this.curve=c.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=c.curve.g,this.g.precompute(c.curve.n.bitLength()+1),this.hash=c.hash||c.curve.hash}return no=h,h.prototype.keyPair=function(f){return new a(this,f)},h.prototype.keyFromPrivate=function(f,l){return a.fromPrivate(this,f,l)},h.prototype.keyFromPublic=function(f,l){return a.fromPublic(this,f,l)},h.prototype.genKeyPair=function(f){f||(f={});for(var l=new e({hash:this.hash,pers:f.pers,persEnc:f.persEnc||"utf8",entropy:f.entropy||s(this.hash.hmacStrength),entropyEnc:f.entropy&&f.entropyEnc||"utf8",nonce:this.n.toArray()}),v=this.n.byteLength(),w=this.n.sub(new r(2));;){var m=new r(l.generate(v));if(!(m.cmp(w)>0))return m.iaddn(1),this.keyFromPrivate(m)}},h.prototype._truncateToN=function(f,l,v){var w;if(r.isBN(f)||typeof f=="number")f=new r(f,16),w=f.byteLength();else if(typeof f=="object")w=f.length,f=new r(f,16);else{var m=f.toString();w=m.length+1>>>1,f=new r(m,16)}typeof v!="number"&&(v=w*8);var _=v-this.n.bitLength();return _>0&&(f=f.ushrn(_)),!l&&f.cmp(this.n)>=0?f.sub(this.n):f},h.prototype.sign=function(f,l,v,w){if(typeof v=="object"&&(w=v,v=null),w||(w={}),typeof f!="string"&&typeof f!="number"&&!r.isBN(f)){n(typeof f=="object"&&f&&typeof f.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),n(f.length>>>0===f.length);for(var m=0;m<f.length;m++)n((f[m]&255)===f[m])}l=this.keyFromPrivate(l,v),f=this._truncateToN(f,!1,w.msgBitLength),n(!f.isNeg(),"Can not sign a negative message");var _=this.n.byteLength(),O=l.getPrivate().toArray("be",_),D=f.toArray("be",_);n(new r(D).eq(f),"Can not sign message");for(var A=new e({hash:this.hash,entropy:O,nonce:D,pers:w.pers,persEnc:w.persEnc||"utf8"}),M=this.n.sub(new r(1)),R=0;;R++){var T=w.k?w.k(R):new r(A.generate(this.n.byteLength()));if(T=this._truncateToN(T,!0),!(T.cmpn(1)<=0||T.cmp(M)>=0)){var C=this.g.mul(T);if(!C.isInfinity()){var q=C.getX(),B=q.umod(this.n);if(B.cmpn(0)!==0){var N=T.invm(this.n).mul(B.mul(l.getPrivate()).iadd(f));if(N=N.umod(this.n),N.cmpn(0)!==0){var k=(C.getY().isOdd()?1:0)|(q.cmp(B)!==0?2:0);return w.canonical&&N.cmp(this.nh)>0&&(N=this.n.sub(N),k^=1),new o({r:B,s:N,recoveryParam:k})}}}}}},h.prototype.verify=function(f,l,v,w,m){m||(m={}),f=this._truncateToN(f,!1,m.msgBitLength),v=this.keyFromPublic(v,w),l=new o(l,"hex");var _=l.r,O=l.s;if(_.cmpn(1)<0||_.cmp(this.n)>=0||O.cmpn(1)<0||O.cmp(this.n)>=0)return!1;var D=O.invm(this.n),A=D.mul(f).umod(this.n),M=D.mul(_).umod(this.n),R;return this.curve._maxwellTrick?(R=this.g.jmulAdd(A,v.getPublic(),M),R.isInfinity()?!1:R.eqXToP(_)):(R=this.g.mulAdd(A,v.getPublic(),M),R.isInfinity()?!1:R.getX().umod(this.n).cmp(_)===0)},h.prototype.recoverPubKey=function(c,f,l,v){n((3&l)===l,"The recovery param is more than two bits"),f=new o(f,v);var w=this.n,m=new r(c),_=f.r,O=f.s,D=l&1,A=l>>1;if(_.cmp(this.curve.p.umod(this.curve.n))>=0&&A)throw new Error("Unable to find sencond key candinate");A?_=this.curve.pointFromX(_.add(this.curve.n),D):_=this.curve.pointFromX(_,D);var M=f.r.invm(w),R=w.sub(m).mul(M).umod(w),T=O.mul(M).umod(w);return this.g.mulAdd(R,_,T)},h.prototype.getKeyRecoveryParam=function(c,f,l,v){if(f=new o(f,v),f.recoveryParam!==null)return f.recoveryParam;for(var w=0;w<4;w++){var m;try{m=this.recoverPubKey(c,f,w)}catch{continue}if(m.eq(l))return w}throw new Error("Unable to find valid recovery factor")},no}var ao,wu;function Zy(){if(wu)return ao;wu=1;var r=Gt(),e=r.assert,t=r.parseBytes,i=r.cachedProperty;function s(n,a){this.eddsa=n,this._secret=t(a.secret),n.isPoint(a.pub)?this._pub=a.pub:this._pubBytes=t(a.pub)}return s.fromPublic=function(a,o){return o instanceof s?o:new s(a,{pub:o})},s.fromSecret=function(a,o){return o instanceof s?o:new s(a,{secret:o})},s.prototype.secret=function(){return this._secret},i(s,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),i(s,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),i(s,"privBytes",function(){var a=this.eddsa,o=this.hash(),h=a.encodingLength-1,c=o.slice(0,a.encodingLength);return c[0]&=248,c[h]&=127,c[h]|=64,c}),i(s,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),i(s,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),i(s,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),s.prototype.sign=function(a){return e(this._secret,"KeyPair can only verify"),this.eddsa.sign(a,this)},s.prototype.verify=function(a,o){return this.eddsa.verify(a,o,this)},s.prototype.getSecret=function(a){return e(this._secret,"KeyPair is public only"),r.encode(this.secret(),a)},s.prototype.getPublic=function(a){return r.encode(this.pubBytes(),a)},ao=s,ao}var oo,_u;function Qy(){if(_u)return oo;_u=1;var r=Rr(),e=Gt(),t=e.assert,i=e.cachedProperty,s=e.parseBytes;function n(a,o){this.eddsa=a,typeof o!="object"&&(o=s(o)),Array.isArray(o)&&(t(o.length===a.encodingLength*2,"Signature has invalid size"),o={R:o.slice(0,a.encodingLength),S:o.slice(a.encodingLength)}),t(o.R&&o.S,"Signature without R or S"),a.isPoint(o.R)&&(this._R=o.R),o.S instanceof r&&(this._S=o.S),this._Rencoded=Array.isArray(o.R)?o.R:o.Rencoded,this._Sencoded=Array.isArray(o.S)?o.S:o.Sencoded}return i(n,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),i(n,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),i(n,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),i(n,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),n.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},n.prototype.toHex=function(){return e.encode(this.toBytes(),"hex").toUpperCase()},oo=n,oo}var co,Eu;function em(){if(Eu)return co;Eu=1;var r=Pc(),e=Oc(),t=Gt(),i=t.assert,s=t.parseBytes,n=Zy(),a=Qy();function o(h){if(i(h==="ed25519","only tested with ed25519 so far"),!(this instanceof o))return new o(h);h=e[h].curve,this.curve=h,this.g=h.g,this.g.precompute(h.n.bitLength()+1),this.pointClass=h.point().constructor,this.encodingLength=Math.ceil(h.n.bitLength()/8),this.hash=r.sha512}return co=o,o.prototype.sign=function(c,f){c=s(c);var l=this.keyFromSecret(f),v=this.hashInt(l.messagePrefix(),c),w=this.g.mul(v),m=this.encodePoint(w),_=this.hashInt(m,l.pubBytes(),c).mul(l.priv()),O=v.add(_).umod(this.curve.n);return this.makeSignature({R:w,S:O,Rencoded:m})},o.prototype.verify=function(c,f,l){if(c=s(c),f=this.makeSignature(f),f.S().gte(f.eddsa.curve.n)||f.S().isNeg())return!1;var v=this.keyFromPublic(l),w=this.hashInt(f.Rencoded(),v.pubBytes(),c),m=this.g.mul(f.S()),_=f.R().add(v.pub().mul(w));return _.eq(m)},o.prototype.hashInt=function(){for(var c=this.hash(),f=0;f<arguments.length;f++)c.update(arguments[f]);return t.intFromLE(c.digest()).umod(this.curve.n)},o.prototype.keyFromPublic=function(c){return n.fromPublic(this,c)},o.prototype.keyFromSecret=function(c){return n.fromSecret(this,c)},o.prototype.makeSignature=function(c){return c instanceof a?c:new a(this,c)},o.prototype.encodePoint=function(c){var f=c.getY().toArray("le",this.encodingLength);return f[this.encodingLength-1]|=c.getX().isOdd()?128:0,f},o.prototype.decodePoint=function(c){c=t.parseBytes(c);var f=c.length-1,l=c.slice(0,f).concat(c[f]&-129),v=(c[f]&128)!==0,w=t.intFromLE(l);return this.curve.pointFromY(w,v)},o.prototype.encodeInt=function(c){return c.toArray("le",this.encodingLength)},o.prototype.decodeInt=function(c){return t.intFromLE(c)},o.prototype.isPoint=function(c){return c instanceof this.pointClass},co}var xu;function tm(){return xu||(xu=1,function(r){var e=r;e.version=Fy.version,e.utils=Gt(),e.rand=Ol(),e.curve=Ml(),e.curves=Oc(),e.ec=Xy(),e.eddsa=em()}(Fa)),Fa}var rm=tm();const im={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var sm={};const nm=":";function Vi(r){const[e,t]=r.split(nm);return{namespace:e,reference:t}}function Su(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function Nl(r,e){return r.includes(":")?[r]:e.chains||[]}const am="ReactNative",qt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},om="js";function kn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Wr(){return!ci.getDocument()&&!!ci.getNavigator()&&navigator.product===am}function cm(){return Wr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function hm(){return Wr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Js(){return!kn()&&!!ci.getNavigator()&&!!ci.getDocument()}function Ys(){return Wr()?qt.reactNative:kn()?qt.node:Js()?qt.browser:qt.unknown}function $u(){var r;try{return Wr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function um(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&t.set(i,s)}return t.toString()}function Fl(){return A1.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function fm(){if(Ys()===qt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=V0();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function dm(){var r;const e=Ys();return e===qt.browser?[e,((r=ci.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function ql(r,e,t){const i=fm(),s=dm();return[[r,e].join("-"),[om,t].join("-"),i,s].join("/")}function lm({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:a,bundleId:o,packageName:h}){const c=t.split("?"),f=ql(r,e,i),l={auth:s,ua:f,projectId:n,useOnCloseEvent:a,packageName:h||void 0,bundleId:o||void 0},v=um(c[1]||"",l);return c[0]+"?"+v}function ai(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Bl(r){return Object.fromEntries(r.entries())}function Ll(r){return new Map(Object.entries(r))}function ii(r=V.FIVE_MINUTES,e){const t=V.toMiliseconds(r||V.FIVE_MINUTES);let i,s,n,a;return{resolve:o=>{n&&i&&(clearTimeout(n),i(o),a=Promise.resolve(o))},reject:o=>{n&&s&&(clearTimeout(n),s(o))},done:()=>new Promise((o,h)=>{if(a)return o(a);n=setTimeout(()=>{const c=new Error(e);a=Promise.reject(c),h(c)},t),i=o,s=h})}}function kr(r,e,t){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const a=await r;i(a)}catch(a){s(a)}clearTimeout(n)})}function jl(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function pm(r){return jl("topic",r)}function bm(r){return jl("id",r)}function Ul(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function it(r,e){return V.fromMiliseconds(Date.now()+V.toMiliseconds(r))}function zr(r){return Date.now()>=V.toMiliseconds(r)}function be(r,e){return`${r}${e?`:${e}`:""}`}function Nn(r=[],e=[]){return[...new Set([...r,...e])]}async function gm({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s==null?void 0:s.href;if(typeof n!="string")return;const a=vm(n,r,e),o=Ys();if(o===qt.browser){if(!((i=ci.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}ym(a)}else o===qt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(a)}catch(s){console.error(s)}}function vm(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const n=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Em(i,!0)}`}else s=`${s}/wc?${i}`;return s}function ym(r){let e="_self";_m()?e="_top":(wm()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function mm(r,e){let t="";try{if(Js()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(i){console.error(i)}return t}function Iu(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function Du(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function Mc(){return typeof process<"u"&&sm.IS_VITEST==="true"}function wm(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function _m(){try{return window.self!==window.top}catch{return!1}}function Em(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function zl(r){return Buffer.from(r,"base64").toString("utf-8")}function xm(r){return new Promise(e=>setTimeout(e,r))}function Us(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Sm(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function na(r,...e){if(!Sm(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Cc(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Us(r.outputLen),Us(r.blockLen)}function Wi(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function kl(r,e){na(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const _n=BigInt(2**32-1),Au=BigInt(32);function $m(r,e=!1){return e?{h:Number(r&_n),l:Number(r>>Au&_n)}:{h:Number(r>>Au&_n)|0,l:Number(r&_n)|0}}function Im(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:a}=$m(r[s],e);[t[s],i[s]]=[n,a]}return[t,i]}const Dm=(r,e,t)=>r<<t|e>>>32-t,Am=(r,e,t)=>e<<t|r>>>32-t,Pm=(r,e,t)=>e<<t-32|r>>>64-t,Om=(r,e,t)=>r<<t-32|e>>>64-t,xi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Mm(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function ho(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function dr(r,e){return r<<32-e|r>>>e}const Pu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Cm(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function Ou(r){for(let e=0;e<r.length;e++)r[e]=Cm(r[e])}function Rm(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Gi(r){return typeof r=="string"&&(r=Rm(r)),na(r),r}let Rc=class{clone(){return this._cloneInto()}};function Hl(r){const e=i=>r().update(Gi(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Xs(r=32){if(xi&&typeof xi.getRandomValues=="function")return xi.getRandomValues(new Uint8Array(r));if(xi&&typeof xi.randomBytes=="function")return xi.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const Kl=[],Vl=[],Wl=[],Tm=BigInt(0),$s=BigInt(1),Nm=BigInt(2),Fm=BigInt(7),qm=BigInt(256),Bm=BigInt(113);for(let r=0,e=$s,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Kl.push(2*(5*i+t)),Vl.push((r+1)*(r+2)/2%64);let s=Tm;for(let n=0;n<7;n++)e=(e<<$s^(e>>Fm)*Bm)%qm,e&Nm&&(s^=$s<<($s<<BigInt(n))-$s);Wl.push(s)}const[Lm,jm]=Im(Wl,!0),Mu=(r,e,t)=>t>32?Pm(r,e,t):Dm(r,e,t),Cu=(r,e,t)=>t>32?Om(r,e,t):Am(r,e,t);function Um(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)t[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,h=(a+2)%10,c=t[h],f=t[h+1],l=Mu(c,f,1)^t[o],v=Cu(c,f,1)^t[o+1];for(let w=0;w<50;w+=10)r[a+w]^=l,r[a+w+1]^=v}let s=r[2],n=r[3];for(let a=0;a<24;a++){const o=Vl[a],h=Mu(s,n,o),c=Cu(s,n,o),f=Kl[a];s=r[f],n=r[f+1],r[f]=h,r[f+1]=c}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=r[a+o];for(let o=0;o<10;o++)r[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}r[0]^=Lm[i],r[1]^=jm[i]}t.fill(0)}let zm=class Gl extends Rc{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Us(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Mm(this.state)}keccak(){Pu||Ou(this.state32),Um(this.state32,this.rounds),Pu||Ou(this.state32),this.posOut=0,this.pos=0}update(e){Wi(this);const{blockLen:t,state:i}=this;e=Gi(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(t-this.pos,s-n);for(let o=0;o<a;o++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Wi(this,!1),na(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Us(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(kl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:a}=this;return e||(e=new Gl(t,i,s,a,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}};const km=(r,e,t)=>Hl(()=>new zm(e,r,t)),Hm=km(1,136,256/8),Km="https://rpc.walletconnect.org/v1";function Jl(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(Hm(t)).toString("hex")}async function Vm(r,e,t,i,s,n){switch(t.t){case"eip191":return await Wm(r,e,t.s);case"eip1271":return await Gm(r,e,t.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function Wm(r,e,t){return(await V1({hash:Jl(e),signature:t})).toLowerCase()===r.toLowerCase()}async function Gm(r,e,t,i,s,n){const a=Vi(i);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const o="0x1626ba7e",h="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",f=t.substring(2),l=Jl(e).substring(2),v=o+l+h+c+f,w=await fetch(`${n||Km}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:Jm(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:v},"latest"]})}),{result:m}=await w.json();return m?m.slice(0,o.length).toLowerCase()===o.toLowerCase():!1}catch(o){return console.error("isValidEip1271Signature: ",o),!1}}function Jm(){return Date.now()+Math.floor(Math.random()*1e3)}var Ym=Object.defineProperty,Xm=Object.defineProperties,Zm=Object.getOwnPropertyDescriptors,Ru=Object.getOwnPropertySymbols,Qm=Object.prototype.hasOwnProperty,e2=Object.prototype.propertyIsEnumerable,Tu=(r,e,t)=>e in r?Ym(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,t2=(r,e)=>{for(var t in e||(e={}))Qm.call(e,t)&&Tu(r,t,e[t]);if(Ru)for(var t of Ru(e))e2.call(e,t)&&Tu(r,t,e[t]);return r},r2=(r,e)=>Xm(r,Zm(e));const i2="did:pkh:",Tc=r=>r==null?void 0:r.split(":"),s2=r=>{const e=r&&Tc(r);if(e)return r.includes(i2)?e[3]:e[1]},Ko=r=>{const e=r&&Tc(r);if(e)return e[2]+":"+e[3]},Hn=r=>{const e=r&&Tc(r);if(e)return e.pop()};async function Nu(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,n=Yl(s,s.iss),a=Hn(s.iss);return await Vm(a,n,i,Ko(s.iss),t)}const Yl=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=Hn(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const n=`URI: ${r.aud||r.uri}`,a=`Version: ${r.version}`,o=`Chain ID: ${s2(e)}`,h=`Nonce: ${r.nonce}`,c=`Issued At: ${r.iat}`,f=r.exp?`Expiration Time: ${r.exp}`:void 0,l=r.nbf?`Not Before: ${r.nbf}`:void 0,v=r.requestId?`Request ID: ${r.requestId}`:void 0,w=r.resources?`Resources:${r.resources.map(_=>`
- ${_}`).join("")}`:void 0,m=Fn(r.resources);if(m){const _=zs(m);s=l2(s,_)}return[t,i,"",s,"",n,a,o,h,c,f,l,v,w].filter(_=>_!=null).join(`
`)};function n2(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function a2(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function fi(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(a=>{if(typeof a!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${a}`)})})})}function o2(r,e,t,i={}){return t==null||t.sort((s,n)=>s.localeCompare(n)),{att:{[r]:c2(e,t,i)}}}function c2(r,e,t={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function Xl(r){return fi(r),`urn:recap:${n2(r).replace(/=/g,"")}`}function zs(r){const e=a2(r.replace("urn:recap:",""));return fi(e),e}function h2(r,e,t){const i=o2(r,e,t);return Xl(i)}function u2(r){return r&&r.includes("urn:recap:")}function f2(r,e){const t=zs(r),i=zs(e),s=d2(t,i);return Xl(s)}function d2(r,e){fi(r),fi(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return t.forEach(s=>{var n,a;Object.keys(((n=r.att)==null?void 0:n[s])||{}).concat(Object.keys(((a=e.att)==null?void 0:a[s])||{})).sort((o,h)=>o.localeCompare(h)).forEach(o=>{var h,c;i.att[s]=r2(t2({},i.att[s]),{[o]:((h=r.att[s])==null?void 0:h[o])||((c=e.att[s])==null?void 0:c[o])})})}),i}function l2(r="",e){fi(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(o=>{const h=Object.keys(e.att[o]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));h.sort((l,v)=>l.action.localeCompare(v.action));const c={};h.forEach(l=>{c[l.ability]||(c[l.ability]=[]),c[l.ability].push(l.action)});const f=Object.keys(c).map(l=>(s++,`(${s}) '${l}': '${c[l].join("', '")}' for '${o}'.`));i.push(f.join(", ").replace(".,","."))});const n=i.join(" "),a=`${t}${n}`;return`${r?r+" ":""}${a}`}function Fu(r){var e;const t=zs(r);fi(t);const i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function qu(r){const e=zs(r);fi(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function Fn(r){if(!r)return;const e=r==null?void 0:r[r.length-1];return u2(e)?e:void 0}function uo(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Zl(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ft(r,...e){if(!Zl(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Bu(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function p2(r,e){Ft(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Lu(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}const Vr=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),b2=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),g2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!g2)throw new Error("Non little-endian hardware is not supported");function v2(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Vo(r){if(typeof r=="string")r=v2(r);else if(Zl(r))r=Wo(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function y2(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function m2(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}const w2=(r,e)=>{function t(i,...s){if(Ft(i),r.nonceLength!==void 0){const c=s[0];if(!c)throw new Error("nonce / iv required");r.varSizeNonce?Ft(c):Ft(c,r.nonceLength)}const n=r.tagLength;n&&s[1]!==void 0&&Ft(s[1]);const a=e(i,...s),o=(c,f)=>{if(f!==void 0){if(c!==2)throw new Error("cipher output not supported");Ft(f)}};let h=!1;return{encrypt(c,f){if(h)throw new Error("cannot encrypt() twice with same key + nonce");return h=!0,Ft(c),o(a.encrypt.length,f),a.encrypt(c,f)},decrypt(c,f){if(Ft(c),n&&c.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return o(a.decrypt.length,f),a.decrypt(c,f)}}}return Object.assign(t,r),t};function ju(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!_2(e))throw new Error("invalid output, must be aligned");return e}function Uu(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n);r.setUint32(e+4,a,i),r.setUint32(e+0,o,i)}function _2(r){return r.byteOffset%4===0}function Wo(r){return Uint8Array.from(r)}function Ji(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const Ql=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),E2=Ql("expand 16-byte k"),x2=Ql("expand 32-byte k"),S2=Vr(E2),$2=Vr(x2);function ce(r,e){return r<<e|r>>>32-e}function Go(r){return r.byteOffset%4===0}const En=64,I2=16,ep=2**32-1,zu=new Uint32Array;function D2(r,e,t,i,s,n,a,o){const h=s.length,c=new Uint8Array(En),f=Vr(c),l=Go(s)&&Go(n),v=l?Vr(s):zu,w=l?Vr(n):zu;for(let m=0;m<h;a++){if(r(e,t,i,f,a,o),a>=ep)throw new Error("arx: counter overflow");const _=Math.min(En,h-m);if(l&&_===En){const O=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let D=0,A;D<I2;D++)A=O+D,w[A]=v[A]^f[D];m+=En;continue}for(let O=0,D;O<_;O++)D=m+O,n[D]=s[D]^c[O];m+=_}}function A2(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:n,rounds:a}=y2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return uo(s),uo(a),Lu(n),Lu(t),(o,h,c,f,l=0)=>{Ft(o),Ft(h),Ft(c);const v=c.length;if(f===void 0&&(f=new Uint8Array(v)),Ft(f),uo(l),l<0||l>=ep)throw new Error("arx: counter overflow");if(f.length<v)throw new Error(`arx: output (${f.length}) is shorter than data (${v})`);const w=[];let m=o.length,_,O;if(m===32)w.push(_=Wo(o)),O=$2;else if(m===16&&t)_=new Uint8Array(32),_.set(o),_.set(o,16),O=S2,w.push(_);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);Go(h)||w.push(h=Wo(h));const D=Vr(_);if(i){if(h.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(O,D,Vr(h.subarray(0,16)),D),h=h.subarray(16)}const A=16-s;if(A!==h.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){const R=new Uint8Array(12);R.set(h,n?0:12-h.length),h=R,w.push(h)}const M=Vr(h);return D2(r,O,D,M,c,f,l,a),Ji(...w),f}}const lt=(r,e)=>r[e++]&255|(r[e++]&255)<<8;let P2=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Vo(e),Ft(e,32);const t=lt(e,0),i=lt(e,2),s=lt(e,4),n=lt(e,6),a=lt(e,8),o=lt(e,10),h=lt(e,12),c=lt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|o<<2)&8191,this.r[7]=(o>>>11|h<<5)&8065,this.r[8]=(h>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let f=0;f<8;f++)this.pad[f]=lt(e,16+2*f)}process(e,t,i=!1){const s=i?0:2048,{h:n,r:a}=this,o=a[0],h=a[1],c=a[2],f=a[3],l=a[4],v=a[5],w=a[6],m=a[7],_=a[8],O=a[9],D=lt(e,t+0),A=lt(e,t+2),M=lt(e,t+4),R=lt(e,t+6),T=lt(e,t+8),C=lt(e,t+10),q=lt(e,t+12),B=lt(e,t+14);let N=n[0]+(D&8191),k=n[1]+((D>>>13|A<<3)&8191),I=n[2]+((A>>>10|M<<6)&8191),u=n[3]+((M>>>7|R<<9)&8191),p=n[4]+((R>>>4|T<<12)&8191),y=n[5]+(T>>>1&8191),b=n[6]+((T>>>14|C<<2)&8191),g=n[7]+((C>>>11|q<<5)&8191),x=n[8]+((q>>>8|B<<8)&8191),$=n[9]+(B>>>5|s),E=0,d=E+N*o+k*(5*O)+I*(5*_)+u*(5*m)+p*(5*w);E=d>>>13,d&=8191,d+=y*(5*v)+b*(5*l)+g*(5*f)+x*(5*c)+$*(5*h),E+=d>>>13,d&=8191;let S=E+N*h+k*o+I*(5*O)+u*(5*_)+p*(5*m);E=S>>>13,S&=8191,S+=y*(5*w)+b*(5*v)+g*(5*l)+x*(5*f)+$*(5*c),E+=S>>>13,S&=8191;let L=E+N*c+k*h+I*o+u*(5*O)+p*(5*_);E=L>>>13,L&=8191,L+=y*(5*m)+b*(5*w)+g*(5*v)+x*(5*l)+$*(5*f),E+=L>>>13,L&=8191;let j=E+N*f+k*c+I*h+u*o+p*(5*O);E=j>>>13,j&=8191,j+=y*(5*_)+b*(5*m)+g*(5*w)+x*(5*v)+$*(5*l),E+=j>>>13,j&=8191;let U=E+N*l+k*f+I*c+u*h+p*o;E=U>>>13,U&=8191,U+=y*(5*O)+b*(5*_)+g*(5*m)+x*(5*w)+$*(5*v),E+=U>>>13,U&=8191;let z=E+N*v+k*l+I*f+u*c+p*h;E=z>>>13,z&=8191,z+=y*o+b*(5*O)+g*(5*_)+x*(5*m)+$*(5*w),E+=z>>>13,z&=8191;let G=E+N*w+k*v+I*l+u*f+p*c;E=G>>>13,G&=8191,G+=y*h+b*o+g*(5*O)+x*(5*_)+$*(5*m),E+=G>>>13,G&=8191;let X=E+N*m+k*w+I*v+u*l+p*f;E=X>>>13,X&=8191,X+=y*c+b*h+g*o+x*(5*O)+$*(5*_),E+=X>>>13,X&=8191;let Z=E+N*_+k*m+I*w+u*v+p*l;E=Z>>>13,Z&=8191,Z+=y*f+b*c+g*h+x*o+$*(5*O),E+=Z>>>13,Z&=8191;let Y=E+N*O+k*_+I*m+u*w+p*v;E=Y>>>13,Y&=8191,Y+=y*l+b*f+g*c+x*h+$*o,E+=Y>>>13,Y&=8191,E=(E<<2)+E|0,E=E+d|0,d=E&8191,E=E>>>13,S+=E,n[0]=d,n[1]=S,n[2]=L,n[3]=j,n[4]=U,n[5]=z,n[6]=G,n[7]=X,n[8]=Z,n[9]=Y}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=s,s=e[o]>>>13,e[o]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let n=(s^1)-1;for(let o=0;o<10;o++)i[o]&=n;n=~n;for(let o=0;o<10;o++)e[o]=e[o]&n|i[o];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+t[0];e[0]=a&65535;for(let o=1;o<8;o++)a=(e[o]+t[o]|0)+(a>>>16)|0,e[o]=a&65535;Ji(i)}update(e){Bu(this);const{buffer:t,blockLen:i}=this;e=Vo(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(i-this.pos,s-n);if(a===i){for(;i<=s-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ji(this.h,this.r,this.buffer,this.pad)}digestInto(e){Bu(this),p2(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let a=0;a<8;a++)e[n++]=i[a]>>>0,e[n++]=i[a]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}};function O2(r){const e=(i,s)=>r(s).update(Vo(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}const M2=O2(r=>new P2(r));function C2(r,e,t,i,s,n=20){let a=r[0],o=r[1],h=r[2],c=r[3],f=e[0],l=e[1],v=e[2],w=e[3],m=e[4],_=e[5],O=e[6],D=e[7],A=s,M=t[0],R=t[1],T=t[2],C=a,q=o,B=h,N=c,k=f,I=l,u=v,p=w,y=m,b=_,g=O,x=D,$=A,E=M,d=R,S=T;for(let j=0;j<n;j+=2)C=C+k|0,$=ce($^C,16),y=y+$|0,k=ce(k^y,12),C=C+k|0,$=ce($^C,8),y=y+$|0,k=ce(k^y,7),q=q+I|0,E=ce(E^q,16),b=b+E|0,I=ce(I^b,12),q=q+I|0,E=ce(E^q,8),b=b+E|0,I=ce(I^b,7),B=B+u|0,d=ce(d^B,16),g=g+d|0,u=ce(u^g,12),B=B+u|0,d=ce(d^B,8),g=g+d|0,u=ce(u^g,7),N=N+p|0,S=ce(S^N,16),x=x+S|0,p=ce(p^x,12),N=N+p|0,S=ce(S^N,8),x=x+S|0,p=ce(p^x,7),C=C+I|0,S=ce(S^C,16),g=g+S|0,I=ce(I^g,12),C=C+I|0,S=ce(S^C,8),g=g+S|0,I=ce(I^g,7),q=q+u|0,$=ce($^q,16),x=x+$|0,u=ce(u^x,12),q=q+u|0,$=ce($^q,8),x=x+$|0,u=ce(u^x,7),B=B+p|0,E=ce(E^B,16),y=y+E|0,p=ce(p^y,12),B=B+p|0,E=ce(E^B,8),y=y+E|0,p=ce(p^y,7),N=N+k|0,d=ce(d^N,16),b=b+d|0,k=ce(k^b,12),N=N+k|0,d=ce(d^N,8),b=b+d|0,k=ce(k^b,7);let L=0;i[L++]=a+C|0,i[L++]=o+q|0,i[L++]=h+B|0,i[L++]=c+N|0,i[L++]=f+k|0,i[L++]=l+I|0,i[L++]=v+u|0,i[L++]=w+p|0,i[L++]=m+y|0,i[L++]=_+b|0,i[L++]=O+g|0,i[L++]=D+x|0,i[L++]=A+$|0,i[L++]=M+E|0,i[L++]=R+d|0,i[L++]=T+S|0}const R2=A2(C2,{counterRight:!1,counterLength:4,allowShortKeys:!1}),T2=new Uint8Array(16),ku=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(T2.subarray(t))},N2=new Uint8Array(32);function Hu(r,e,t,i,s){const n=r(e,t,N2),a=M2.create(n);s&&ku(a,s),ku(a,i);const o=new Uint8Array(16),h=b2(o);Uu(h,0,BigInt(s?s.length:0),!0),Uu(h,8,BigInt(i.length),!0),a.update(o);const c=a.digest();return Ji(n,o),c}const F2=r=>(e,t,i)=>({encrypt(s,n){const a=s.length;n=ju(a+16,n,!1),n.set(s);const o=n.subarray(0,-16);r(e,t,o,o,1);const h=Hu(r,e,t,o,i);return n.set(h,a),Ji(h),n},decrypt(s,n){n=ju(s.length-16,n,!1);const a=s.subarray(0,-16),o=s.subarray(-16),h=Hu(r,e,t,a,i);if(!m2(o,h))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),r(e,t,n,n,1),Ji(h),n}}),tp=w2({blockSize:64,nonceLength:12,tagLength:16},F2(R2));let rp=class extends Rc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Cc(e);const i=Gi(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),n.fill(0)}update(e){return Wi(this),this.iHash.update(e),this}digestInto(e){Wi(this),na(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:a,outputLen:o}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Nc=(r,e,t)=>new rp(r,e).update(t).digest();Nc.create=(r,e)=>new rp(r,e);function q2(r,e,t){return Cc(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Nc(r,Gi(t),Gi(e))}const fo=new Uint8Array([0]),Ku=new Uint8Array;function B2(r,e,t,i=32){if(Cc(r),Us(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);t===void 0&&(t=Ku);const n=new Uint8Array(s*r.outputLen),a=Nc.create(r,e),o=a._cloneInto(),h=new Uint8Array(a.outputLen);for(let c=0;c<s;c++)fo[0]=c+1,o.update(c===0?Ku:h).update(t).update(fo).digestInto(h),n.set(h,r.outputLen*c),a._cloneInto(o);return a.destroy(),o.destroy(),h.fill(0),fo.fill(0),n.slice(0,i)}const L2=(r,e,t,i,s)=>B2(r,q2(r,e,t),i,s);function j2(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n),h=i?4:0,c=i?0:4;r.setUint32(e+h,a,i),r.setUint32(e+c,o,i)}function U2(r,e,t){return r&e^~r&t}function z2(r,e,t){return r&e^r&t^e&t}let k2=class extends Rc{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ho(this.buffer)}update(e){Wi(this);const{view:t,buffer:i,blockLen:s}=this;e=Gi(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const h=ho(e);for(;s<=n-a;a+=s)this.process(h,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Wi(this),kl(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)t[l]=0;j2(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=ho(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=h/4,f=this.get();if(c>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,f[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%t&&e.buffer.set(i),e}};const H2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ur=new Uint32Array(64);let K2=class extends k2{constructor(){super(64,32,8,!1),this.A=jr[0]|0,this.B=jr[1]|0,this.C=jr[2]|0,this.D=jr[3]|0,this.E=jr[4]|0,this.F=jr[5]|0,this.G=jr[6]|0,this.H=jr[7]|0}get(){const{A:e,B:t,C:i,D:s,E:n,F:a,G:o,H:h}=this;return[e,t,i,s,n,a,o,h]}set(e,t,i,s,n,a,o,h){this.A=e|0,this.B=t|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=a|0,this.G=o|0,this.H=h|0}process(e,t){for(let l=0;l<16;l++,t+=4)Ur[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const v=Ur[l-15],w=Ur[l-2],m=dr(v,7)^dr(v,18)^v>>>3,_=dr(w,17)^dr(w,19)^w>>>10;Ur[l]=_+Ur[l-7]+m+Ur[l-16]|0}let{A:i,B:s,C:n,D:a,E:o,F:h,G:c,H:f}=this;for(let l=0;l<64;l++){const v=dr(o,6)^dr(o,11)^dr(o,25),w=f+v+U2(o,h,c)+H2[l]+Ur[l]|0,m=(dr(i,2)^dr(i,13)^dr(i,22))+z2(i,s,n)|0;f=c,c=h,h=o,o=a+w|0,a=n,n=s,s=i,i=w+m|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,a=a+this.D|0,o=o+this.E|0,h=h+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(i,s,n,a,o,h,c,f)}roundClean(){Ur.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const aa=Hl(()=>new K2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ip=BigInt(0);function Fc(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function sp(r){if(!Fc(r))throw new Error("Uint8Array expected")}const V2=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function W2(r){sp(r);let e="";for(let t=0;t<r.length;t++)e+=V2[r[t]];return e}function G2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?ip:BigInt("0x"+r)}const Ir={_0:48,_9:57,A:65,F:70,a:97,f:102};function Vu(r){if(r>=Ir._0&&r<=Ir._9)return r-Ir._0;if(r>=Ir.A&&r<=Ir.F)return r-(Ir.A-10);if(r>=Ir.a&&r<=Ir.f)return r-(Ir.a-10)}function np(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const a=Vu(r.charCodeAt(n)),o=Vu(r.charCodeAt(n+1));if(a===void 0||o===void 0){const h=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+h+'" at index '+n)}i[s]=a*16+o}return i}function Wu(r){return sp(r),G2(W2(Uint8Array.from(r).reverse()))}function J2(r,e){return np(r.toString(16).padStart(e*2,"0"))}function Y2(r,e){return J2(r,e).reverse()}function Gu(r,e,t){let i;if(typeof e=="string")try{i=np(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(Fc(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}const lo=r=>typeof r=="bigint"&&ip<=r;function X2(r,e,t){return lo(r)&&lo(e)&&lo(t)&&e<=r&&r<t}function Ju(r,e,t,i){if(!X2(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}const Z2={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Fc(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Q2(r,e,t={}){const i=(s,n,a)=>{const o=Z2[n];if(typeof o!="function")throw new Error("invalid validator function");const h=r[s];if(!(a&&h===void 0)&&!o(h,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+h)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}const Ki=BigInt(0),xn=BigInt(1);function ap(r,e){const t=r%e;return t>=Ki?t:e+t}function e3(r,e,t){if(e<Ki)throw new Error("invalid exponent, negatives unsupported");if(t<=Ki)throw new Error("invalid modulus");if(t===xn)return Ki;let i=xn;for(;e>Ki;)e&xn&&(i=i*r%t),r=r*r%t,e>>=xn;return i}function sr(r,e,t){let i=r;for(;e-- >Ki;)i*=i,i%=t;return i}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Si=BigInt(0),po=BigInt(1);function t3(r){return Q2(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function r3(r){const e=t3(r),{P:t}=e,i=A=>ap(A,t),s=e.montgomeryBits,n=Math.ceil(s/8),a=e.nByteLength,o=e.adjustScalarBytes||(A=>A),h=e.powPminus2||(A=>e3(A,t-BigInt(2),t));function c(A,M,R){const T=i(A*(M-R));return M=i(M-T),R=i(R+T),[M,R]}const f=(e.a-BigInt(2))/BigInt(4);function l(A,M){Ju("u",A,Si,t),Ju("scalar",M,Si,t);const R=M,T=A;let C=po,q=Si,B=A,N=po,k=Si,I;for(let p=BigInt(s-1);p>=Si;p--){const y=R>>p&po;k^=y,I=c(k,C,B),C=I[0],B=I[1],I=c(k,q,N),q=I[0],N=I[1],k=y;const b=C+q,g=i(b*b),x=C-q,$=i(x*x),E=g-$,d=B+N,S=B-N,L=i(S*b),j=i(d*x),U=L+j,z=L-j;B=i(U*U),N=i(T*i(z*z)),C=i(g*$),q=i(E*(g+i(f*E)))}I=c(k,C,B),C=I[0],B=I[1],I=c(k,q,N),q=I[0],N=I[1];const u=h(q);return i(C*u)}function v(A){return Y2(i(A),n)}function w(A){const M=Gu("u coordinate",A,n);return a===32&&(M[31]&=127),Wu(M)}function m(A){const M=Gu("scalar",A),R=M.length;if(R!==n&&R!==a){let T=""+n+" or "+a;throw new Error("invalid scalar, expected "+T+" bytes, got "+R)}return Wu(o(M))}function _(A,M){const R=w(M),T=m(A),C=l(R,T);if(C===Si)throw new Error("invalid private or public key received");return v(C)}const O=v(e.Gu);function D(A){return _(A,O)}return{scalarMult:_,scalarMultBase:D,getSharedSecret:(A,M)=>_(A,M),getPublicKey:A=>D(A),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:O}}const Jo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const i3=BigInt(1),Yu=BigInt(2),s3=BigInt(3),n3=BigInt(5);BigInt(8);function a3(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Jo,a=r*r%n*r%n,o=sr(a,Yu,n)*a%n,h=sr(o,i3,n)*r%n,c=sr(h,n3,n)*h%n,f=sr(c,e,n)*c%n,l=sr(f,t,n)*f%n,v=sr(l,i,n)*l%n,w=sr(v,s,n)*v%n,m=sr(w,s,n)*v%n,_=sr(m,e,n)*c%n;return{pow_p_5_8:sr(_,Yu,n)*r%n,b2:a}}function o3(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const Yo=r3({P:Jo,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=Jo,{pow_p_5_8:t,b2:i}=a3(r);return ap(sr(t,s3,e)*i,e)},adjustScalarBytes:o3,randomBytes:Xs}),op="base10",_t="base16",Hr="base64pad",Is="base64url",Zs="utf8",cp=0,Mr=1,Qs=2,c3=0,Xu=1,Fs=12,qc=32;function h3(){const r=Yo.utils.randomPrivateKey(),e=Yo.getPublicKey(r);return{privateKey:xt(r,_t),publicKey:xt(e,_t)}}function Xo(){const r=Xs(qc);return xt(r,_t)}function u3(r,e){const t=Yo.getSharedSecret(Wt(r,_t),Wt(e,_t)),i=L2(aa,t,void 0,void 0,qc);return xt(i,_t)}function qn(r){const e=aa(Wt(r,_t));return xt(e,_t)}function Or(r){const e=aa(Wt(r,Zs));return xt(e,_t)}function hp(r){return Wt(`${r}`,op)}function di(r){return Number(xt(r,op))}function f3(r){const e=hp(typeof r.type<"u"?r.type:cp);if(di(e)===Mr&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?Wt(r.senderPublicKey,_t):void 0,i=typeof r.iv<"u"?Wt(r.iv,_t):Xs(Fs),s=Wt(r.symKey,_t),n=tp(s,i).encrypt(Wt(r.message,Zs));return up({type:e,sealed:n,iv:i,senderPublicKey:t,encoding:r.encoding})}function d3(r){const e=Wt(r.symKey,_t),{sealed:t,iv:i}=ks(r),s=tp(e,i).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return xt(s,Zs)}function l3(r,e){const t=hp(Qs),i=Xs(Fs),s=Wt(r,Zs);return up({type:t,sealed:s,iv:i,encoding:e})}function p3(r,e){const{sealed:t}=ks({encoded:r,encoding:e});return xt(t,Zs)}function up(r){const{encoding:e=Hr}=r;if(di(r.type)===Qs)return xt(Ta([r.type,r.sealed]),e);if(di(r.type)===Mr){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return xt(Ta([r.type,r.senderPublicKey,r.iv,r.sealed]),e)}return xt(Ta([r.type,r.iv,r.sealed]),e)}function ks(r){const{encoded:e,encoding:t=Hr}=r,i=Wt(e,t),s=i.slice(c3,Xu),n=Xu;if(di(s)===Mr){const c=n+qc,f=c+Fs,l=i.slice(n,c),v=i.slice(c,f),w=i.slice(f);return{type:s,sealed:w,iv:v,senderPublicKey:l}}if(di(s)===Qs){const c=i.slice(n),f=Xs(Fs);return{type:s,sealed:c,iv:f}}const a=n+Fs,o=i.slice(n,a),h=i.slice(a);return{type:s,sealed:h,iv:o}}function b3(r,e){const t=ks({encoded:r,encoding:e==null?void 0:e.encoding});return fp({type:di(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?xt(t.senderPublicKey,_t):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function fp(r){const e=(r==null?void 0:r.type)||cp;if(e===Mr){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Zu(r){return r.type===Mr&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Qu(r){return r.type===Qs}function g3(r){return new rm.ec("p256").keyFromPublic({x:Buffer.from(r.x,"base64").toString("hex"),y:Buffer.from(r.y,"base64").toString("hex")},"hex")}function v3(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");const t=e.length%4;return t>0&&(e+="=".repeat(4-t)),e}function y3(r){return Buffer.from(v3(r),"base64")}function m3(r,e){const[t,i,s]=r.split("."),n=y3(s);if(n.length!==64)throw new Error("Invalid signature length");const a=n.slice(0,32).toString("hex"),o=n.slice(32,64).toString("hex"),h=`${t}.${i}`,c=aa(h),f=g3(e),l=xt(c,_t);if(!f.verify(l,{r:a,s:o}))throw new Error("Invalid signature");return Ho(r).payload}const w3="irn";function Kn(r){return(r==null?void 0:r.relay)||{protocol:w3}}function Rs(r){const e=im[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function _3(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),a=r[s];t[n]=a}}),t}function ef(r){if(!r.includes("wc:")){const c=zl(r);c!=null&&c.includes("wc:")&&(r=c)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",a=new URLSearchParams(n),o={};a.forEach((c,f)=>{o[f]=c});const h=typeof o.methods=="string"?o.methods.split(","):void 0;return{protocol:i,topic:E3(s[0]),version:parseInt(s[1],10),symKey:o.symKey,relay:_3(o),methods:h,expiryTimestamp:o.expiryTimestamp?parseInt(o.expiryTimestamp,10):void 0}}function E3(r){return r.startsWith("//")?r.substring(2):r}function x3(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const n=s,a=t+e+n;r[n]&&(i[a]=r[n])}),i}function tf(r){const e=new URLSearchParams,t=x3(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function Sn(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}function Qi(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function S3(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Qi(t.accounts))}),e}function $3(r,e){const t=[];return Object.values(r).forEach(i=>{Qi(i.accounts).includes(e)&&t.push(...i.methods)}),t}function I3(r,e){const t=[];return Object.values(r).forEach(i=>{Qi(i.accounts).includes(e)&&t.push(...i.events)}),t}function Bc(r){return r.includes(":")}function Ts(r){return Bc(r)?r.split(":")[0]:r}function D3(r){const e={};return r==null||r.forEach(t=>{var i;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function rf(r,e){e=e.map(i=>i.replace("did:pkh:",""));const t=D3(e);for(const[i,s]of Object.entries(t))s.methods?s.methods=Nn(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}const A3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},P3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(r,e){const{message:t,code:i}=P3[r];return{message:e?`${t} ${e}`:t,code:i}}function ve(r,e){const{message:t,code:i}=A3[r];return{message:e?`${t} ${e}`:t,code:i}}function mr(r,e){return!!Array.isArray(r)}function Hs(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Et(r){return typeof r>"u"}function et(r,e){return e&&Et(r)?!0:typeof r=="string"&&!!r.trim().length}function Lc(r,e){return e&&Et(r)?!0:typeof r=="number"&&!isNaN(r)}function O3(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let n=!0;return ai(s,i)?(i.forEach(a=>{const{accounts:o,methods:h,events:c}=r.namespaces[a],f=Qi(o),l=t[a];(!ai(Nl(a,l),f)||!ai(l.methods,h)||!ai(l.events,c))&&(n=!1)}),n):!1}function Vn(r){return et(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function M3(r){if(et(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Vn(t)}}return!1}function C3(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(et(r,!1)){if(e(r))return!0;const t=zl(r);return e(t)}}catch{}return!1}function R3(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function T3(r){return r==null?void 0:r.topic}function N3(r,e){let t=null;return et(r==null?void 0:r.publicKey,!1)||(t=W("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function sf(r){let e=!0;return mr(r)?r.length&&(e=r.every(t=>et(t,!1))):e=!1,e}function F3(r,e,t){let i=null;return mr(e)&&e.length?e.forEach(s=>{i||Vn(s)||(i=ve("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Vn(r)||(i=ve("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function q3(r,e,t){let i=null;return Object.entries(r).forEach(([s,n])=>{if(i)return;const a=F3(s,Nl(s,n),`${e} ${t}`);a&&(i=a)}),i}function B3(r,e){let t=null;return mr(r)?r.forEach(i=>{t||M3(i)||(t=ve("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=ve("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function L3(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=B3(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function j3(r,e){let t=null;return sf(r==null?void 0:r.methods)?sf(r==null?void 0:r.events)||(t=ve("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=ve("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function dp(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=j3(i,`${e}, namespace`);s&&(t=s)}),t}function U3(r,e,t){let i=null;if(r&&Hs(r)){const s=dp(r,e);s&&(i=s);const n=q3(r,e,t);n&&(i=n)}else i=W("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function bo(r,e){let t=null;if(r&&Hs(r)){const i=dp(r,e);i&&(t=i);const s=L3(r,e);s&&(t=s)}else t=W("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function lp(r){return et(r.protocol,!0)}function z3(r,e){let t=!1;return r?r&&mr(r)&&r.length&&r.forEach(i=>{t=lp(i)}):t=!0,t}function k3(r){return typeof r=="number"}function Pt(r){return typeof r<"u"&&typeof r!==null}function H3(r){return!(!r||typeof r!="object"||!r.code||!Lc(r.code,!1)||!r.message||!et(r.message,!1))}function K3(r){return!(Et(r)||!et(r.method,!1))}function V3(r){return!(Et(r)||Et(r.result)&&Et(r.error)||!Lc(r.id,!1)||!et(r.jsonrpc,!1))}function W3(r){return!(Et(r)||!et(r.name,!1))}function nf(r,e){return!(!Vn(e)||!S3(r).includes(e))}function G3(r,e,t){return et(t,!1)?$3(r,e).includes(t):!1}function J3(r,e,t){return et(t,!1)?I3(r,e).includes(t):!1}function af(r,e,t){let i=null;const s=Y3(r),n=X3(e),a=Object.keys(s),o=Object.keys(n),h=of(Object.keys(r)),c=of(Object.keys(e)),f=h.filter(l=>!c.includes(l));return f.length&&(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(e).toString()}`)),ai(a,o)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${o.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const v=Qi(e[l].accounts);v.includes(l)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${v.toString()}`))}),a.forEach(l=>{i||(ai(s[l].methods,n[l].methods)?ai(s[l].events,n[l].events)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function Y3(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function of(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function X3(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const i=Qi(r[t].accounts);i==null||i.forEach(s=>{e[s]={accounts:r[t].accounts.filter(n=>n.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function Z3(r,e){return Lc(r,!1)&&r<=e.max&&r>=e.min}function cf(){const r=Ys();return new Promise(e=>{switch(r){case qt.browser:e(Q3());break;case qt.reactNative:e(ew());break;case qt.node:e(tw());break;default:e(!0)}})}function Q3(){return Js()&&(navigator==null?void 0:navigator.onLine)}async function ew(){if(Wr()&&typeof global<"u"&&global!=null&&global.NetInfo){const r=await(global==null?void 0:global.NetInfo.fetch());return r==null?void 0:r.isConnected}return!0}function tw(){return!0}function rw(r){switch(Ys()){case qt.browser:iw(r);break;case qt.reactNative:sw(r);break}}function iw(r){!Wr()&&Js()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function sw(r){Wr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>r(e==null?void 0:e.isConnected)))}const go={};let Ds=class{static get(e){return go[e]}static set(e,t){go[e]=t}static delete(e){delete go[e]}};class pi{}let nw=class extends pi{constructor(e){super()}};const hf=V.FIVE_SECONDS,es={pulse:"heartbeat_pulse"};let aw=class pp extends nw{constructor(e){super(e),this.events=new Lt.EventEmitter,this.interval=hf,this.interval=(e==null?void 0:e.interval)||hf}static async init(e){const t=new pp(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),V.toMiliseconds(this.interval))}pulse(){this.events.emit(es.pulse)}};const ow=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,cw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,hw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function uw(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){fw(r);return}return e}function fw(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function $n(r,e={}){if(typeof r!="string")return r;const t=r.trim();if(r[0]==='"'&&r.endsWith('"')&&!r.includes("\\"))return t.slice(1,-1);if(t.length<=9){const i=t.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!hw.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(ow.test(r)||cw.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,uw)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function dw(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function ht(r,...e){try{return dw(r(...e))}catch(t){return Promise.reject(t)}}function lw(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function pw(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function Bn(r){if(lw(r))return String(r);if(pw(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return Bn(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Zo="base64:";function bw(r){return typeof r=="string"?r:Zo+yw(r)}function gw(r){return typeof r!="string"||!r.startsWith(Zo)?r:vw(r.slice(Zo.length))}function vw(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function yw(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function At(r){var e;return r&&((e=r.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function mw(...r){return At(r.join(":"))}function In(r){return r=At(r),r?r+":":""}function ww(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function _w(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const Ew="memory",xw=()=>{const r=new Map;return{name:Ew,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function Sw(r={}){const e={mounts:{"":r.driver||xw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=c=>{for(const f of e.mountpoints)if(c.startsWith(f))return{base:f,relativeKey:c.slice(f.length),driver:e.mounts[f]};return{base:"",relativeKey:c,driver:e.mounts[""]}},i=(c,f)=>e.mountpoints.filter(l=>l.startsWith(c)||f&&c.startsWith(l)).map(l=>({relativeBase:c.length>l.length?c.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(c,f)=>{if(e.watching){f=At(f);for(const l of e.watchListeners)l(c,f)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await uf(e.mounts[c],s,c)}},a=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},o=(c,f,l)=>{const v=new Map,w=m=>{let _=v.get(m.base);return _||(_={driver:m.driver,base:m.base,items:[]},v.set(m.base,_)),_};for(const m of c){const _=typeof m=="string",O=At(_?m:m.key),D=_?void 0:m.value,A=_||!m.options?f:{...f,...m.options},M=t(O);w(M).items.push({key:O,value:D,relativeKey:M.relativeKey,options:A})}return Promise.all([...v.values()].map(m=>l(m))).then(m=>m.flat())},h={hasItem(c,f={}){c=At(c);const{relativeKey:l,driver:v}=t(c);return ht(v.hasItem,l,f)},getItem(c,f={}){c=At(c);const{relativeKey:l,driver:v}=t(c);return ht(v.getItem,l,f).then(w=>$n(w))},getItems(c,f={}){return o(c,f,l=>l.driver.getItems?ht(l.driver.getItems,l.items.map(v=>({key:v.relativeKey,options:v.options})),f).then(v=>v.map(w=>({key:mw(l.base,w.key),value:$n(w.value)}))):Promise.all(l.items.map(v=>ht(l.driver.getItem,v.relativeKey,v.options).then(w=>({key:v.key,value:$n(w)})))))},getItemRaw(c,f={}){c=At(c);const{relativeKey:l,driver:v}=t(c);return v.getItemRaw?ht(v.getItemRaw,l,f):ht(v.getItem,l,f).then(w=>gw(w))},async setItem(c,f,l={}){if(f===void 0)return h.removeItem(c);c=At(c);const{relativeKey:v,driver:w}=t(c);w.setItem&&(await ht(w.setItem,v,Bn(f),l),w.watch||s("update",c))},async setItems(c,f){await o(c,f,async l=>{if(l.driver.setItems)return ht(l.driver.setItems,l.items.map(v=>({key:v.relativeKey,value:Bn(v.value),options:v.options})),f);l.driver.setItem&&await Promise.all(l.items.map(v=>ht(l.driver.setItem,v.relativeKey,Bn(v.value),v.options)))})},async setItemRaw(c,f,l={}){if(f===void 0)return h.removeItem(c,l);c=At(c);const{relativeKey:v,driver:w}=t(c);if(w.setItemRaw)await ht(w.setItemRaw,v,f,l);else if(w.setItem)await ht(w.setItem,v,bw(f),l);else return;w.watch||s("update",c)},async removeItem(c,f={}){typeof f=="boolean"&&(f={removeMeta:f}),c=At(c);const{relativeKey:l,driver:v}=t(c);v.removeItem&&(await ht(v.removeItem,l,f),(f.removeMeta||f.removeMata)&&await ht(v.removeItem,l+"$",f),v.watch||s("remove",c))},async getMeta(c,f={}){typeof f=="boolean"&&(f={nativeOnly:f}),c=At(c);const{relativeKey:l,driver:v}=t(c),w=Object.create(null);if(v.getMeta&&Object.assign(w,await ht(v.getMeta,l,f)),!f.nativeOnly){const m=await ht(v.getItem,l+"$",f).then(_=>$n(_));m&&typeof m=="object"&&(typeof m.atime=="string"&&(m.atime=new Date(m.atime)),typeof m.mtime=="string"&&(m.mtime=new Date(m.mtime)),Object.assign(w,m))}return w},setMeta(c,f,l={}){return this.setItem(c+"$",f,l)},removeMeta(c,f={}){return this.removeItem(c+"$",f)},async getKeys(c,f={}){var O;c=In(c);const l=i(c,!0);let v=[];const w=[];let m=!0;for(const D of l){(O=D.driver.flags)!=null&&O.maxDepth||(m=!1);const A=await ht(D.driver.getKeys,D.relativeBase,f);for(const M of A){const R=D.mountpoint+At(M);v.some(T=>R.startsWith(T))||w.push(R)}v=[D.mountpoint,...v.filter(M=>!M.startsWith(D.mountpoint))]}const _=f.maxDepth!==void 0&&!m;return w.filter(D=>(!_||ww(D,f.maxDepth))&&_w(D,c))},async clear(c,f={}){c=In(c),await Promise.all(i(c,!1).map(async l=>{if(l.driver.clear)return ht(l.driver.clear,l.relativeBase,f);if(l.driver.removeItem){const v=await l.driver.getKeys(l.relativeBase||"",f);return Promise.all(v.map(w=>l.driver.removeItem(w,f)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>ff(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(f=>f!==c),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(c,f){if(c=In(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((l,v)=>v.length-l.length)),e.mounts[c]=f,e.watching&&Promise.resolve(uf(f,s,c)).then(l=>{e.unwatch[c]=l}).catch(console.error),h},async unmount(c,f=!0){var l,v;c=In(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&((v=(l=e.unwatch)[c])==null||v.call(l),delete e.unwatch[c]),f&&await ff(e.mounts[c]),e.mountpoints=e.mountpoints.filter(w=>w!==c),delete e.mounts[c])},getMount(c=""){c=At(c)+":";const f=t(c);return{driver:f.driver,base:f.base}},getMounts(c="",f={}){return c=At(c),i(c,f.parents).map(v=>({driver:v.driver,base:v.mountpoint}))},keys:(c,f={})=>h.getKeys(c,f),get:(c,f={})=>h.getItem(c,f),set:(c,f,l={})=>h.setItem(c,f,l),has:(c,f={})=>h.hasItem(c,f),del:(c,f={})=>h.removeItem(c,f),remove:(c,f={})=>h.removeItem(c,f)};return h}function uf(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function ff(r){typeof r.dispose=="function"&&await ht(r.dispose)}function bi(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function bp(r,e){const t=indexedDB.open(r);t.onupgradeneeded=()=>t.result.createObjectStore(e);const i=bi(t);return(s,n)=>i.then(a=>n(a.transaction(e,s).objectStore(e)))}let vo;function en(){return vo||(vo=bp("keyval-store","keyval")),vo}function df(r,e=en()){return e("readonly",t=>bi(t.get(r)))}function $w(r,e,t=en()){return t("readwrite",i=>(i.put(e,r),bi(i.transaction)))}function Iw(r,e=en()){return e("readwrite",t=>(t.delete(r),bi(t.transaction)))}function Dw(r=en()){return r("readwrite",e=>(e.clear(),bi(e.transaction)))}function Aw(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},bi(r.transaction)}function Pw(r=en()){return r("readonly",e=>{if(e.getAllKeys)return bi(e.getAllKeys());const t=[];return Aw(e,i=>t.push(i.key)).then(()=>t)})}const Ow="idb-keyval";var Mw=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=bp(r.dbName,r.storeName)),{name:Ow,options:r,async hasItem(s){return!(typeof await df(t(s),i)>"u")},async getItem(s){return await df(t(s),i)??null},setItem(s,n){return $w(t(s),n,i)},removeItem(s){return Iw(t(s),i)},getKeys(){return Pw(i)},clear(){return Dw(i)}}};const Cw="WALLET_CONNECT_V2_INDEXED_DB",Rw="keyvaluestorage";let Tw=class{constructor(){this.indexedDb=Sw({driver:Mw({dbName:Cw,storeName:Rw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Cr(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ln={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yo<"u"&&yo.localStorage?Ln.exports=yo.localStorage:typeof window<"u"&&window.localStorage?Ln.exports=window.localStorage:Ln.exports=new e})();function Nw(r){var e;return[r[0],ui((e=r[1])!=null?e:"")]}let Fw=class{constructor(){this.localStorage=Ln.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Nw)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return ui(t)}async setItem(e,t){this.localStorage.setItem(e,Cr(t))}async removeItem(e){this.localStorage.removeItem(e)}};const qw="wc_storage_version",lf=1,Bw=async(r,e,t)=>{const i=qw,s=await e.getItem(i);if(s&&s>=lf){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const a=[];for(;n.length;){const o=n.shift();if(!o)continue;const h=o.toLowerCase();if(h.includes("wc@")||h.includes("walletconnect")||h.includes("wc_")||h.includes("wallet_connect")){const c=await r.getItem(o);await e.setItem(o,c),a.push(o)}}await e.setItem(i,lf),t(e),Lw(r,a)},Lw=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let jw=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new Fw;this.storage=e;try{const t=new Tw;Bw(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var mo,pf;function Uw(){if(pf)return mo;pf=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}mo=e;function e(t,i,s){var n=s&&s.stringify||r,a=1;if(typeof t=="object"&&t!==null){var o=i.length+a;if(o===1)return t;var h=new Array(o);h[0]=n(t);for(var c=1;c<o;c++)h[c]=n(i[c]);return h.join(" ")}if(typeof t!="string")return t;var f=i.length;if(f===0)return t;for(var l="",v=1-a,w=-1,m=t&&t.length||0,_=0;_<m;){if(t.charCodeAt(_)===37&&_+1<m){switch(w=w>-1?w:0,t.charCodeAt(_+1)){case 100:case 102:if(v>=f||i[v]==null)break;w<_&&(l+=t.slice(w,_)),l+=Number(i[v]),w=_+2,_++;break;case 105:if(v>=f||i[v]==null)break;w<_&&(l+=t.slice(w,_)),l+=Math.floor(Number(i[v])),w=_+2,_++;break;case 79:case 111:case 106:if(v>=f||i[v]===void 0)break;w<_&&(l+=t.slice(w,_));var O=typeof i[v];if(O==="string"){l+="'"+i[v]+"'",w=_+2,_++;break}if(O==="function"){l+=i[v].name||"<anonymous>",w=_+2,_++;break}l+=n(i[v]),w=_+2,_++;break;case 115:if(v>=f)break;w<_&&(l+=t.slice(w,_)),l+=String(i[v]),w=_+2,_++;break;case 37:w<_&&(l+=t.slice(w,_)),l+="%",w=_+2,_++,v--;break}++v}++_}return w===-1?t:(w<m&&(l+=t.slice(w)),l)}return mo}var wo,bf;function zw(){if(bf)return wo;bf=1;const r=Uw();wo=s;const e=T().console||{},t={mapHttpRequest:m,mapHttpResponse:m,wrapRequestSerializer:_,wrapResponseSerializer:_,wrapErrorSerializer:_,req:m,res:m,err:v};function i(C,q){return Array.isArray(C)?C.filter(function(N){return N!=="!stdSerializers.err"}):C===!0?Object.keys(q):!1}function s(C){C=C||{},C.browser=C.browser||{};const q=C.browser.transmit;if(q&&typeof q.send!="function")throw Error("pino: transmit option must have a send function");const B=C.browser.write||e;C.browser.write&&(C.browser.asObject=!0);const N=C.serializers||{},k=i(C.browser.serialize,N);let I=C.browser.serialize;Array.isArray(C.browser.serialize)&&C.browser.serialize.indexOf("!stdSerializers.err")>-1&&(I=!1);const u=["error","fatal","warn","info","debug","trace"];typeof B=="function"&&(B.error=B.fatal=B.warn=B.info=B.debug=B.trace=B),C.enabled===!1&&(C.level="silent");const p=C.level||"info",y=Object.create(B);y.log||(y.log=O),Object.defineProperty(y,"levelVal",{get:g}),Object.defineProperty(y,"level",{get:x,set:$});const b={transmit:q,serialize:k,asObject:C.browser.asObject,levels:u,timestamp:w(C)};y.levels=s.levels,y.level=p,y.setMaxListeners=y.getMaxListeners=y.emit=y.addListener=y.on=y.prependListener=y.once=y.prependOnceListener=y.removeListener=y.removeAllListeners=y.listeners=y.listenerCount=y.eventNames=y.write=y.flush=O,y.serializers=N,y._serialize=k,y._stdErrSerialize=I,y.child=E,q&&(y._logEvent=l());function g(){return this.level==="silent"?1/0:this.levels.values[this.level]}function x(){return this._level}function $(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,n(b,y,"error","log"),n(b,y,"fatal","error"),n(b,y,"warn","error"),n(b,y,"info","log"),n(b,y,"debug","log"),n(b,y,"trace","log")}function E(d,S){if(!d)throw new Error("missing bindings for child Pino");S=S||{},k&&d.serializers&&(S.serializers=d.serializers);const L=S.serializers;if(k&&L){var j=Object.assign({},N,L),U=C.browser.serialize===!0?Object.keys(j):k;delete d.serializers,h([d],U,j,this._stdErrSerialize)}function z(G){this._childLevel=(G._childLevel|0)+1,this.error=c(G,d,"error"),this.fatal=c(G,d,"fatal"),this.warn=c(G,d,"warn"),this.info=c(G,d,"info"),this.debug=c(G,d,"debug"),this.trace=c(G,d,"trace"),j&&(this.serializers=j,this._serialize=U),q&&(this._logEvent=l([].concat(G._logEvent.bindings,d)))}return z.prototype=this,new z(this)}return y}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:D,epochTime:A,unixTime:M,isoTime:R});function n(C,q,B,N){const k=Object.getPrototypeOf(q);q[B]=q.levelVal>q.levels.values[B]?O:k[B]?k[B]:e[B]||e[N]||O,a(C,q,B)}function a(C,q,B){!C.transmit&&q[B]===O||(q[B]=function(N){return function(){const I=C.timestamp(),u=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var y=0;y<u.length;y++)u[y]=arguments[y];if(C.serialize&&!C.asObject&&h(u,this._serialize,this.serializers,this._stdErrSerialize),C.asObject?N.call(p,o(this,B,u,I)):N.apply(p,u),C.transmit){const b=C.transmit.level||q.level,g=s.levels.values[b],x=s.levels.values[B];if(x<g)return;f(this,{ts:I,methodLevel:B,methodValue:x,transmitValue:s.levels.values[C.transmit.level||q.level],send:C.transmit.send,val:q.levelVal},u)}}}(q[B]))}function o(C,q,B,N){C._serialize&&h(B,C._serialize,C.serializers,C._stdErrSerialize);const k=B.slice();let I=k[0];const u={};N&&(u.time=N),u.level=s.levels.values[q];let p=(C._childLevel|0)+1;if(p<1&&(p=1),I!==null&&typeof I=="object"){for(;p--&&typeof k[0]=="object";)Object.assign(u,k.shift());I=k.length?r(k.shift(),k):void 0}else typeof I=="string"&&(I=r(k.shift(),k));return I!==void 0&&(u.msg=I),u}function h(C,q,B,N){for(const k in C)if(N&&C[k]instanceof Error)C[k]=s.stdSerializers.err(C[k]);else if(typeof C[k]=="object"&&!Array.isArray(C[k]))for(const I in C[k])q&&q.indexOf(I)>-1&&I in B&&(C[k][I]=B[I](C[k][I]))}function c(C,q,B){return function(){const N=new Array(1+arguments.length);N[0]=q;for(var k=1;k<N.length;k++)N[k]=arguments[k-1];return C[B].apply(this,N)}}function f(C,q,B){const N=q.send,k=q.ts,I=q.methodLevel,u=q.methodValue,p=q.val,y=C._logEvent.bindings;h(B,C._serialize||Object.keys(C.serializers),C.serializers,C._stdErrSerialize===void 0?!0:C._stdErrSerialize),C._logEvent.ts=k,C._logEvent.messages=B.filter(function(b){return y.indexOf(b)===-1}),C._logEvent.level.label=I,C._logEvent.level.value=u,N(I,C._logEvent,p),C._logEvent=l(y)}function l(C){return{ts:0,messages:[],bindings:C||[],level:{label:"",value:0}}}function v(C){const q={type:C.constructor.name,msg:C.message,stack:C.stack};for(const B in C)q[B]===void 0&&(q[B]=C[B]);return q}function w(C){return typeof C.timestamp=="function"?C.timestamp:C.timestamp===!1?D:A}function m(){return{}}function _(C){return C}function O(){}function D(){return!1}function A(){return Date.now()}function M(){return Math.round(Date.now()/1e3)}function R(){return new Date(Date.now()).toISOString()}function T(){function C(q){return typeof q<"u"&&q}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return C(self)||C(window)||C(this)||{}}}return wo}var Bi=zw();const tn=Xn(Bi),kw={level:"info"},rn="custom_context",jc=1e3*1024;let Hw=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},gf=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new Hw(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},gp=class{constructor(e,t=jc){this.level=e??"error",this.levelValue=Bi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new gf(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Bi.levels.values.error?console.error(e):t===Bi.levels.values.warn?console.warn(e):t===Bi.levels.values.debug?console.debug(e):t===Bi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Cr({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new gf(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Cr({extraMetadata:e})),new Blob(t,{type:"application/json"})}},Kw=class{constructor(e,t=jc){this.baseChunkLogger=new gp(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},Vw=class{constructor(e,t=jc){this.baseChunkLogger=new gp(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Ww=Object.defineProperty,Gw=Object.defineProperties,Jw=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,Yw=Object.prototype.hasOwnProperty,Xw=Object.prototype.propertyIsEnumerable,yf=(r,e,t)=>e in r?Ww(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wn=(r,e)=>{for(var t in e||(e={}))Yw.call(e,t)&&yf(r,t,e[t]);if(vf)for(var t of vf(e))Xw.call(e,t)&&yf(r,t,e[t]);return r},Gn=(r,e)=>Gw(r,Jw(e));function oa(r){return Gn(Wn({},r),{level:(r==null?void 0:r.level)||kw.level})}function Zw(r,e=rn){return r[e]||""}function Qw(r,e,t=rn){return r[t]=e,r}function Mt(r,e=rn){let t="";return typeof r.bindings>"u"?t=Zw(r,e):t=r.bindings().context||"",t}function e6(r,e,t=rn){const i=Mt(r,t);return i.trim()?`${i}/${e}`:e}function St(r,e,t=rn){const i=e6(r,e,t),s=r.child({context:i});return Qw(s,i,t)}function t6(r){var e,t;const i=new Kw((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:tn(Gn(Wn({},r.opts),{level:"trace",browser:Gn(Wn({},(t=r.opts)==null?void 0:t.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function r6(r){var e;const t=new Vw((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:tn(Gn(Wn({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function i6(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?t6(r):r6(r)}var s6=Object.defineProperty,n6=(r,e,t)=>e in r?s6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mf=(r,e,t)=>n6(r,typeof e!="symbol"?e+"":e,t);let a6=class extends pi{constructor(e){super(),this.opts=e,mf(this,"protocol","wc"),mf(this,"version",2)}};var o6=Object.defineProperty,c6=(r,e,t)=>e in r?o6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,h6=(r,e,t)=>c6(r,e+"",t);let u6=class extends pi{constructor(e,t){super(),this.core=e,this.logger=t,h6(this,"records",new Map)}},f6=class{constructor(e,t){this.logger=e,this.core=t}},d6=class extends pi{constructor(e,t){super(),this.relayer=e,this.logger=t}},l6=class extends pi{constructor(e){super()}},p6=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},b6=class extends pi{constructor(e,t){super(),this.relayer=e,this.logger=t}},g6=class extends pi{constructor(e,t){super(),this.core=e,this.logger=t}},v6=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},y6=class{constructor(e,t){this.projectId=e,this.logger=t}},m6=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var w6=Object.defineProperty,_6=(r,e,t)=>e in r?w6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,wf=(r,e,t)=>_6(r,typeof e!="symbol"?e+"":e,t);let E6=class{constructor(e){this.opts=e,wf(this,"protocol","wc"),wf(this,"version",2)}},x6=class{constructor(e){this.client=e}};const S6="PARSE_ERROR",$6="INVALID_REQUEST",I6="METHOD_NOT_FOUND",D6="INVALID_PARAMS",vp="INTERNAL_ERROR",Uc="SERVER_ERROR",A6=[-32700,-32600,-32601,-32602,-32603],qs={[S6]:{code:-32700,message:"Parse error"},[$6]:{code:-32600,message:"Invalid Request"},[I6]:{code:-32601,message:"Method not found"},[D6]:{code:-32602,message:"Invalid params"},[vp]:{code:-32603,message:"Internal error"},[Uc]:{code:-32e3,message:"Server error"}},yp=Uc;function P6(r){return A6.includes(r)}function _f(r){return Object.keys(qs).includes(r)?qs[r]:qs[yp]}function O6(r){const e=Object.values(qs).find(t=>t.code===r);return e||qs[yp]}function mp(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var _o={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Qo=function(r,e){return Qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Qo(r,e)};function M6(r,e){Qo(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ec=function(){return ec=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},ec.apply(this,arguments)};function C6(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function R6(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function T6(r,e){return function(t,i){e(t,i,r)}}function N6(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function F6(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(f){try{c(i.next(f))}catch(l){a(l)}}function h(f){try{c(i.throw(f))}catch(l){a(l)}}function c(f){f.done?n(f.value):s(f.value).then(o,h)}c((i=i.apply(r,e||[])).next())})}function q6(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(f){return h([c,f])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(f){c=[6,f],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function B6(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function L6(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function tc(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wp(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function j6(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(wp(arguments[e]));return r}function U6(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function Ks(r){return this instanceof Ks?(this.v=r,this):new Ks(r)}function z6(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(v){i[v]&&(s[v]=function(w){return new Promise(function(m,_){n.push([v,w,m,_])>1||o(v,w)})})}function o(v,w){try{h(i[v](w))}catch(m){l(n[0][3],m)}}function h(v){v.value instanceof Ks?Promise.resolve(v.value.v).then(c,f):l(n[0][2],v)}function c(v){o("next",v)}function f(v){o("throw",v)}function l(v,w){v(w),n.shift(),n.length&&o(n[0][0],n[0][1])}}function k6(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:Ks(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function H6(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof tc=="function"?tc(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(o,h){a=r[n](a),s(o,h,a.done,a.value)})}}function s(n,a,o,h){Promise.resolve(h).then(function(c){n({value:c,done:o})},a)}}function K6(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function V6(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function W6(r){return r&&r.__esModule?r:{default:r}}function G6(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function J6(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const Y6=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ec},__asyncDelegator:k6,__asyncGenerator:z6,__asyncValues:H6,__await:Ks,__awaiter:F6,__classPrivateFieldGet:G6,__classPrivateFieldSet:J6,__createBinding:B6,__decorate:R6,__exportStar:L6,__extends:M6,__generator:q6,__importDefault:W6,__importStar:V6,__makeTemplateObject:K6,__metadata:N6,__param:T6,__read:wp,__rest:C6,__spread:j6,__spreadArrays:U6,__values:tc},Symbol.toStringTag,{value:"Module"})),X6=wc(Y6);var Dr={},Ef;function Z6(){if(Ef)return Dr;Ef=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.isBrowserCryptoAvailable=Dr.getSubtleCrypto=Dr.getBrowerCrypto=void 0;function r(){return(Ot===null||Ot===void 0?void 0:Ot.crypto)||(Ot===null||Ot===void 0?void 0:Ot.msCrypto)||{}}Dr.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}Dr.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Dr.isBrowserCryptoAvailable=t,Dr}var Ar={},xf;function Q6(){if(xf)return Ar;xf=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.isBrowser=Ar.isNode=Ar.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ar.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ar.isNode=e;function t(){return!r()&&!e()}return Ar.isBrowser=t,Ar}var Sf;function e8(){return Sf||(Sf=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=X6;e.__exportStar(Z6(),r),e.__exportStar(Q6(),r)}(_o)),_o}var t8=e8();function vr(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function oi(r=6){return BigInt(vr(r))}function Kr(r,e,t){return{id:t||vr(),jsonrpc:"2.0",method:r,params:e}}function ca(r,e){return{id:r,jsonrpc:"2.0",result:e}}function ha(r,e,t){return{id:r,jsonrpc:"2.0",error:r8(e)}}function r8(r,e){return typeof r>"u"?_f(vp):(typeof r=="string"&&(r=Object.assign(Object.assign({},_f(Uc)),{message:r})),P6(r.code)&&(r=O6(r.code)),r)}class i8{}class s8 extends i8{constructor(){super()}}class n8 extends s8{constructor(e){super()}}const a8="^https?:",o8="^wss?:";function c8(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function _p(r,e){const t=c8(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function $f(r){return _p(r,a8)}function If(r){return _p(r,o8)}function h8(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function Ep(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function zc(r){return Ep(r)&&"method"in r}function ua(r){return Ep(r)&&(yr(r)||Vt(r))}function yr(r){return"result"in r}function Vt(r){return"error"in r}let Jt=class extends n8{constructor(e){super(e),this.events=new Lt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Kr(e.method,e.params||[],e.id||oi().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{Vt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ua(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const u8=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),f8=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Df=r=>r.split("?")[0],Af=10,d8=u8();let l8=class{constructor(e){if(this.url=e,this.events=new Lt.EventEmitter,this.registering=!1,!If(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Cr(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!If(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=t8.isReactNative()?void 0:{rejectUnauthorized:!h8(e)},n=new d8(e,[],s);f8()?n.onerror=a=>{const o=a;i(this.emitError(o.error))}:n.on("error",a=>{i(this.emitError(a))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ui(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=ha(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return mp(e,Df(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Af&&this.events.setMaxListeners(Af)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Df(this.url)}`));return this.events.emit("register_error",t),t}};var Ns={exports:{}};Ns.exports;var Pf;function p8(){return Pf||(Pf=1,function(r,e){var t=200,i="__lodash_hash_undefined__",s=1,n=2,a=9007199254740991,o="[object Arguments]",h="[object Array]",c="[object AsyncFunction]",f="[object Boolean]",l="[object Date]",v="[object Error]",w="[object Function]",m="[object GeneratorFunction]",_="[object Map]",O="[object Number]",D="[object Null]",A="[object Object]",M="[object Promise]",R="[object Proxy]",T="[object RegExp]",C="[object Set]",q="[object String]",B="[object Symbol]",N="[object Undefined]",k="[object WeakMap]",I="[object ArrayBuffer]",u="[object DataView]",p="[object Float32Array]",y="[object Float64Array]",b="[object Int8Array]",g="[object Int16Array]",x="[object Int32Array]",$="[object Uint8Array]",E="[object Uint8ClampedArray]",d="[object Uint16Array]",S="[object Uint32Array]",L=/[\\^$.*+?()[\]{}|]/g,j=/^\[object .+?Constructor\]$/,U=/^(?:0|[1-9]\d*)$/,z={};z[p]=z[y]=z[b]=z[g]=z[x]=z[$]=z[E]=z[d]=z[S]=!0,z[o]=z[h]=z[I]=z[f]=z[u]=z[l]=z[v]=z[w]=z[_]=z[O]=z[A]=z[T]=z[C]=z[q]=z[k]=!1;var G=typeof Ot=="object"&&Ot&&Ot.Object===Object&&Ot,X=typeof self=="object"&&self&&self.Object===Object&&self,Z=G||X||Function("return this")(),Y=e&&!e.nodeType&&e,Q=Y&&!0&&r&&!r.nodeType&&r,Qe=Q&&Q.exports===Y,re=Qe&&G.process,ie=function(){try{return re&&re.binding&&re.binding("util")}catch{}}(),nt=ie&&ie.isTypedArray;function oe(P,F){for(var H=-1,J=P==null?0:P.length,Ae=0,ee=[];++H<J;){var Ze=P[H];F(Ze,H,P)&&(ee[Ae++]=Ze)}return ee}function fe(P,F){for(var H=-1,J=F.length,Ae=P.length;++H<J;)P[Ae+H]=F[H];return P}function jt(P,F){for(var H=-1,J=P==null?0:P.length;++H<J;)if(F(P[H],H,P))return!0;return!1}function xe(P,F){for(var H=-1,J=Array(P);++H<P;)J[H]=F(H);return J}function ye(P){return function(F){return P(F)}}function ar(P,F){return P.has(F)}function ge(P,F){return P==null?void 0:P[F]}function me(P){var F=-1,H=Array(P.size);return P.forEach(function(J,Ae){H[++F]=[Ae,J]}),H}function or(P,F){return function(H){return P(F(H))}}function de(P){var F=-1,H=Array(P.size);return P.forEach(function(J){H[++F]=J}),H}var le=Array.prototype,cr=Function.prototype,pe=Object.prototype,$e=Z["__core-js_shared__"],Gr=cr.toString,ae=pe.hasOwnProperty,Ne=function(){var P=/[^.]+$/.exec($e&&$e.keys&&$e.keys.IE_PROTO||"");return P?"Symbol(src)_1."+P:""}(),rs=pe.toString,ke=RegExp("^"+Gr.call(ae).replace(L,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fe=Qe?Z.Buffer:void 0,Jr=Z.Symbol,qe=Z.Uint8Array,Be=pe.propertyIsEnumerable,an=le.splice,we=Jr?Jr.toStringTag:void 0,Le=Object.getOwnPropertySymbols,on=Fe?Fe.isBuffer:void 0,He=or(Object.keys,Object),Me=wi(Z,"DataView"),Tr=wi(Z,"Map"),Ce=wi(Z,"Promise"),Re=wi(Z,"Set"),mi=wi(Z,"WeakMap"),Ie=wi(Object,"create"),Ke=Yr(Me),cn=Yr(Tr),Ve=Yr(Ce),We=Yr(Re),hn=Yr(mi),je=Jr?Jr.prototype:void 0,Te=je?je.valueOf:void 0;function hr(P){var F=-1,H=P==null?0:P.length;for(this.clear();++F<H;){var J=P[F];this.set(J[0],J[1])}}function Ge(){this.__data__=Ie?Ie(null):{},this.size=0}function Je(P){var F=this.has(P)&&delete this.__data__[P];return this.size-=F?1:0,F}function un(P){var F=this.__data__;if(Ie){var H=F[P];return H===i?void 0:H}return ae.call(F,P)?F[P]:void 0}function Ye(P){var F=this.__data__;return Ie?F[P]!==void 0:ae.call(F,P)}function Xe(P,F){var H=this.__data__;return this.size+=this.has(P)?0:1,H[P]=Ie&&F===void 0?i:F,this}hr.prototype.clear=Ge,hr.prototype.delete=Je,hr.prototype.get=un,hr.prototype.has=Ye,hr.prototype.set=Xe;function Ct(P){var F=-1,H=P==null?0:P.length;for(this.clear();++F<H;){var J=P[F];this.set(J[0],J[1])}}function is(){this.__data__=[],this.size=0}function ss(P){var F=this.__data__,H=fn(F,P);if(H<0)return!1;var J=F.length-1;return H==J?F.pop():an.call(F,H,1),--this.size,!0}function ns(P){var F=this.__data__,H=fn(F,P);return H<0?void 0:F[H][1]}function as(P){return fn(this.__data__,P)>-1}function os(P,F){var H=this.__data__,J=fn(H,P);return J<0?(++this.size,H.push([P,F])):H[J][1]=F,this}Ct.prototype.clear=is,Ct.prototype.delete=ss,Ct.prototype.get=ns,Ct.prototype.has=as,Ct.prototype.set=os;function Xt(P){var F=-1,H=P==null?0:P.length;for(this.clear();++F<H;){var J=P[F];this.set(J[0],J[1])}}function cs(){this.size=0,this.__data__={hash:new hr,map:new(Tr||Ct),string:new hr}}function hs(P){var F=dn(this,P).delete(P);return this.size-=F?1:0,F}function us(P){return dn(this,P).get(P)}function fs(P){return dn(this,P).has(P)}function ds(P,F){var H=dn(this,P),J=H.size;return H.set(P,F),this.size+=H.size==J?0:1,this}Xt.prototype.clear=cs,Xt.prototype.delete=hs,Xt.prototype.get=us,Xt.prototype.has=fs,Xt.prototype.set=ds;function Nr(P){var F=-1,H=P==null?0:P.length;for(this.__data__=new Xt;++F<H;)this.add(P[F])}function ls(P){return this.__data__.set(P,i),this}function ps(P){return this.__data__.has(P)}Nr.prototype.add=Nr.prototype.push=ls,Nr.prototype.has=ps;function Ut(P){var F=this.__data__=new Ct(P);this.size=F.size}function bs(){this.__data__=new Ct,this.size=0}function gs(P){var F=this.__data__,H=F.delete(P);return this.size=F.size,H}function vs(P){return this.__data__.get(P)}function f0(P){return this.__data__.has(P)}function d0(P,F){var H=this.__data__;if(H instanceof Ct){var J=H.__data__;if(!Tr||J.length<t-1)return J.push([P,F]),this.size=++H.size,this;H=this.__data__=new Xt(J)}return H.set(P,F),this.size=H.size,this}Ut.prototype.clear=bs,Ut.prototype.delete=gs,Ut.prototype.get=vs,Ut.prototype.has=f0,Ut.prototype.set=d0;function l0(P,F){var H=ln(P),J=!H&&A0(P),Ae=!H&&!J&&ma(P),ee=!H&&!J&&!Ae&&sh(P),Ze=H||J||Ae||ee,at=Ze?xe(P.length,String):[],dt=at.length;for(var Ue in P)ae.call(P,Ue)&&!(Ze&&(Ue=="length"||Ae&&(Ue=="offset"||Ue=="parent")||ee&&(Ue=="buffer"||Ue=="byteLength"||Ue=="byteOffset")||x0(Ue,dt)))&&at.push(Ue);return at}function fn(P,F){for(var H=P.length;H--;)if(eh(P[H][0],F))return H;return-1}function p0(P,F,H){var J=F(P);return ln(P)?J:fe(J,H(P))}function ys(P){return P==null?P===void 0?N:D:we&&we in Object(P)?_0(P):D0(P)}function Yc(P){return ms(P)&&ys(P)==o}function Xc(P,F,H,J,Ae){return P===F?!0:P==null||F==null||!ms(P)&&!ms(F)?P!==P&&F!==F:b0(P,F,H,J,Xc,Ae)}function b0(P,F,H,J,Ae,ee){var Ze=ln(P),at=ln(F),dt=Ze?h:Fr(P),Ue=at?h:Fr(F);dt=dt==o?A:dt,Ue=Ue==o?A:Ue;var Rt=dt==A,Zt=Ue==A,mt=dt==Ue;if(mt&&ma(P)){if(!ma(F))return!1;Ze=!0,Rt=!1}if(mt&&!Rt)return ee||(ee=new Ut),Ze||sh(P)?Zc(P,F,H,J,Ae,ee):m0(P,F,dt,H,J,Ae,ee);if(!(H&s)){var zt=Rt&&ae.call(P,"__wrapped__"),kt=Zt&&ae.call(F,"__wrapped__");if(zt||kt){var qr=zt?P.value():P,Er=kt?F.value():F;return ee||(ee=new Ut),Ae(qr,Er,H,J,ee)}}return mt?(ee||(ee=new Ut),w0(P,F,H,J,Ae,ee)):!1}function g0(P){if(!ih(P)||$0(P))return!1;var F=th(P)?ke:j;return F.test(Yr(P))}function v0(P){return ms(P)&&rh(P.length)&&!!z[ys(P)]}function y0(P){if(!I0(P))return He(P);var F=[];for(var H in Object(P))ae.call(P,H)&&H!="constructor"&&F.push(H);return F}function Zc(P,F,H,J,Ae,ee){var Ze=H&s,at=P.length,dt=F.length;if(at!=dt&&!(Ze&&dt>at))return!1;var Ue=ee.get(P);if(Ue&&ee.get(F))return Ue==F;var Rt=-1,Zt=!0,mt=H&n?new Nr:void 0;for(ee.set(P,F),ee.set(F,P);++Rt<at;){var zt=P[Rt],kt=F[Rt];if(J)var qr=Ze?J(kt,zt,Rt,F,P,ee):J(zt,kt,Rt,P,F,ee);if(qr!==void 0){if(qr)continue;Zt=!1;break}if(mt){if(!jt(F,function(Er,Xr){if(!ar(mt,Xr)&&(zt===Er||Ae(zt,Er,H,J,ee)))return mt.push(Xr)})){Zt=!1;break}}else if(!(zt===kt||Ae(zt,kt,H,J,ee))){Zt=!1;break}}return ee.delete(P),ee.delete(F),Zt}function m0(P,F,H,J,Ae,ee,Ze){switch(H){case u:if(P.byteLength!=F.byteLength||P.byteOffset!=F.byteOffset)return!1;P=P.buffer,F=F.buffer;case I:return!(P.byteLength!=F.byteLength||!ee(new qe(P),new qe(F)));case f:case l:case O:return eh(+P,+F);case v:return P.name==F.name&&P.message==F.message;case T:case q:return P==F+"";case _:var at=me;case C:var dt=J&s;if(at||(at=de),P.size!=F.size&&!dt)return!1;var Ue=Ze.get(P);if(Ue)return Ue==F;J|=n,Ze.set(P,F);var Rt=Zc(at(P),at(F),J,Ae,ee,Ze);return Ze.delete(P),Rt;case B:if(Te)return Te.call(P)==Te.call(F)}return!1}function w0(P,F,H,J,Ae,ee){var Ze=H&s,at=Qc(P),dt=at.length,Ue=Qc(F),Rt=Ue.length;if(dt!=Rt&&!Ze)return!1;for(var Zt=dt;Zt--;){var mt=at[Zt];if(!(Ze?mt in F:ae.call(F,mt)))return!1}var zt=ee.get(P);if(zt&&ee.get(F))return zt==F;var kt=!0;ee.set(P,F),ee.set(F,P);for(var qr=Ze;++Zt<dt;){mt=at[Zt];var Er=P[mt],Xr=F[mt];if(J)var nh=Ze?J(Xr,Er,mt,F,P,ee):J(Er,Xr,mt,P,F,ee);if(!(nh===void 0?Er===Xr||Ae(Er,Xr,H,J,ee):nh)){kt=!1;break}qr||(qr=mt=="constructor")}if(kt&&!qr){var pn=P.constructor,bn=F.constructor;pn!=bn&&"constructor"in P&&"constructor"in F&&!(typeof pn=="function"&&pn instanceof pn&&typeof bn=="function"&&bn instanceof bn)&&(kt=!1)}return ee.delete(P),ee.delete(F),kt}function Qc(P){return p0(P,M0,E0)}function dn(P,F){var H=P.__data__;return S0(F)?H[typeof F=="string"?"string":"hash"]:H.map}function wi(P,F){var H=ge(P,F);return g0(H)?H:void 0}function _0(P){var F=ae.call(P,we),H=P[we];try{P[we]=void 0;var J=!0}catch{}var Ae=rs.call(P);return J&&(F?P[we]=H:delete P[we]),Ae}var E0=Le?function(P){return P==null?[]:(P=Object(P),oe(Le(P),function(F){return Be.call(P,F)}))}:C0,Fr=ys;(Me&&Fr(new Me(new ArrayBuffer(1)))!=u||Tr&&Fr(new Tr)!=_||Ce&&Fr(Ce.resolve())!=M||Re&&Fr(new Re)!=C||mi&&Fr(new mi)!=k)&&(Fr=function(P){var F=ys(P),H=F==A?P.constructor:void 0,J=H?Yr(H):"";if(J)switch(J){case Ke:return u;case cn:return _;case Ve:return M;case We:return C;case hn:return k}return F});function x0(P,F){return F=F??a,!!F&&(typeof P=="number"||U.test(P))&&P>-1&&P%1==0&&P<F}function S0(P){var F=typeof P;return F=="string"||F=="number"||F=="symbol"||F=="boolean"?P!=="__proto__":P===null}function $0(P){return!!Ne&&Ne in P}function I0(P){var F=P&&P.constructor,H=typeof F=="function"&&F.prototype||pe;return P===H}function D0(P){return rs.call(P)}function Yr(P){if(P!=null){try{return Gr.call(P)}catch{}try{return P+""}catch{}}return""}function eh(P,F){return P===F||P!==P&&F!==F}var A0=Yc(function(){return arguments}())?Yc:function(P){return ms(P)&&ae.call(P,"callee")&&!Be.call(P,"callee")},ln=Array.isArray;function P0(P){return P!=null&&rh(P.length)&&!th(P)}var ma=on||R0;function O0(P,F){return Xc(P,F)}function th(P){if(!ih(P))return!1;var F=ys(P);return F==w||F==m||F==c||F==R}function rh(P){return typeof P=="number"&&P>-1&&P%1==0&&P<=a}function ih(P){var F=typeof P;return P!=null&&(F=="object"||F=="function")}function ms(P){return P!=null&&typeof P=="object"}var sh=nt?ye(nt):v0;function M0(P){return P0(P)?l0(P):y0(P)}function C0(){return[]}function R0(){return!1}r.exports=O0}(Ns,Ns.exports)),Ns.exports}var b8=p8();const g8=Xn(b8),xp="wc",Sp=2,rc="core",wr=`${xp}@2:${rc}:`,v8={logger:"error"},y8={database:":memory:"},m8="crypto",Of="client_ed25519_seed",w8=V.ONE_DAY,_8="keychain",E8="0.3",x8="messages",S8="0.3",Mf=V.SIX_HOURS,$8="publisher",$p="irn",I8="error",Ip="wss://relay.walletconnect.org",D8="relayer",ut={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},A8="_subscription",Ht={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},P8=.1,ic="2.19.0",Oe={link_mode:"link_mode",relay:"relay"},O8="0.3",M8="WALLETCONNECT_CLIENT_ID",Cf="WALLETCONNECT_LINK_MODE_APPS",Nt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},C8="subscription",R8="0.3",T8=V.FIVE_SECONDS*1e3,N8="pairing",F8="0.3",As={wc_pairingDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:V.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:V.ONE_DAY,prompt:!1,tag:0},res:{ttl:V.ONE_DAY,prompt:!1,tag:0}}},ni={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},er={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},q8="history",B8="0.3",L8="expirer",Kt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},j8="0.3",U8="verify-api",z8="https://verify.walletconnect.com",Dp="https://verify.walletconnect.org",Bs=Dp,k8=`${Bs}/v3`,H8=[z8,Dp],K8="echo",V8="https://echo.walletconnect.com",gr={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Pr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},tr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},ti={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},ri={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ps={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},W8=.1,G8="event-client",J8=86400,Y8="https://pulse.walletconnect.org/batch";function X8(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,h=r.charAt(0),c=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var _=0,O=0,D=0,A=m.length;D!==A&&m[D]===0;)D++,_++;for(var M=(A-D)*f+1>>>0,R=new Uint8Array(M);D!==A;){for(var T=m[D],C=0,q=M-1;(T!==0||C<O)&&q!==-1;q--,C++)T+=256*R[q]>>>0,R[q]=T%o>>>0,T=T/o>>>0;if(T!==0)throw new Error("Non-zero carry");O=C,D++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var N=h.repeat(_);B<M;++B)N+=r.charAt(R[B]);return N}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var _=0;if(m[_]!==" "){for(var O=0,D=0;m[_]===h;)O++,_++;for(var A=(m.length-_)*c+1>>>0,M=new Uint8Array(A);m[_];){var R=t[m.charCodeAt(_)];if(R===255)return;for(var T=0,C=A-1;(R!==0||T<D)&&C!==-1;C--,T++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");D=T,_++}if(m[_]!==" "){for(var q=A-D;q!==A&&M[q]===0;)q++;for(var B=new Uint8Array(O+(A-q)),N=O;q!==A;)B[N++]=M[q++];return B}}}function w(m){var _=v(m);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:w}}var Z8=X8,Q8=Z8;const Ap=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},e4=r=>new TextEncoder().encode(r),t4=r=>new TextDecoder().decode(r);let r4=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},i4=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Pp(this,e)}},s4=class{constructor(e){this.decoders=e}or(e){return Pp(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Pp=(r,e)=>new s4({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let n4=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new r4(e,t,i),this.decoder=new i4(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const fa=({name:r,prefix:e,encode:t,decode:i})=>new n4(r,e,t,i),sn=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Q8(t,e);return fa({prefix:r,name:e,encode:i,decode:n=>Ap(s(n))})},a4=(r,e,t,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,c=0;for(let f=0;f<n;++f){const l=s[r[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return a},o4=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},yt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>fa({prefix:e,name:r,encode(s){return o4(s,i,t)},decode(s){return a4(s,i,t,r)}}),c4=fa({prefix:"\0",name:"identity",encode:r=>t4(r),decode:r=>e4(r)});var h4=Object.freeze({__proto__:null,identity:c4});const u4=yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var f4=Object.freeze({__proto__:null,base2:u4});const d4=yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var l4=Object.freeze({__proto__:null,base8:d4});const p4=sn({prefix:"9",name:"base10",alphabet:"0123456789"});var b4=Object.freeze({__proto__:null,base10:p4});const g4=yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),v4=yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y4=Object.freeze({__proto__:null,base16:g4,base16upper:v4});const m4=yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),w4=yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_4=yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),E4=yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),x4=yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),S4=yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$4=yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),I4=yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),D4=yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var A4=Object.freeze({__proto__:null,base32:m4,base32upper:w4,base32pad:_4,base32padupper:E4,base32hex:x4,base32hexupper:S4,base32hexpad:$4,base32hexpadupper:I4,base32z:D4});const P4=sn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),O4=sn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var M4=Object.freeze({__proto__:null,base36:P4,base36upper:O4});const C4=sn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),R4=sn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var T4=Object.freeze({__proto__:null,base58btc:C4,base58flickr:R4});const N4=yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),F4=yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),q4=yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),B4=yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var L4=Object.freeze({__proto__:null,base64:N4,base64pad:F4,base64url:q4,base64urlpad:B4});const Op=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),j4=Op.reduce((r,e,t)=>(r[t]=e,r),[]),U4=Op.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function z4(r){return r.reduce((e,t)=>(e+=j4[t],e),"")}function k4(r){const e=[];for(const t of r){const i=U4[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const H4=fa({prefix:"🚀",name:"base256emoji",encode:z4,decode:k4});var K4=Object.freeze({__proto__:null,base256emoji:H4}),V4=Mp,Rf=128,W4=-128,G4=Math.pow(2,31);function Mp(r,e,t){e=e||[],t=t||0;for(var i=t;r>=G4;)e[t++]=r&255|Rf,r/=128;for(;r&W4;)e[t++]=r&255|Rf,r>>>=7;return e[t]=r|0,Mp.bytes=t-i+1,e}var J4=sc,Y4=128,Tf=127;function sc(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw sc.bytes=0,new RangeError("Could not decode varint");a=r[n++],t+=s<28?(a&Tf)<<s:(a&Tf)*Math.pow(2,s),s+=7}while(a>=Y4);return sc.bytes=n-i,t}var X4=Math.pow(2,7),Z4=Math.pow(2,14),Q4=Math.pow(2,21),e5=Math.pow(2,28),t5=Math.pow(2,35),r5=Math.pow(2,42),i5=Math.pow(2,49),s5=Math.pow(2,56),n5=Math.pow(2,63),a5=function(r){return r<X4?1:r<Z4?2:r<Q4?3:r<e5?4:r<t5?5:r<r5?6:r<i5?7:r<s5?8:r<n5?9:10},o5={encode:V4,decode:J4,encodingLength:a5},Cp=o5;const Nf=(r,e,t=0)=>(Cp.encode(r,e,t),e),Ff=r=>Cp.encodingLength(r),nc=(r,e)=>{const t=e.byteLength,i=Ff(r),s=i+Ff(t),n=new Uint8Array(s+t);return Nf(r,n,0),Nf(t,n,i),n.set(e,s),new c5(r,t,e,n)};let c5=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Rp=({name:r,code:e,encode:t})=>new h5(r,e,t);let h5=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?nc(this.code,t):t.then(i=>nc(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Tp=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),u5=Rp({name:"sha2-256",code:18,encode:Tp("SHA-256")}),f5=Rp({name:"sha2-512",code:19,encode:Tp("SHA-512")});var d5=Object.freeze({__proto__:null,sha256:u5,sha512:f5});const Np=0,l5="identity",Fp=Ap,p5=r=>nc(Np,Fp(r)),b5={code:Np,name:l5,encode:Fp,digest:p5};var g5=Object.freeze({__proto__:null,identity:b5});new TextEncoder,new TextDecoder;const qf={...h4,...f4,...l4,...b4,...y4,...A4,...M4,...T4,...L4,...K4};({...d5,...g5});function v5(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function qp(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Bf=qp("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Eo=qp("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=v5(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),y5={utf8:Bf,"utf-8":Bf,hex:qf.base16,latin1:Eo,ascii:Eo,binary:Eo,...qf};function m5(r,e="utf8"){const t=y5[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}var w5=Object.defineProperty,_5=(r,e,t)=>e in r?w5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lr=(r,e,t)=>_5(r,typeof e!="symbol"?e+"":e,t);let E5=class{constructor(e,t){this.core=e,this.logger=t,lr(this,"keychain",new Map),lr(this,"name",_8),lr(this,"version",E8),lr(this,"initialized",!1),lr(this,"storagePrefix",wr),lr(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),lr(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),lr(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),lr(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),lr(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=St(t,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Bl(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ll(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var x5=Object.defineProperty,S5=(r,e,t)=>e in r?x5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pt=(r,e,t)=>S5(r,typeof e!="symbol"?e+"":e,t);let $5=class{constructor(e,t,i){this.core=e,this.logger=t,pt(this,"name",m8),pt(this,"keychain"),pt(this,"randomSessionIdentifier",Xo()),pt(this,"initialized",!1),pt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),pt(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),pt(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=kh(s);return xl(n.publicKey)}),pt(this,"generateKeyPair",()=>{this.isInitialized();const s=h3();return this.setPrivateKey(s.publicKey,s.privateKey)}),pt(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),a=kh(n),o=this.randomSessionIdentifier;return await Bv(o,s,w8,a)}),pt(this,"generateSharedKey",(s,n,a)=>{this.isInitialized();const o=this.getPrivateKey(s),h=u3(o,n);return this.setSymKey(h,a)}),pt(this,"setSymKey",async(s,n)=>{this.isInitialized();const a=n||qn(s);return await this.keychain.set(a,s),a}),pt(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),pt(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),pt(this,"encode",async(s,n,a)=>{this.isInitialized();const o=fp(a),h=Cr(n);if(Qu(o))return l3(h,a==null?void 0:a.encoding);if(Zu(o)){const v=o.senderPublicKey,w=o.receiverPublicKey;s=await this.generateSharedKey(v,w)}const c=this.getSymKey(s),{type:f,senderPublicKey:l}=o;return f3({type:f,symKey:c,message:h,senderPublicKey:l,encoding:a==null?void 0:a.encoding})}),pt(this,"decode",async(s,n,a)=>{this.isInitialized();const o=b3(n,a);if(Qu(o)){const h=p3(n,a==null?void 0:a.encoding);return ui(h)}if(Zu(o)){const h=o.receiverPublicKey,c=o.senderPublicKey;s=await this.generateSharedKey(h,c)}try{const h=this.getSymKey(s),c=d3({symKey:h,encoded:n,encoding:a==null?void 0:a.encoding});return ui(c)}catch(h){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}}),pt(this,"getPayloadType",(s,n=Hr)=>{const a=ks({encoded:s,encoding:n});return di(a.type)}),pt(this,"getPayloadSenderPublicKey",(s,n=Hr)=>{const a=ks({encoded:s,encoding:n});return a.senderPublicKey?xt(a.senderPublicKey,_t):void 0}),this.core=e,this.logger=St(t,this.name),this.keychain=i||new E5(this.core,this.logger)}get context(){return Mt(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Of)}catch{e=Xo(),await this.keychain.set(Of,e)}return m5(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var I5=Object.defineProperty,D5=(r,e,t)=>e in r?I5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pr=(r,e,t)=>D5(r,typeof e!="symbol"?e+"":e,t);let A5=class extends f6{constructor(e,t){super(e,t),this.logger=e,this.core=t,pr(this,"messages",new Map),pr(this,"name",x8),pr(this,"version",S8),pr(this,"initialized",!1),pr(this,"storagePrefix",wr),pr(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),pr(this,"set",async(i,s)=>{this.isInitialized();const n=Or(s);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=s,this.messages.set(i,a),await this.persist()),n}),pr(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),pr(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),a=Or(s);return typeof n[a]<"u"}),pr(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()}),this.logger=St(e,this.name),this.core=t}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Bl(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ll(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var P5=Object.defineProperty,O5=Object.defineProperties,M5=Object.getOwnPropertyDescriptors,Lf=Object.getOwnPropertySymbols,C5=Object.prototype.hasOwnProperty,R5=Object.prototype.propertyIsEnumerable,ac=(r,e,t)=>e in r?P5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dn=(r,e)=>{for(var t in e||(e={}))C5.call(e,t)&&ac(r,t,e[t]);if(Lf)for(var t of Lf(e))R5.call(e,t)&&ac(r,t,e[t]);return r},xo=(r,e)=>O5(r,M5(e)),rr=(r,e,t)=>ac(r,typeof e!="symbol"?e+"":e,t);let T5=class extends d6{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,rr(this,"events",new Lt.EventEmitter),rr(this,"name",$8),rr(this,"queue",new Map),rr(this,"publishTimeout",V.toMiliseconds(V.ONE_MINUTE)),rr(this,"initialPublishTimeout",V.toMiliseconds(V.ONE_SECOND*15)),rr(this,"needsTransportRestart",!1),rr(this,"publish",async(i,s,n)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const o=(n==null?void 0:n.ttl)||Mf,h=Kn(n),c=(n==null?void 0:n.prompt)||!1,f=(n==null?void 0:n.tag)||0,l=(n==null?void 0:n.id)||oi().toString(),v={topic:i,message:s,opts:{ttl:o,relay:h,prompt:c,tag:f,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},w=`Failed to publish payload, please try again. id:${l} tag:${f}`;try{const m=new Promise(async _=>{const O=({id:A})=>{v.opts.id===A&&(this.removeRequestFromQueue(A),this.relayer.events.removeListener(ut.publish,O),_(v))};this.relayer.events.on(ut.publish,O);const D=kr(new Promise((A,M)=>{this.rpcPublish({topic:i,message:s,ttl:o,prompt:c,tag:f,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(A).catch(R=>{this.logger.warn(R,R==null?void 0:R.message),M(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${f}`);try{await D,this.events.removeListener(ut.publish,O)}catch(A){this.queue.set(l,xo(Dn({},v),{attempt:1})),this.logger.warn(A,A==null?void 0:A.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:i,message:s,opts:n}}),await kr(m,this.publishTimeout,w)}catch(m){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(m),(a=n==null?void 0:n.internal)!=null&&a.throwOnFailedPublish)throw m}finally{this.queue.delete(l)}}),rr(this,"on",(i,s)=>{this.events.on(i,s)}),rr(this,"once",(i,s)=>{this.events.once(i,s)}),rr(this,"off",(i,s)=>{this.events.off(i,s)}),rr(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=St(t,this.name),this.registerEventListeners()}get context(){return Mt(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:a,message:o,ttl:h=Mf,prompt:c,tag:f,id:l,attestation:v,tvf:w}=e,m={method:Rs(Kn().protocol).publish,params:Dn({topic:a,message:o,ttl:h,prompt:c,tag:f,attestation:v},w),id:l};Et((t=m.params)==null?void 0:t.prompt)&&((i=m.params)==null||delete i.prompt),Et((s=m.params)==null?void 0:s.tag)&&((n=m.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:m});const _=await this.relayer.request(m);return this.relayer.events.emit(ut.publish,e),this.logger.debug("Successfully Published Payload"),_}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,xo(Dn({},e),{attempt:i}));const{topic:s,message:n,opts:a,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(xo(Dn({},e),{topic:s,message:n,ttl:a.ttl,prompt:a.prompt,tag:a.tag,id:a.id,attestation:o,tvf:a.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(es.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ut.connection_stalled);return}this.checkQueue()}),this.relayer.on(ut.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var N5=Object.defineProperty,F5=(r,e,t)=>e in r?N5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$i=(r,e,t)=>F5(r,typeof e!="symbol"?e+"":e,t);let q5=class{constructor(){$i(this,"map",new Map),$i(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),$i(this,"get",e=>this.map.get(e)||[]),$i(this,"exists",(e,t)=>this.get(e).includes(t)),$i(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),$i(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var B5=Object.defineProperty,L5=Object.defineProperties,j5=Object.getOwnPropertyDescriptors,jf=Object.getOwnPropertySymbols,U5=Object.prototype.hasOwnProperty,z5=Object.prototype.propertyIsEnumerable,oc=(r,e,t)=>e in r?B5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Os=(r,e)=>{for(var t in e||(e={}))U5.call(e,t)&&oc(r,t,e[t]);if(jf)for(var t of jf(e))z5.call(e,t)&&oc(r,t,e[t]);return r},So=(r,e)=>L5(r,j5(e)),Ee=(r,e,t)=>oc(r,typeof e!="symbol"?e+"":e,t);let k5=class extends b6{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Ee(this,"subscriptions",new Map),Ee(this,"topicMap",new q5),Ee(this,"events",new Lt.EventEmitter),Ee(this,"name",C8),Ee(this,"version",R8),Ee(this,"pending",new Map),Ee(this,"cached",[]),Ee(this,"initialized",!1),Ee(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),Ee(this,"pollingInterval",20),Ee(this,"storagePrefix",wr),Ee(this,"subscribeTimeout",V.toMiliseconds(V.ONE_MINUTE)),Ee(this,"initialSubscribeTimeout",V.toMiliseconds(V.ONE_SECOND*15)),Ee(this,"clientId"),Ee(this,"batchSubscribeTopicsLimit",500),Ee(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ee(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=Kn(s),a={topic:i,relay:n,transportType:s==null?void 0:s.transportType};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n,s);return typeof o=="string"&&(this.onSubscribe(o,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),o}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),Ee(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),Ee(this,"isSubscribed",async i=>{if(this.topics.includes(i))return!0;const s=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((n,a)=>{const o=new V.Watch;o.start(s);const h=setInterval(()=>{(!this.pending.has(i)&&this.topics.includes(i)||this.cached.some(c=>c.topic===i))&&(clearInterval(h),o.stop(s),n(!0)),o.elapsed(s)>=T8&&(clearInterval(h),o.stop(s),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)}),Ee(this,"on",(i,s)=>{this.events.on(i,s)}),Ee(this,"once",(i,s)=>{this.events.once(i,s)}),Ee(this,"off",(i,s)=>{this.events.off(i,s)}),Ee(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),Ee(this,"start",async()=>{await this.onConnect()}),Ee(this,"stop",async()=>{await this.onDisconnect()}),Ee(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ee(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),Ee(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(es.pulse,async()=>{await this.checkPending()}),this.events.on(Nt.created,async i=>{const s=Nt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(Nt.deleted,async i=>{const s=Nt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=St(t,this.name),this.clientId=""}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Kn(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=ve("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||(i==null?void 0:i.transportType)===Oe.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:Rs(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const a=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const o=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===Oe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(f=>this.logger.warn(f))},V.toMiliseconds(V.ONE_SECOND)),o;const h=new Promise(async f=>{const l=v=>{v.topic===e&&(this.events.removeListener(Nt.created,l),f(v.id))};this.events.on(Nt.created,l);try{const v=await kr(new Promise((w,m)=>{this.relayer.request(n).catch(_=>{this.logger.warn(_,_==null?void 0:_.message),m(_)}).then(w)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Nt.created,l),f(v)}catch{}}),c=await kr(h,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!c&&a)throw new Error(`Subscribing to ${e} failed, please try again`);return c?o:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ut.connection_stalled),a)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:Rs(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await kr(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:Rs(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await kr(new Promise((n,a)=>{this.relayer.request(i).catch(o=>{this.logger.warn(o),a(o)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Rs(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,So(Os({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Os({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Os({},t)),this.topicMap.set(t.topic,e),this.events.emit(Nt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Nt.deleted,So(Os({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Nt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Nt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>So(Os({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await xm(V.toMiliseconds(V.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Or(e+await this.getClientId())}};var H5=Object.defineProperty,Uf=Object.getOwnPropertySymbols,K5=Object.prototype.hasOwnProperty,V5=Object.prototype.propertyIsEnumerable,cc=(r,e,t)=>e in r?H5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zf=(r,e)=>{for(var t in e||(e={}))K5.call(e,t)&&cc(r,t,e[t]);if(Uf)for(var t of Uf(e))V5.call(e,t)&&cc(r,t,e[t]);return r},he=(r,e,t)=>cc(r,typeof e!="symbol"?e+"":e,t);let W5=class extends l6{constructor(e){super(e),he(this,"protocol","wc"),he(this,"version",2),he(this,"core"),he(this,"logger"),he(this,"events",new Lt.EventEmitter),he(this,"provider"),he(this,"messages"),he(this,"subscriber"),he(this,"publisher"),he(this,"name",D8),he(this,"transportExplicitlyClosed",!1),he(this,"initialized",!1),he(this,"connectionAttemptInProgress",!1),he(this,"relayUrl"),he(this,"projectId"),he(this,"packageName"),he(this,"bundleId"),he(this,"hasExperiencedNetworkDisruption",!1),he(this,"pingTimeout"),he(this,"heartBeatTimeout",V.toMiliseconds(V.THIRTY_SECONDS+V.FIVE_SECONDS)),he(this,"reconnectTimeout"),he(this,"connectPromise"),he(this,"reconnectInProgress",!1),he(this,"requestsInFlight",[]),he(this,"connectTimeout",V.toMiliseconds(V.ONE_SECOND*15)),he(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||oi().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const o=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(h=>h!==a),o}catch(a){throw this.logger.debug(`Failed to Publish Request: ${n}`),a}}),he(this,"resetPingTimeout",()=>{if(kn())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(t){this.logger.warn(t,t==null?void 0:t.message)}}),he(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),he(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(ut.connect)}),he(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),he(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(ut.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),he(this,"registerProviderListeners",()=>{this.provider.on(Ht.payload,this.onPayloadHandler),this.provider.on(Ht.connect,this.onConnectHandler),this.provider.on(Ht.disconnect,this.onDisconnectHandler),this.provider.on(Ht.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?St(e.logger,this.name):tn(oa({level:e.logger||I8})),this.messages=new A5(this.logger,e.core),this.subscriber=new k5(this,this.logger),this.publisher=new T5(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Ip,this.projectId=e.projectId,cm()?this.packageName=$u():hm()&&(this.bundleId=$u()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return Mt(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:Oe.relay})}async subscribe(e,t){var i,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const a=typeof((i=t==null?void 0:t.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish;let o=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",h;const c=f=>{f.topic===e&&(this.subscriber.off(Nt.created,c),h())};return await Promise.all([new Promise(f=>{h=f,this.subscriber.on(Nt.created,c)}),new Promise(async(f,l)=>{o=await this.subscriber.subscribe(e,zf({internal:{throwOnFailedPublish:a}},t)).catch(v=>{a&&l(v)})||o,f()})]),o}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await kr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await cf())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const s=it(V.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(ut.message,e),await this.recordMessageEvent(e)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ht.disconnect,n),await kr(new Promise((a,o)=>{this.provider.connect().then(a).catch(o)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{s(a)}).finally(()=>{this.provider.off(Ht.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,o)=>{const h=()=>{o(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ht.disconnect,h),await this.subscriber.start().then(a).catch(o).finally(()=>{this.provider.off(Ht.disconnect,h)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,V.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,i,s,n;if(kn())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a==null?void 0:a.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Jt(new l8(lm({sdkVersion:ic,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.warn(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),zc(e)){if(!e.method.endsWith(A8))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:a}=t.data,o={topic:i,message:s,publishedAt:n,transportType:Oe.relay,attestation:a};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(zf({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else ua(e)&&this.events.emit(ut.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(ut.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ca(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Ht.payload,this.onPayloadHandler),this.provider.off(Ht.connect,this.onConnectHandler),this.provider.off(Ht.disconnect,this.onDisconnectHandler),this.provider.off(Ht.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await cf();rw(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ut.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},V.toMiliseconds(P8)))))}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}};var G5=Object.defineProperty,kf=Object.getOwnPropertySymbols,J5=Object.prototype.hasOwnProperty,Y5=Object.prototype.propertyIsEnumerable,hc=(r,e,t)=>e in r?G5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hf=(r,e)=>{for(var t in e||(e={}))J5.call(e,t)&&hc(r,t,e[t]);if(kf)for(var t of kf(e))Y5.call(e,t)&&hc(r,t,e[t]);return r},It=(r,e,t)=>hc(r,typeof e!="symbol"?e+"":e,t);let gi=class extends p6{constructor(e,t,i,s=wr,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,It(this,"map",new Map),It(this,"version",O8),It(this,"cached",[]),It(this,"initialized",!1),It(this,"getKey"),It(this,"storagePrefix",wr),It(this,"recentlyDeleted",[]),It(this,"recentlyDeletedLimit",200),It(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!Et(a)?this.map.set(this.getKey(a),a):R3(a)?this.map.set(a.id,a):T3(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),It(this,"set",async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:o}),this.map.set(a,o),await this.persist())}),It(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),It(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(h=>g8(o[h],a[h]))):this.values)),It(this,"update",async(a,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:o});const h=Hf(Hf({},this.getData(a)),o);this.map.set(a,h),await this.persist()}),It(this,"delete",async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:o}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=St(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var X5=Object.defineProperty,Z5=(r,e,t)=>e in r?X5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,se=(r,e,t)=>Z5(r,typeof e!="symbol"?e+"":e,t);let Q5=class{constructor(e,t){this.core=e,this.logger=t,se(this,"name",N8),se(this,"version",F8),se(this,"events",new _c),se(this,"pairings"),se(this,"initialized",!1),se(this,"storagePrefix",wr),se(this,"ignoredPayloadTypes",[Mr]),se(this,"registeredMethods",[]),se(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),se(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),se(this,"create",async i=>{this.isInitialized();const s=Xo(),n=await this.core.crypto.setSymKey(s),a=it(V.FIVE_MINUTES),o={protocol:$p},h={topic:n,expiry:a,relay:o,active:!1,methods:i==null?void 0:i.methods},c=tf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:o,expiryTimestamp:a,methods:i==null?void 0:i.methods});return this.events.emit(ni.create,h),this.core.expirer.set(n,a),await this.pairings.set(n,h),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType}),{topic:n,uri:c}}),se(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[gr.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:a,relay:o,expiryTimestamp:h,methods:c}=ef(i.uri);s.props.properties.topic=n,s.addTrace(gr.pairing_uri_validation_success),s.addTrace(gr.pairing_uri_not_expired);let f;if(this.pairings.keys.includes(n)){if(f=this.pairings.get(n),s.addTrace(gr.existing_pairing),f.active)throw s.setError(Pr.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(gr.pairing_not_expired)}const l=h||it(V.FIVE_MINUTES),v={topic:n,relay:o,expiry:l,active:!1,methods:c};this.core.expirer.set(n,l),await this.pairings.set(n,v),s.addTrace(gr.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(ni.create,v),s.addTrace(gr.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(a,n),s.addTrace(gr.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Pr.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:o})}catch(w){throw s.setError(Pr.subscribe_pairing_topic_failure),w}return s.addTrace(gr.subscribe_pairing_topic_success),v}),se(this,"activate",async({topic:i})=>{this.isInitialized();const s=it(V.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),se(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:a,resolve:o,reject:h}=ii();this.events.once(be("pairing_ping",n),({error:c})=>{c?h(c):o()}),await a()}}),se(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),se(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),se(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),se(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ve("USER_DISCONNECTED")),await this.deletePairing(s))}),se(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:a,methods:o}=i,h=this.core.crypto.keychain.get(s);return tf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:h,relay:n,expiryTimestamp:a,methods:o})}),se(this,"sendRequest",async(i,s,n)=>{const a=Kr(s,n),o=await this.core.crypto.encode(i,a),h=As[s].req;return this.core.history.set(i,a),this.core.relayer.publish(i,o,h),a.id}),se(this,"sendResult",async(i,s,n)=>{const a=ca(i,n),o=await this.core.crypto.encode(s,a),h=(await this.core.history.get(s,i)).request.method,c=As[h].res;await this.core.relayer.publish(s,o,c),await this.core.history.resolve(a)}),se(this,"sendError",async(i,s,n)=>{const a=ha(i,n),o=await this.core.crypto.encode(s,a),h=(await this.core.history.get(s,i)).request.method,c=As[h]?As[h].res:As.unregistered_method.res;await this.core.relayer.publish(s,o,c),await this.core.history.resolve(a)}),se(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ve("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),se(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>zr(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),se(this,"onRelayEventRequest",i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(s,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}}),se(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}}),se(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(ni.ping,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),se(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{yr(s)?this.events.emit(be("pairing_ping",n),{}):Vt(s)&&this.events.emit(be("pairing_ping",n),{error:s.error})},500)}),se(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(ni.delete,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),se(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const o=ve("WC_METHOD_UNSUPPORTED",a);await this.sendError(n,i,o),this.logger.error(o)}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),se(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ve("WC_METHOD_UNSUPPORTED",i))}),se(this,"isValidPair",(i,s)=>{var n;if(!Pt(i)){const{message:o}=W("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Pr.malformed_pairing_uri),new Error(o)}if(!C3(i.uri)){const{message:o}=W("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Pr.malformed_pairing_uri),new Error(o)}const a=ef(i==null?void 0:i.uri);if(!((n=a==null?void 0:a.relay)!=null&&n.protocol)){const{message:o}=W("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Pr.malformed_pairing_uri),new Error(o)}if(!(a!=null&&a.symKey)){const{message:o}=W("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Pr.malformed_pairing_uri),new Error(o)}if(a!=null&&a.expiryTimestamp&&V.toMiliseconds(a==null?void 0:a.expiryTimestamp)<Date.now()){s.setError(Pr.pairing_expired);const{message:o}=W("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(o)}}),se(this,"isValidPing",async i=>{if(!Pt(i)){const{message:n}=W("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),se(this,"isValidDisconnect",async i=>{if(!Pt(i)){const{message:n}=W("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),se(this,"isValidPairingTopic",async i=>{if(!et(i,!1)){const{message:s}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(zr(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=W("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=St(t,this.name),this.pairings=new gi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Mt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ut.message,async e=>{const{topic:t,message:i,transportType:s}=e;if(!this.pairings.keys.includes(t)||s===Oe.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(t,i);try{zc(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):ua(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id))}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(Kt.expired,async e=>{const{topic:t}=Ul(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(ni.expire,{topic:t}))})}};var e9=Object.defineProperty,t9=(r,e,t)=>e in r?e9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bt=(r,e,t)=>t9(r,typeof e!="symbol"?e+"":e,t);let r9=class extends u6{constructor(e,t){super(e,t),this.core=e,this.logger=t,bt(this,"records",new Map),bt(this,"events",new Lt.EventEmitter),bt(this,"name",q8),bt(this,"version",B8),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"storagePrefix",wr),bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),bt(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:it(V.THIRTY_DAYS)};this.records.set(a.id,a),this.persist(),this.events.emit(er.created,a)}),bt(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Vt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(er.updated,s))}),bt(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),bt(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(er.deleted,n)}}),this.persist()}),bt(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),bt(this,"on",(i,s)=>{this.events.on(i,s)}),bt(this,"once",(i,s)=>{this.events.once(i,s)}),bt(this,"off",(i,s)=>{this.events.off(i,s)}),bt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=St(t,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Kr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(er.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(er.created,e=>{const t=er.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(er.updated,e=>{const t=er.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(er.deleted,e=>{const t=er.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(es.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{V.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(er.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var i9=Object.defineProperty,s9=(r,e,t)=>e in r?i9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,wt=(r,e,t)=>s9(r,typeof e!="symbol"?e+"":e,t);let n9=class extends g6{constructor(e,t){super(e,t),this.core=e,this.logger=t,wt(this,"expirations",new Map),wt(this,"events",new Lt.EventEmitter),wt(this,"name",L8),wt(this,"version",j8),wt(this,"cached",[]),wt(this,"initialized",!1),wt(this,"storagePrefix",wr),wt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),wt(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),wt(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(Kt.created,{target:n,expiration:a})}),wt(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),wt(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Kt.deleted,{target:s,expiration:n})}}),wt(this,"on",(i,s)=>{this.events.on(i,s)}),wt(this,"once",(i,s)=>{this.events.once(i,s)}),wt(this,"off",(i,s)=>{this.events.off(i,s)}),wt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=St(t,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return pm(e);if(typeof e=="number")return bm(e);const{message:t}=W("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Kt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;V.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Kt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(es.pulse,()=>this.checkExpirations()),this.events.on(Kt.created,e=>{const t=Kt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Kt.expired,e=>{const t=Kt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Kt.deleted,e=>{const t=Kt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var a9=Object.defineProperty,o9=(r,e,t)=>e in r?a9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,rt=(r,e,t)=>o9(r,typeof e!="symbol"?e+"":e,t);let c9=class extends v6{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,rt(this,"name",U8),rt(this,"abortController"),rt(this,"isDevEnv"),rt(this,"verifyUrlV3",k8),rt(this,"storagePrefix",wr),rt(this,"version",Sp),rt(this,"publicKey"),rt(this,"fetchPromise"),rt(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&V.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),rt(this,"register",async s=>{if(!Js()||this.isDevEnv)return;const n=window.location.origin,{id:a,decryptedId:o}=s,h=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${a}&decryptedId=${o}`;try{const c=ci.getDocument(),f=this.startAbortTimer(V.ONE_SECOND*5),l=await new Promise((v,w)=>{const m=()=>{window.removeEventListener("message",O),c.body.removeChild(_),w("attestation aborted")};this.abortController.signal.addEventListener("abort",m);const _=c.createElement("iframe");_.src=h,_.style.display="none",_.addEventListener("error",m,{signal:this.abortController.signal});const O=D=>{if(D.data&&typeof D.data=="string")try{const A=JSON.parse(D.data);if(A.type==="verify_attestation"){if(Ho(A.attestation).payload.id!==a)return;clearInterval(f),c.body.removeChild(_),this.abortController.signal.removeEventListener("abort",m),window.removeEventListener("message",O),v(A.attestation===null?"":A.attestation)}}catch(A){this.logger.warn(A)}};c.body.appendChild(_),window.addEventListener("message",O,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(c){this.logger.warn(c)}return""}),rt(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:a,encryptedId:o}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Ho(n).payload.id!==o)return;const c=await this.isValidJwtAttestation(n);if(c){if(!c.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return c}}if(!a)return;const h=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(a,h)}),rt(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const a=this.startAbortTimer(V.ONE_SECOND*5),o=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(a),o.status===200?await o.json():void 0}),rt(this,"getVerifyUrl",s=>{let n=s||Bs;return H8.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Bs}`),n=Bs),n}),rt(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(V.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),rt(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),rt(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),rt(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}const a=await this.fetchAndPersistPublicKey();try{if(a)return this.validateAttestation(s,a)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}}),rt(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),rt(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const a=await this.fetchPublicKey();a&&(await this.persistPublicKey(a),n(a))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),rt(this,"validateAttestation",(s,n)=>{const a=m3(s,n.publicKey),o={hasExpired:V.toMiliseconds(a.exp)<Date.now(),payload:a};if(o.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:o.payload.origin,isScam:o.payload.isScam,isVerified:o.payload.isVerified}}),this.logger=St(t,this.name),this.abortController=new AbortController,this.isDevEnv=Mc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Mt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),V.toMiliseconds(e))}};var h9=Object.defineProperty,u9=(r,e,t)=>e in r?h9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kf=(r,e,t)=>u9(r,typeof e!="symbol"?e+"":e,t);let f9=class extends y6{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Kf(this,"context",K8),Kf(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:a,enableEncrypted:o=!1}=i,h=`${V8}/${this.projectId}/clients`;await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:a,token:n,always_raw:o})})}),this.logger=St(t,this.context)}};var d9=Object.defineProperty,Vf=Object.getOwnPropertySymbols,l9=Object.prototype.hasOwnProperty,p9=Object.prototype.propertyIsEnumerable,uc=(r,e,t)=>e in r?d9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ms=(r,e)=>{for(var t in e||(e={}))l9.call(e,t)&&uc(r,t,e[t]);if(Vf)for(var t of Vf(e))p9.call(e,t)&&uc(r,t,e[t]);return r},ot=(r,e,t)=>uc(r,typeof e!="symbol"?e+"":e,t);let b9=class extends m6{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,ot(this,"context",G8),ot(this,"storagePrefix",wr),ot(this,"storageVersion",W8),ot(this,"events",new Map),ot(this,"shouldPersist",!1),ot(this,"init",async()=>{if(!Mc())try{const s={eventId:Du(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ql(this.core.relayer.protocol,this.core.relayer.version,ic)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),ot(this,"createEvent",s=>{const{event:n="ERROR",type:a="",properties:{topic:o,trace:h}}=s,c=Du(),f=this.core.projectId||"",l=Date.now(),v=Ms({eventId:c,timestamp:l,props:{event:n,type:a,properties:{topic:o,trace:h}},bundleId:f,domain:this.getAppDomain()},this.setMethods(c));return this.telemetryEnabled&&(this.events.set(c,v),this.shouldPersist=!0),v}),ot(this,"getEvent",s=>{const{eventId:n,topic:a}=s;if(n)return this.events.get(n);const o=Array.from(this.events.values()).find(h=>h.props.properties.topic===a);if(o)return Ms(Ms({},o),this.setMethods(o.eventId))}),ot(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),ot(this,"setEventListeners",()=>{this.core.heartbeat.on(es.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{V.fromMiliseconds(Date.now())-V.fromMiliseconds(s.timestamp)>J8&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),ot(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),ot(this,"addTrace",(s,n)=>{const a=this.events.get(s);a&&(a.props.properties.trace.push(n),this.events.set(s,a),this.shouldPersist=!0)}),ot(this,"setError",(s,n)=>{const a=this.events.get(s);a&&(a.props.type=n,a.timestamp=Date.now(),this.events.set(s,a),this.shouldPersist=!0)}),ot(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ot(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Ms(Ms({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),ot(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,a]of this.events)a.props.type&&s.push(a);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),ot(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Y8}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ic}${n}`,{method:"POST",body:JSON.stringify(s)})}),ot(this,"getAppDomain",()=>Fl().url),this.logger=St(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var g9=Object.defineProperty,Wf=Object.getOwnPropertySymbols,v9=Object.prototype.hasOwnProperty,y9=Object.prototype.propertyIsEnumerable,fc=(r,e,t)=>e in r?g9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gf=(r,e)=>{for(var t in e||(e={}))v9.call(e,t)&&fc(r,t,e[t]);if(Wf)for(var t of Wf(e))y9.call(e,t)&&fc(r,t,e[t]);return r},De=(r,e,t)=>fc(r,typeof e!="symbol"?e+"":e,t);let m9=class Bp extends a6{constructor(e){var t;super(e),De(this,"protocol",xp),De(this,"version",Sp),De(this,"name",rc),De(this,"relayUrl"),De(this,"projectId"),De(this,"customStoragePrefix"),De(this,"events",new Lt.EventEmitter),De(this,"logger"),De(this,"heartbeat"),De(this,"relayer"),De(this,"crypto"),De(this,"storage"),De(this,"history"),De(this,"expirer"),De(this,"pairing"),De(this,"verify"),De(this,"echoClient"),De(this,"linkModeSupportedApps"),De(this,"eventClient"),De(this,"initialized",!1),De(this,"logChunkController"),De(this,"on",(a,o)=>this.events.on(a,o)),De(this,"once",(a,o)=>this.events.once(a,o)),De(this,"off",(a,o)=>this.events.off(a,o)),De(this,"removeListener",(a,o)=>this.events.removeListener(a,o)),De(this,"dispatchEnvelope",({topic:a,message:o,sessionExists:h})=>{if(!a||!o)return;const c={topic:a,message:o,publishedAt:Date.now(),transportType:Oe.link_mode};this.relayer.onLinkMessageEvent(c,{sessionExists:h})}),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Ip,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=oa({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:v8.logger,name:rc}),{logger:s,chunkLoggerController:n}=i6({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=n,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,o;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((o=this.logChunkController)==null||o.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=St(s,this.name),this.heartbeat=new aw,this.crypto=new $5(this,this.logger,e==null?void 0:e.keychain),this.history=new r9(this,this.logger),this.expirer=new n9(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new jw(Gf(Gf({},y8),e==null?void 0:e.storageOptions)),this.relayer=new W5({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Q5(this,this.logger),this.verify=new c9(this,this.logger,this.storage),this.echoClient=new f9(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new b9(this,this.logger,e==null?void 0:e.telemetryEnabled)}static async init(e){const t=new Bp(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(M8,i),t}get context(){return Mt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Cf,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Cf)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const w9=m9,Lp="wc",jp=2,Up="client",kc=`${Lp}@${jp}:${Up}:`,$o={name:Up,logger:"error"},Jf="WALLETCONNECT_DEEPLINK_CHOICE",_9="proposal",Yf="Proposal expired",E9="session",Ii=V.SEVEN_DAYS,x9="engine",ct={wc_sessionPropose:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1104},res:{ttl:V.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1106},res:{ttl:V.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1112},res:{ttl:V.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1114},res:{ttl:V.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:V.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:V.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1119}}},Io={min:V.FIVE_MINUTES,max:V.SEVEN_DAYS},br={idle:"IDLE",active:"ACTIVE"},Xf={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},S9="request",$9=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],I9="wc",D9="auth",A9="authKeys",P9="pairingTopics",O9="requests",da=`${I9}@${1.5}:${D9}:`,jn=`${da}:PUB_KEY`;var M9=Object.defineProperty,C9=Object.defineProperties,R9=Object.getOwnPropertyDescriptors,Zf=Object.getOwnPropertySymbols,T9=Object.prototype.hasOwnProperty,N9=Object.prototype.propertyIsEnumerable,dc=(r,e,t)=>e in r?M9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ze=(r,e)=>{for(var t in e||(e={}))T9.call(e,t)&&dc(r,t,e[t]);if(Zf)for(var t of Zf(e))N9.call(e,t)&&dc(r,t,e[t]);return r},Dt=(r,e)=>C9(r,R9(e)),K=(r,e,t)=>dc(r,typeof e!="symbol"?e+"":e,t);let F9=class extends x6{constructor(e){super(e),K(this,"name",x9),K(this,"events",new _c),K(this,"initialized",!1),K(this,"requestQueue",{state:br.idle,queue:[]}),K(this,"sessionRequestQueue",{state:br.idle,queue:[]}),K(this,"requestQueueDelay",V.ONE_SECOND),K(this,"expectedPairingMethodMap",new Map),K(this,"recentlyDeletedMap",new Map),K(this,"recentlyDeletedLimit",200),K(this,"relayMessageCache",[]),K(this,"pendingSessions",new Map),K(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ct)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay)))}),K(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Dt(ze({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:a,sessionProperties:o,relays:h}=i;let c=s,f,l=!1;try{if(c){const T=this.client.core.pairing.pairings.get(c);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),T}if(!c||!l){const{topic:T,uri:C}=await this.client.core.pairing.create();c=T,f=C}if(!c){const{message:T}=W("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(T)}const v=await this.client.core.crypto.generateKeyPair(),w=ct.wc_sessionPropose.req.ttl||V.FIVE_MINUTES,m=it(w),_=Dt(ze({requiredNamespaces:n,optionalNamespaces:a,relays:h??[{protocol:$p}],proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:c},o&&{sessionProperties:o}),{id:vr()}),O=be("session_connect",_.id),{reject:D,resolve:A,done:M}=ii(w,Yf),R=({id:T})=>{T===_.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(_.id),this.events.emit(O,{error:{message:Yf,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(O,({error:T,session:C})=>{this.client.events.off("proposal_expire",R),T?D(T):C&&A(C)}),await this.sendRequest({topic:c,method:"wc_sessionPropose",params:_,throwOnFailedPublish:!0,clientRpcId:_.id}),await this.setProposal(_.id,_),{uri:f,approval:M}}),K(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),K(this,"approve",async t=>{var i,s,n;const a=this.client.core.eventClient.createEvent({properties:{topic:(i=t==null?void 0:t.id)==null?void 0:i.toString(),trace:[tr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(B){throw a.setError(ti.no_internet_connection),B}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(B){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),a.setError(ti.proposal_not_found),B}try{await this.isValidApprove(t)}catch(B){throw this.client.logger.error("approve() -> isValidApprove() failed"),a.setError(ti.session_approve_namespace_validation_failure),B}const{id:o,relayProtocol:h,namespaces:c,sessionProperties:f,sessionConfig:l}=t,v=this.client.proposal.get(o);this.client.core.eventClient.deleteEvent({eventId:a.eventId});const{pairingTopic:w,proposer:m,requiredNamespaces:_,optionalNamespaces:O}=v;let D=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:w});D||(D=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:tr.session_approve_started,properties:{topic:w,trace:[tr.session_approve_started,tr.session_namespaces_validation_success]}}));const A=await this.client.core.crypto.generateKeyPair(),M=m.publicKey,R=await this.client.core.crypto.generateSharedKey(A,M),T=ze(ze({relay:{protocol:h??"irn"},namespaces:c,controller:{publicKey:A,metadata:this.client.metadata},expiry:it(Ii)},f&&{sessionProperties:f}),l&&{sessionConfig:l}),C=Oe.relay;D.addTrace(tr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(R,{transportType:C})}catch(B){throw D.setError(ti.subscribe_session_topic_failure),B}D.addTrace(tr.subscribe_session_topic_success);const q=Dt(ze({},T),{topic:R,requiredNamespaces:_,optionalNamespaces:O,pairingTopic:w,acknowledged:!1,self:T.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:A,transportType:Oe.relay});await this.client.session.set(R,q),D.addTrace(tr.store_session);try{D.addTrace(tr.publishing_session_settle),await this.sendRequest({topic:R,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0}).catch(B=>{throw D==null||D.setError(ti.session_settle_publish_failure),B}),D.addTrace(tr.session_settle_publish_success),D.addTrace(tr.publishing_session_approve),await this.sendResult({id:o,topic:w,result:{relay:{protocol:h??"irn"},responderPublicKey:A},throwOnFailedPublish:!0}).catch(B=>{throw D==null||D.setError(ti.session_approve_publish_failure),B}),D.addTrace(tr.session_approve_publish_success)}catch(B){throw this.client.logger.error(B),this.client.session.delete(R,ve("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(R),B}return this.client.core.eventClient.deleteEvent({eventId:D.eventId}),await this.client.core.pairing.updateMetadata({topic:w,metadata:m.metadata}),await this.client.proposal.delete(o,ve("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}),await this.setExpiry(R,it(Ii)),{topic:R,acknowledged:()=>Promise.resolve(this.client.session.get(R))}}),K(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}const{id:i,reason:s}=t;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),a}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:ct.wc_sessionPropose.reject}),await this.client.proposal.delete(i,ve("USER_DISCONNECTED")))}),K(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:s}=t,{done:n,resolve:a,reject:o}=ii(),h=vr(),c=oi().toString(),f=this.client.session.get(i).namespaces;return this.events.once(be("session_update",h),({error:l})=>{l?o(l):a()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:h,relayRpcId:c}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:f}),o(l)}),{acknowledged:n}}),K(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(h){throw this.client.logger.error("extend() -> isValidExtend() failed"),h}const{topic:i}=t,s=vr(),{done:n,resolve:a,reject:o}=ii();return this.events.once(be("session_extend",s),({error:h})=>{h?o(h):a()}),await this.setExpiry(i,it(Ii)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(h=>{o(h)}),{acknowledged:n}}),K(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(D){throw this.client.logger.error("request() -> isValidRequest() failed"),D}const{chainId:i,request:s,topic:n,expiry:a=ct.wc_sessionRequest.req.ttl}=t,o=this.client.session.get(n);(o==null?void 0:o.transportType)===Oe.relay&&await this.confirmOnlineStateOrThrow();const h=vr(),c=oi().toString(),{done:f,resolve:l,reject:v}=ii(a,"Request expired. Please try again.");this.events.once(be("session_request",h),({error:D,result:A})=>{D?v(D):l(A)});const w="wc_sessionRequest",m=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);if(m)return await this.sendRequest({clientRpcId:h,relayRpcId:c,topic:n,method:w,params:{request:Dt(ze({},s),{expiryTimestamp:it(a)}),chainId:i},expiry:a,throwOnFailedPublish:!0,appLink:m}).catch(D=>v(D)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:h}),await f();const _={request:Dt(ze({},s),{expiryTimestamp:it(a)}),chainId:i},O=this.shouldSetTVF(w,_);return await Promise.all([new Promise(async D=>{await this.sendRequest(ze({clientRpcId:h,relayRpcId:c,topic:n,method:w,params:_,expiry:a,throwOnFailedPublish:!0},O&&{tvf:this.getTVFParams(h,_)})).catch(A=>v(A)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:h}),D()}),new Promise(async D=>{var A;if(!((A=o.sessionConfig)!=null&&A.disableDeepLink)){const M=await mm(this.client.core.storage,Jf);await gm({id:h,topic:n,wcDeepLink:M})}D()}),f()]).then(D=>D[2])}),K(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s,a=this.client.session.get(i);a.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const o=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);yr(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:o}):Vt(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:o}),this.cleanupAfterResponse(t)}),K(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=vr(),n=oi().toString(),{done:a,resolve:o,reject:h}=ii();this.events.once(be("session_ping",s),({error:c})=>{c?h(c):o()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),a()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),K(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t,a=oi().toString(),o=vr();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:a,clientRpcId:o})}),K(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ve("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=W("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),K(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>O3(i,t)))),K(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),K(this,"authenticate",async(t,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),a=n?Oe.link_mode:Oe.relay;a===Oe.relay&&await this.confirmOnlineStateOrThrow();const{chains:o,statement:h="",uri:c,domain:f,nonce:l,type:v,exp:w,nbf:m,methods:_=[],expiry:O}=t,D=[...t.resources||[]],{topic:A,uri:M}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:a});this.client.logger.info({message:"Generated new pairing",pairing:{topic:A,uri:M}});const R=await this.client.core.crypto.generateKeyPair(),T=qn(R);if(await Promise.all([this.client.auth.authKeys.set(jn,{responseTopic:T,publicKey:R}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:A})]),await this.client.core.relayer.subscribe(T,{transportType:a}),this.client.logger.info(`sending request to new pairing topic: ${A}`),_.length>0){const{namespace:E}=Vi(o[0]);let d=h2(E,"request",_);Fn(D)&&(d=f2(d,D.pop())),D.push(d)}const C=O&&O>ct.wc_sessionAuthenticate.req.ttl?O:ct.wc_sessionAuthenticate.req.ttl,q={authPayload:{type:v??"caip122",chains:o,statement:h,aud:c,domain:f,version:"1",nonce:l,iat:new Date().toISOString(),exp:w,nbf:m,resources:D},requester:{publicKey:R,metadata:this.client.metadata},expiryTimestamp:it(C)},B={eip155:{chains:o,methods:[...new Set(["personal_sign",..._])],events:["chainChanged","accountsChanged"]}},N={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:A,proposer:{publicKey:R,metadata:this.client.metadata},expiryTimestamp:it(ct.wc_sessionPropose.req.ttl),id:vr()},{done:k,resolve:I,reject:u}=ii(C,"Request expired"),p=vr(),y=be("session_connect",N.id),b=be("session_request",p),g=async({error:E,session:d})=>{this.events.off(b,x),E?u(E):d&&I({session:d})},x=async E=>{var d,S,L;if(await this.deletePendingAuthRequest(p,{message:"fulfilled",code:0}),E.error){const Y=ve("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return E.error.code===Y.code?void 0:(this.events.off(y,g),u(E.error.message))}await this.deleteProposal(N.id),this.events.off(y,g);const{cacaos:j,responder:U}=E.result,z=[],G=[];for(const Y of j){await Nu({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),u(ve("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Q}=Y,Qe=Fn(Q.resources),re=[Ko(Q.iss)],ie=Hn(Q.iss);if(Qe){const nt=Fu(Qe),oe=qu(Qe);z.push(...nt),re.push(...oe)}for(const nt of re)G.push(`${nt}:${ie}`)}const X=await this.client.core.crypto.generateSharedKey(R,U.publicKey);let Z;z.length>0&&(Z={topic:X,acknowledged:!0,self:{publicKey:R,metadata:this.client.metadata},peer:U,controller:U.publicKey,expiry:it(Ii),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:A,namespaces:rf([...new Set(z)],[...new Set(G)]),transportType:a},await this.client.core.relayer.subscribe(X,{transportType:a}),await this.client.session.set(X,Z),A&&await this.client.core.pairing.updateMetadata({topic:A,metadata:U.metadata}),Z=this.client.session.get(X)),(d=this.client.metadata.redirect)!=null&&d.linkMode&&(S=U.metadata.redirect)!=null&&S.linkMode&&(L=U.metadata.redirect)!=null&&L.universal&&i&&(this.client.core.addLinkModeSupportedApp(U.metadata.redirect.universal),this.client.session.update(X,{transportType:Oe.link_mode})),I({auths:j,session:Z})};this.events.once(y,g),this.events.once(b,x);let $;try{if(n){const E=Kr("wc_sessionAuthenticate",q,p);this.client.core.history.set(A,E);const d=await this.client.core.crypto.encode("",E,{type:Qs,encoding:Is});$=Sn(i,A,d)}else await Promise.all([this.sendRequest({topic:A,method:"wc_sessionAuthenticate",params:q,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:p}),this.sendRequest({topic:A,method:"wc_sessionPropose",params:N,expiry:ct.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:N.id})])}catch(E){throw this.events.off(y,g),this.events.off(b,x),E}return await this.setProposal(N.id,N),await this.setAuthRequest(p,{request:Dt(ze({},q),{verifyContext:{}}),pairingTopic:A,transportType:a}),{uri:$??M,response:k}}),K(this,"approveSessionAuthenticate",async t=>{const{id:i,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[ri.authenticated_session_approve_started]}});try{this.isInitialized()}catch(O){throw n.setError(Ps.no_internet_connection),O}const a=this.getPendingAuthRequest(i);if(!a)throw n.setError(Ps.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const o=a.transportType||Oe.relay;o===Oe.relay&&await this.confirmOnlineStateOrThrow();const h=a.requester.publicKey,c=await this.client.core.crypto.generateKeyPair(),f=qn(h),l={type:Mr,receiverPublicKey:h,senderPublicKey:c},v=[],w=[];for(const O of s){if(!await Nu({cacao:O,projectId:this.client.core.projectId})){n.setError(Ps.invalid_cacao);const T=ve("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:f,error:T,encodeOpts:l}),new Error(T.message)}n.addTrace(ri.cacaos_verified);const{p:D}=O,A=Fn(D.resources),M=[Ko(D.iss)],R=Hn(D.iss);if(A){const T=Fu(A),C=qu(A);v.push(...T),M.push(...C)}for(const T of M)w.push(`${T}:${R}`)}const m=await this.client.core.crypto.generateSharedKey(c,h);n.addTrace(ri.create_authenticated_session_topic);let _;if((v==null?void 0:v.length)>0){_={topic:m,acknowledged:!0,self:{publicKey:c,metadata:this.client.metadata},peer:{publicKey:h,metadata:a.requester.metadata},controller:h,expiry:it(Ii),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:a.pairingTopic,namespaces:rf([...new Set(v)],[...new Set(w)]),transportType:o},n.addTrace(ri.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(m,{transportType:o})}catch(O){throw n.setError(Ps.subscribe_authenticated_session_topic_failure),O}n.addTrace(ri.subscribe_authenticated_session_topic_success),await this.client.session.set(m,_),n.addTrace(ri.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:a.pairingTopic,metadata:a.requester.metadata})}n.addTrace(ri.publishing_authenticated_session_approve);try{await this.sendResult({topic:f,id:i,result:{cacaos:s,responder:{publicKey:c,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(a.requester.metadata,o)})}catch(O){throw n.setError(Ps.authenticated_session_approve_publish_failure),O}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:a.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:_}}),K(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:i,reason:s}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const a=n.requester.publicKey,o=await this.client.core.crypto.generateKeyPair(),h=qn(a),c={type:Mr,receiverPublicKey:a,senderPublicKey:o};await this.sendError({id:i,topic:h,error:s,encodeOpts:c,rpcOpts:ct.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,ve("USER_DISCONNECTED"))}),K(this,"formatAuthMessage",t=>{this.isInitialized();const{request:i,iss:s}=t;return Yl(i,s)}),K(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),K(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var a,o;return((a=n.peerMetadata)==null?void 0:a.url)&&((o=n.peerMetadata)==null?void 0:o.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),K(this,"deleteSession",async t=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:a=!0,id:o=0}=t,{self:h}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ve("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(h.publicKey)&&await this.client.core.crypto.deleteKeyPair(h.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Jf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===s&&this.deletePendingSessionRequest(c.id,ve("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=br.idle),a&&this.client.events.emit("session_delete",{id:o,topic:s})}),K(this,"deleteProposal",async(t,i)=>{if(i)try{const s=this.client.proposal.get(t),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(ti.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,ve("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),K(this,"deletePendingSessionRequest",async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=br.idle,this.client.events.emit("session_request_expire",{id:t}))}),K(this,"deletePendingAuthRequest",async(t,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])}),K(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),K(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,it(ct.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),K(this,"setAuthRequest",async(t,i)=>{const{request:s,pairingTopic:n,transportType:a=Oe.relay}=i;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:a})}),K(this,"setPendingSessionRequest",async t=>{const{id:i,topic:s,params:n,verifyContext:a}=t,o=n.request.expiryTimestamp||it(ct.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,o),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:a})}),K(this,"sendRequest",async t=>{const{topic:i,method:s,params:n,expiry:a,relayRpcId:o,clientRpcId:h,throwOnFailedPublish:c,appLink:f,tvf:l}=t,v=Kr(s,n,h);let w;const m=!!f;try{const D=m?Is:Hr;w=await this.client.core.crypto.encode(i,v,{encoding:D})}catch(D){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),D}let _;if($9.includes(s)){const D=Or(JSON.stringify(v)),A=Or(w);_=await this.client.core.verify.register({id:A,decryptedId:D})}const O=ct[s].req;if(O.attestation=_,a&&(O.ttl=a),o&&(O.id=o),this.client.core.history.set(i,v),m){const D=Sn(f,i,w);await global.Linking.openURL(D,this.client.name)}else{const D=ct[s].req;a&&(D.ttl=a),o&&(D.id=o),D.tvf=Dt(ze({},l),{correlationId:v.id}),c?(D.internal=Dt(ze({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,w,D)):this.client.core.relayer.publish(i,w,D).catch(A=>this.client.logger.error(A))}return v.id}),K(this,"sendResult",async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:a,encodeOpts:o,appLink:h}=t,c=ca(i,n);let f;const l=h&&typeof(global==null?void 0:global.Linking)<"u";try{const m=l?Is:Hr;f=await this.client.core.crypto.encode(s,c,Dt(ze({},o||{}),{encoding:m}))}catch(m){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),m}let v,w;try{v=await this.client.core.history.get(s,i);const m=v.request;try{this.shouldSetTVF(m.method,m.params)&&(w=this.getTVFParams(i,m.params,n))}catch(_){this.client.logger.warn("sendResult() -> getTVFParams() failed",_)}}catch(m){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),m}if(l){const m=Sn(h,s,f);await global.Linking.openURL(m,this.client.name)}else{const m=v.request.method,_=ct[m].res;_.tvf=Dt(ze({},w),{correlationId:i}),a?(_.internal=Dt(ze({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,f,_)):this.client.core.relayer.publish(s,f,_).catch(O=>this.client.logger.error(O))}await this.client.core.history.resolve(c)}),K(this,"sendError",async t=>{const{id:i,topic:s,error:n,encodeOpts:a,rpcOpts:o,appLink:h}=t,c=ha(i,n);let f;const l=h&&typeof(global==null?void 0:global.Linking)<"u";try{const w=l?Is:Hr;f=await this.client.core.crypto.encode(s,c,Dt(ze({},a||{}),{encoding:w}))}catch(w){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),w}let v;try{v=await this.client.core.history.get(s,i)}catch(w){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),w}if(l){const w=Sn(h,s,f);await global.Linking.openURL(w,this.client.name)}else{const w=v.request.method,m=o||ct[w].res;this.client.core.relayer.publish(s,f,m)}await this.client.core.history.resolve(c)}),K(this,"cleanup",async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;zr(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{zr(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),K(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),K(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===br.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=br.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=br.idle}),K(this,"processRequest",async t=>{const{topic:i,payload:s,attestation:n,transportType:a,encryptedId:o}=t,h=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:h}))switch(h){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:o});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});default:return this.client.logger.info(`Unsupported request method ${h}`)}}),K(this,"onRelayEventResponse",async t=>{const{topic:i,payload:s,transportType:n}=t,a=(await this.client.core.history.get(i,s.id)).request.method;switch(a){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${a}`)}}),K(this,"onRelayEventUnknownPayload",t=>{const{topic:i}=t,{message:s}=W("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),K(this,"shouldIgnorePairingRequest",t=>{const{topic:i,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),K(this,"onSessionProposeRequest",async t=>{const{topic:i,payload:s,attestation:n,encryptedId:a}=t,{params:o,id:h}=s;try{const c=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),c==null||c.setError(Pr.proposal_listener_not_found)),this.isValidConnect(ze({},s.params));const f=o.expiryTimestamp||it(ct.wc_sessionPropose.req.ttl),l=ze({id:h,pairingTopic:i,expiryTimestamp:f},o);await this.setProposal(h,l);const v=await this.getVerifyContext({attestationId:n,hash:Or(JSON.stringify(s)),encryptedId:a,metadata:l.proposer.metadata});c==null||c.addTrace(gr.emit_session_proposal),this.client.events.emit("session_proposal",{id:h,params:l,verifyContext:v})}catch(c){await this.sendError({id:h,topic:i,error:c,rpcOpts:ct.wc_sessionPropose.autoReject}),this.client.logger.error(c)}}),K(this,"onSessionProposeResponse",async(t,i,s)=>{const{id:n}=i;if(yr(i)){const{result:a}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a});const o=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const h=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const c=a.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:c});const f=await this.client.core.crypto.generateSharedKey(h,c);this.pendingSessions.set(n,{sessionTopic:f,pairingTopic:t,proposalId:n,publicKey:h});const l=await this.client.core.relayer.subscribe(f,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(Vt(i)){await this.client.proposal.delete(n,ve("USER_DISCONNECTED"));const a=be("session_connect",n);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:i.error})}}),K(this,"onSessionSettleRequest",async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:a,controller:o,expiry:h,namespaces:c,sessionProperties:f,sessionConfig:l}=i.params,v=[...this.pendingSessions.values()].find(_=>_.sessionTopic===t);if(!v)return this.client.logger.error(`Pending session not found for topic ${t}`);const w=this.client.proposal.get(v.proposalId),m=Dt(ze(ze({topic:t,relay:a,expiry:h,namespaces:c,acknowledged:!0,pairingTopic:v.pairingTopic,requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces,controller:o.publicKey,self:{publicKey:v.publicKey,metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},f&&{sessionProperties:f}),l&&{sessionConfig:l}),{transportType:Oe.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:v.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(be("session_connect",v.proposalId),{session:m}),this.pendingSessions.delete(v.proposalId),this.deleteProposal(v.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:i.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(a){await this.sendError({id:s,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"onSessionSettleResponse",async(t,i)=>{const{id:s}=i;yr(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(be("session_approve",s),{})):Vt(i)&&(await this.client.session.delete(t,ve("USER_DISCONNECTED")),this.events.emit(be("session_approve",s),{error:i.error}))}),K(this,"onSessionUpdateRequest",async(t,i)=>{const{params:s,id:n}=i;try{const a=`${t}_session_update`,o=Ds.get(a);if(o&&this.isRequestOutOfSync(o,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:ve("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ze({topic:t},s));try{Ds.set(a,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(h){throw Ds.delete(a),h}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(a){await this.sendError({id:n,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),K(this,"onSessionUpdateResponse",(t,i)=>{const{id:s}=i,n=be("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yr(i)?this.events.emit(be("session_update",s),{}):Vt(i)&&this.events.emit(be("session_update",s),{error:i.error})}),K(this,"onSessionExtendRequest",async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,it(Ii)),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),K(this,"onSessionExtendResponse",(t,i)=>{const{id:s}=i,n=be("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yr(i)?this.events.emit(be("session_extend",s),{}):Vt(i)&&this.events.emit(be("session_extend",s),{error:i.error})}),K(this,"onSessionPingRequest",async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),K(this,"onSessionPingResponse",(t,i)=>{const{id:s}=i,n=be("session_ping",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);setTimeout(()=>{yr(i)?this.events.emit(be("session_ping",s),{}):Vt(i)&&this.events.emit(be("session_ping",s),{error:i.error})},500)}),K(this,"onSessionDeleteRequest",async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(ut.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:ve("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),K(this,"onSessionRequest",async t=>{var i,s,n;const{topic:a,payload:o,attestation:h,encryptedId:c,transportType:f}=t,{id:l,params:v}=o;try{await this.isValidRequest(ze({topic:a},v));const w=this.client.session.get(a),m=await this.getVerifyContext({attestationId:h,hash:Or(JSON.stringify(Kr("wc_sessionRequest",v,l))),encryptedId:c,metadata:w.peer.metadata,transportType:f}),_={id:l,topic:a,params:v,verifyContext:m};await this.setPendingSessionRequest(_),f===Oe.link_mode&&(i=w.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=w.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(_):(this.addSessionRequestToSessionRequestQueue(_),this.processSessionRequestQueue())}catch(w){await this.sendError({id:l,topic:a,error:w}),this.client.logger.error(w)}}),K(this,"onSessionRequestResponse",(t,i)=>{const{id:s}=i,n=be("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);yr(i)?this.events.emit(be("session_request",s),{result:i.result}):Vt(i)&&this.events.emit(be("session_request",s),{error:i.error})}),K(this,"onSessionEventRequest",async(t,i)=>{const{id:s,params:n}=i;try{const a=`${t}_session_event_${n.event.name}`,o=Ds.get(a);if(o&&this.isRequestOutOfSync(o,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ze({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),Ds.set(a,s)}catch(a){await this.sendError({id:s,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"onSessionAuthenticateResponse",(t,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),yr(i)?this.events.emit(be("session_request",s),{result:i.result}):Vt(i)&&this.events.emit(be("session_request",s),{error:i.error})}),K(this,"onSessionAuthenticateRequest",async t=>{var i;const{topic:s,payload:n,attestation:a,encryptedId:o,transportType:h}=t;try{const{requester:c,authPayload:f,expiryTimestamp:l}=n.params,v=await this.getVerifyContext({attestationId:a,hash:Or(JSON.stringify(n)),encryptedId:o,metadata:c.metadata,transportType:h}),w={requester:c,pairingTopic:s,id:n.id,authPayload:f,verifyContext:v,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:w,pairingTopic:s,transportType:h}),h===Oe.link_mode&&(i=c.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(c.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:v})}catch(c){this.client.logger.error(c);const f=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),v=this.getAppLinkIfEnabled(n.params.requester.metadata,h),w={type:Mr,receiverPublicKey:f,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:c,encodeOpts:w,rpcOpts:ct.wc_sessionAuthenticate.autoReject,appLink:v})}}),K(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),K(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=br.idle,this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay))}),K(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const a=n.request.id,o=be("session_request",a);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners`);this.events.emit(be("session_request",n.request.id),{error:i})})}),K(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===br.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=br.active,this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),K(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),K(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:Kr("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id)})}),K(this,"isValidConnect",async t=>{if(!Pt(t)){const{message:h}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:a,relays:o}=t;if(Et(i)||await this.isValidPairingTopic(i),!z3(o)){const{message:h}=W("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(h)}!Et(s)&&Hs(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!Et(n)&&Hs(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Et(a)||this.validateSessionProps(a,"sessionProperties")}),K(this,"validateNamespaces",(t,i)=>{const s=U3(t,"connect()",i);if(s)throw new Error(s.message)}),K(this,"isValidApprove",async t=>{if(!Pt(t))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const o=this.client.proposal.get(i),h=bo(s,"approve()");if(h)throw new Error(h.message);const c=af(o.requiredNamespaces,s,"approve()");if(c)throw new Error(c.message);if(!et(n,!0)){const{message:f}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(f)}Et(a)||this.validateSessionProps(a,"sessionProperties")}),K(this,"isValidReject",async t=>{if(!Pt(t)){const{message:n}=W("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!H3(s)){const{message:n}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),K(this,"isValidSessionSettleRequest",t=>{if(!Pt(t)){const{message:c}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(c)}const{relay:i,controller:s,namespaces:n,expiry:a}=t;if(!lp(i)){const{message:c}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(c)}const o=N3(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const h=bo(n,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(zr(a)){const{message:c}=W("EXPIRED","onSessionSettleRequest()");throw new Error(c)}}),K(this,"isValidUpdate",async t=>{if(!Pt(t)){const{message:h}=W("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:i,namespaces:s}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),a=bo(s,"update()");if(a)throw new Error(a.message);const o=af(n.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)}),K(this,"isValidExtend",async t=>{if(!Pt(t)){const{message:s}=W("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),K(this,"isValidRequest",async t=>{if(!Pt(t)){const{message:h}=W("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:i,request:s,chainId:n,expiry:a}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!nf(o,n)){const{message:h}=W("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(h)}if(!K3(s)){const{message:h}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!G3(o,n,s.method)){const{message:h}=W("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(a&&!Z3(a,Io)){const{message:h}=W("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Io.min} and ${Io.max}`);throw new Error(h)}}),K(this,"isValidRespond",async t=>{var i;if(!Pt(t)){const{message:a}=W("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(a)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(a){throw(i=t==null?void 0:t.response)!=null&&i.id&&this.cleanupAfterResponse(t),a}if(!V3(n)){const{message:a}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}}),K(this,"isValidPing",async t=>{if(!Pt(t)){const{message:s}=W("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),K(this,"isValidEmit",async t=>{if(!Pt(t)){const{message:o}=W("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(o)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!nf(a,n)){const{message:o}=W("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(o)}if(!W3(s)){const{message:o}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!J3(a,n,s.name)){const{message:o}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}}),K(this,"isValidDisconnect",async t=>{if(!Pt(t)){const{message:s}=W("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),K(this,"isValidAuthenticate",t=>{const{chains:i,uri:s,domain:n,nonce:a}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!et(s,!1))throw new Error("uri is required parameter");if(!et(n,!1))throw new Error("domain is required parameter");if(!et(a,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(h=>Vi(h).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:o}=Vi(i[0]);if(o!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),K(this,"getVerifyContext",async t=>{const{attestationId:i,hash:s,encryptedId:n,metadata:a,transportType:o}=t,h={verified:{verifyUrl:a.verifyUrl||Bs,validation:"UNKNOWN",origin:a.url||""}};try{if(o===Oe.link_mode){const f=this.getAppLinkIfEnabled(a,o);return h.verified.validation=f&&new URL(f).origin===new URL(a.url).origin?"VALID":"INVALID",h}const c=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:a.verifyUrl});c&&(h.verified.origin=c.origin,h.verified.isScam=c.isScam,h.verified.validation=c.origin===new URL(a.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.warn(c)}return this.client.logger.debug(`Verify context: ${JSON.stringify(h)}`),h}),K(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach(s=>{if(!et(s,!1)){const{message:n}=W("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(n)}})}),K(this,"getPendingAuthRequest",t=>{const i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),K(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const a of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(a)}}}),K(this,"checkRecentlyDeleted",t=>{const i=this.recentlyDeletedMap.get(t);if(i){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(s)}}),K(this,"isLinkModeEnabled",(t,i)=>{var s,n,a,o,h,c,f,l,v;return!t||i!==Oe.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((o=(a=this.client.metadata)==null?void 0:a.redirect)==null?void 0:o.universal)!==void 0&&((c=(h=this.client.metadata)==null?void 0:h.redirect)==null?void 0:c.universal)!==""&&((f=t==null?void 0:t.redirect)==null?void 0:f.universal)!==void 0&&((l=t==null?void 0:t.redirect)==null?void 0:l.universal)!==""&&((v=t==null?void 0:t.redirect)==null?void 0:v.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),K(this,"getAppLinkIfEnabled",(t,i)=>{var s;return this.isLinkModeEnabled(t,i)?(s=t==null?void 0:t.redirect)==null?void 0:s.universal:void 0}),K(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=Iu(t,"topic")||"",s=decodeURIComponent(Iu(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:Oe.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),K(this,"registerLinkModeListeners",async()=>{var t;if(Mc()||Wr()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),K(this,"shouldSetTVF",(t,i)=>{if(!i||t!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Xf).includes(s.method)}),K(this,"getTVFParams",(t,i,s)=>{var n,a;try{const o=i.request.method,h=this.extractTxHashesFromResult(o,s);return Dt(ze({correlationId:t,rpcMethods:[o],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(a=(n=i.request.params)==null?void 0:n[0])==null?void 0:a.to]}),{txHashes:h})}catch(o){this.client.logger.warn("Error getting TVF params",o)}return{}}),K(this,"isValidContractData",t=>{var i;if(!t)return!1;try{const s=(t==null?void 0:t.data)||((i=t==null?void 0:t[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),K(this,"extractTxHashesFromResult",(t,i)=>{try{const s=Xf[t];if(typeof i=="string")return[i];const n=i[s.key];if(mr(n))return n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ut.message,e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:a}=this.client.auth.authKeys.keys.includes(jn)?this.client.auth.authKeys.get(jn):{publicKey:void 0},o=await this.client.core.crypto.decode(t,i,{receiverPublicKey:a,encoding:n===Oe.link_mode?Is:Hr});try{zc(o)?(this.client.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o,attestation:s,transportType:n,encryptedId:Or(i)})):ua(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o,transportType:n}),this.client.core.history.delete(t,o.id)):this.onRelayEventUnknownPayload({topic:t,payload:o,transportType:n})}catch(h){this.client.logger.error(h)}}registerExpirerEvents(){this.client.core.expirer.on(Kt.expired,async e=>{const{topic:t,id:i}=Ul(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,W("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,W("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(ni.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ni.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!et(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(zr(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=W("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!et(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(zr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=W("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=W("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(et(e,!1)){const{message:t}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!k3(e)){const{message:t}=W("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(zr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=W("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}},q9=class extends gi{constructor(e,t){super(e,t,_9,kc),this.core=e,this.logger=t}},B9=class extends gi{constructor(e,t){super(e,t,E9,kc),this.core=e,this.logger=t}},L9=class extends gi{constructor(e,t){super(e,t,S9,kc,i=>i.id),this.core=e,this.logger=t}},j9=class extends gi{constructor(e,t){super(e,t,A9,da,()=>jn),this.core=e,this.logger=t}},U9=class extends gi{constructor(e,t){super(e,t,P9,da),this.core=e,this.logger=t}},z9=class extends gi{constructor(e,t){super(e,t,O9,da,i=>i.id),this.core=e,this.logger=t}};var k9=Object.defineProperty,H9=(r,e,t)=>e in r?k9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Do=(r,e,t)=>H9(r,typeof e!="symbol"?e+"":e,t);let K9=class{constructor(e,t){this.core=e,this.logger=t,Do(this,"authKeys"),Do(this,"pairingTopics"),Do(this,"requests"),this.authKeys=new j9(this.core,this.logger),this.pairingTopics=new U9(this.core,this.logger),this.requests=new z9(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var V9=Object.defineProperty,W9=(r,e,t)=>e in r?V9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ne=(r,e,t)=>W9(r,typeof e!="symbol"?e+"":e,t);let G9=class zp extends E6{constructor(e){super(e),ne(this,"protocol",Lp),ne(this,"version",jp),ne(this,"name",$o.name),ne(this,"metadata"),ne(this,"core"),ne(this,"logger"),ne(this,"events",new Lt.EventEmitter),ne(this,"engine"),ne(this,"session"),ne(this,"proposal"),ne(this,"pendingRequest"),ne(this,"auth"),ne(this,"signConfig"),ne(this,"on",(i,s)=>this.events.on(i,s)),ne(this,"once",(i,s)=>this.events.once(i,s)),ne(this,"off",(i,s)=>this.events.off(i,s)),ne(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),ne(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),ne(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),ne(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),ne(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),ne(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||$o.name,this.metadata=(e==null?void 0:e.metadata)||Fl(),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:tn(oa({level:(e==null?void 0:e.logger)||$o.logger}));this.core=(e==null?void 0:e.core)||new w9(e),this.logger=St(t,this.name),this.session=new B9(this.core,this.logger),this.proposal=new q9(this.core,this.logger),this.pendingRequest=new L9(this.core,this.logger),this.engine=new F9(this),this.auth=new K9(this.core,this.logger)}static async init(e){const t=new zp(e);return await t.initialize(),t}get context(){return Mt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},V.toMiliseconds(V.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var An={exports:{}},Qf;function J9(){return Qf||(Qf=1,function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Ot<"u"&&Ot,i=function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n}();(function(n){(function(a){var o=typeof n<"u"&&n||typeof self<"u"&&self||typeof Ot<"u"&&Ot||{},h={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function c(b){return b&&DataView.prototype.isPrototypeOf(b)}if(h.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(b){return b&&f.indexOf(Object.prototype.toString.call(b))>-1};function v(b){if(typeof b!="string"&&(b=String(b)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(b)||b==="")throw new TypeError('Invalid character in header field name: "'+b+'"');return b.toLowerCase()}function w(b){return typeof b!="string"&&(b=String(b)),b}function m(b){var g={next:function(){var x=b.shift();return{done:x===void 0,value:x}}};return h.iterable&&(g[Symbol.iterator]=function(){return g}),g}function _(b){this.map={},b instanceof _?b.forEach(function(g,x){this.append(x,g)},this):Array.isArray(b)?b.forEach(function(g){if(g.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+g.length);this.append(g[0],g[1])},this):b&&Object.getOwnPropertyNames(b).forEach(function(g){this.append(g,b[g])},this)}_.prototype.append=function(b,g){b=v(b),g=w(g);var x=this.map[b];this.map[b]=x?x+", "+g:g},_.prototype.delete=function(b){delete this.map[v(b)]},_.prototype.get=function(b){return b=v(b),this.has(b)?this.map[b]:null},_.prototype.has=function(b){return this.map.hasOwnProperty(v(b))},_.prototype.set=function(b,g){this.map[v(b)]=w(g)},_.prototype.forEach=function(b,g){for(var x in this.map)this.map.hasOwnProperty(x)&&b.call(g,this.map[x],x,this)},_.prototype.keys=function(){var b=[];return this.forEach(function(g,x){b.push(x)}),m(b)},_.prototype.values=function(){var b=[];return this.forEach(function(g){b.push(g)}),m(b)},_.prototype.entries=function(){var b=[];return this.forEach(function(g,x){b.push([x,g])}),m(b)},h.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function O(b){if(!b._noBody){if(b.bodyUsed)return Promise.reject(new TypeError("Already read"));b.bodyUsed=!0}}function D(b){return new Promise(function(g,x){b.onload=function(){g(b.result)},b.onerror=function(){x(b.error)}})}function A(b){var g=new FileReader,x=D(g);return g.readAsArrayBuffer(b),x}function M(b){var g=new FileReader,x=D(g),$=/charset=([A-Za-z0-9_-]+)/.exec(b.type),E=$?$[1]:"utf-8";return g.readAsText(b,E),x}function R(b){for(var g=new Uint8Array(b),x=new Array(g.length),$=0;$<g.length;$++)x[$]=String.fromCharCode(g[$]);return x.join("")}function T(b){if(b.slice)return b.slice(0);var g=new Uint8Array(b.byteLength);return g.set(new Uint8Array(b)),g.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(b){this.bodyUsed=this.bodyUsed,this._bodyInit=b,b?typeof b=="string"?this._bodyText=b:h.blob&&Blob.prototype.isPrototypeOf(b)?this._bodyBlob=b:h.formData&&FormData.prototype.isPrototypeOf(b)?this._bodyFormData=b:h.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)?this._bodyText=b.toString():h.arrayBuffer&&h.blob&&c(b)?(this._bodyArrayBuffer=T(b.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):h.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(b)||l(b))?this._bodyArrayBuffer=T(b):this._bodyText=b=Object.prototype.toString.call(b):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof b=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):h.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h.blob&&(this.blob=function(){var b=O(this);if(b)return b;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var b=O(this);return b||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(h.blob)return this.blob().then(A);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var b=O(this);if(b)return b;if(this._bodyBlob)return M(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},h.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var q=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function B(b){var g=b.toUpperCase();return q.indexOf(g)>-1?g:b}function N(b,g){if(!(this instanceof N))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');g=g||{};var x=g.body;if(b instanceof N){if(b.bodyUsed)throw new TypeError("Already read");this.url=b.url,this.credentials=b.credentials,g.headers||(this.headers=new _(b.headers)),this.method=b.method,this.mode=b.mode,this.signal=b.signal,!x&&b._bodyInit!=null&&(x=b._bodyInit,b.bodyUsed=!0)}else this.url=String(b);if(this.credentials=g.credentials||this.credentials||"same-origin",(g.headers||!this.headers)&&(this.headers=new _(g.headers)),this.method=B(g.method||this.method||"GET"),this.mode=g.mode||this.mode||null,this.signal=g.signal||this.signal||function(){if("AbortController"in o){var d=new AbortController;return d.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&x)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(x),(this.method==="GET"||this.method==="HEAD")&&(g.cache==="no-store"||g.cache==="no-cache")){var $=/([?&])_=[^&]*/;if($.test(this.url))this.url=this.url.replace($,"$1_="+new Date().getTime());else{var E=/\?/;this.url+=(E.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function k(b){var g=new FormData;return b.trim().split("&").forEach(function(x){if(x){var $=x.split("="),E=$.shift().replace(/\+/g," "),d=$.join("=").replace(/\+/g," ");g.append(decodeURIComponent(E),decodeURIComponent(d))}}),g}function I(b){var g=new _,x=b.replace(/\r?\n[\t ]+/g," ");return x.split("\r").map(function($){return $.indexOf(`
`)===0?$.substr(1,$.length):$}).forEach(function($){var E=$.split(":"),d=E.shift().trim();if(d){var S=E.join(":").trim();try{g.append(d,S)}catch(L){console.warn("Response "+L.message)}}}),g}C.call(N.prototype);function u(b,g){if(!(this instanceof u))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(g||(g={}),this.type="default",this.status=g.status===void 0?200:g.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=g.statusText===void 0?"":""+g.statusText,this.headers=new _(g.headers),this.url=g.url||"",this._initBody(b)}C.call(u.prototype),u.prototype.clone=function(){return new u(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},u.error=function(){var b=new u(null,{status:200,statusText:""});return b.ok=!1,b.status=0,b.type="error",b};var p=[301,302,303,307,308];u.redirect=function(b,g){if(p.indexOf(g)===-1)throw new RangeError("Invalid status code");return new u(null,{status:g,headers:{location:b}})},a.DOMException=o.DOMException;try{new a.DOMException}catch{a.DOMException=function(g,x){this.message=g,this.name=x;var $=Error(g);this.stack=$.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function y(b,g){return new Promise(function(x,$){var E=new N(b,g);if(E.signal&&E.signal.aborted)return $(new a.DOMException("Aborted","AbortError"));var d=new XMLHttpRequest;function S(){d.abort()}d.onload=function(){var U={statusText:d.statusText,headers:I(d.getAllResponseHeaders()||"")};E.url.indexOf("file://")===0&&(d.status<200||d.status>599)?U.status=200:U.status=d.status,U.url="responseURL"in d?d.responseURL:U.headers.get("X-Request-URL");var z="response"in d?d.response:d.responseText;setTimeout(function(){x(new u(z,U))},0)},d.onerror=function(){setTimeout(function(){$(new TypeError("Network request failed"))},0)},d.ontimeout=function(){setTimeout(function(){$(new TypeError("Network request timed out"))},0)},d.onabort=function(){setTimeout(function(){$(new a.DOMException("Aborted","AbortError"))},0)};function L(U){try{return U===""&&o.location.href?o.location.href:U}catch{return U}}if(d.open(E.method,L(E.url),!0),E.credentials==="include"?d.withCredentials=!0:E.credentials==="omit"&&(d.withCredentials=!1),"responseType"in d&&(h.blob?d.responseType="blob":h.arrayBuffer&&(d.responseType="arraybuffer")),g&&typeof g.headers=="object"&&!(g.headers instanceof _||o.Headers&&g.headers instanceof o.Headers)){var j=[];Object.getOwnPropertyNames(g.headers).forEach(function(U){j.push(v(U)),d.setRequestHeader(U,w(g.headers[U]))}),E.headers.forEach(function(U,z){j.indexOf(z)===-1&&d.setRequestHeader(z,U)})}else E.headers.forEach(function(U,z){d.setRequestHeader(z,U)});E.signal&&(E.signal.addEventListener("abort",S),d.onreadystatechange=function(){d.readyState===4&&E.signal.removeEventListener("abort",S)}),d.send(typeof E._bodyInit>"u"?null:E._bodyInit)})}return y.polyfill=!0,o.fetch||(o.fetch=y,o.Headers=_,o.Request=N,o.Response=u),a.Headers=_,a.Request=N,a.Response=u,a.fetch=y,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=t.fetch?t:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e}(An,An.exports)),An.exports}var Y9=J9();const ed=Xn(Y9);var X9=Object.defineProperty,Z9=Object.defineProperties,Q9=Object.getOwnPropertyDescriptors,td=Object.getOwnPropertySymbols,e7=Object.prototype.hasOwnProperty,t7=Object.prototype.propertyIsEnumerable,rd=(r,e,t)=>e in r?X9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,id=(r,e)=>{for(var t in e||(e={}))e7.call(e,t)&&rd(r,t,e[t]);if(td)for(var t of td(e))t7.call(e,t)&&rd(r,t,e[t]);return r},sd=(r,e)=>Z9(r,Q9(e));const r7={Accept:"application/json","Content-Type":"application/json"},i7="POST",nd={headers:r7,method:i7},ad=10;let nr=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new Lt.EventEmitter,this.isAvailable=!1,this.registering=!1,!$f(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=Cr(e),i=await(await ed(this.url,sd(id({},nd),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!$f(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=Cr({id:1,jsonrpc:"2.0",method:"test",params:[]});await ed(e,sd(id({},nd),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ui(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=ha(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return mp(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>ad&&this.events.setMaxListeners(ad)}};const od="error",s7="wss://relay.walletconnect.org",n7="wc",a7="universal_provider",cd=`${n7}@2:${a7}:`,kp="https://rpc.walletconnect.org/v1/",Li="generic",o7=`${kp}bundler`,Yt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function c7(){this.__data__=[],this.size=0}var h7=c7;function u7(r,e){return r===e||r!==r&&e!==e}var la=u7,f7=la;function d7(r,e){for(var t=r.length;t--;)if(f7(r[t][0],e))return t;return-1}var pa=d7,l7=pa,p7=Array.prototype,b7=p7.splice;function g7(r){var e=this.__data__,t=l7(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():b7.call(e,t,1),--this.size,!0}var v7=g7,y7=pa;function m7(r){var e=this.__data__,t=y7(e,r);return t<0?void 0:e[t][1]}var w7=m7,_7=pa;function E7(r){return _7(this.__data__,r)>-1}var x7=E7,S7=pa;function $7(r,e){var t=this.__data__,i=S7(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var I7=$7,D7=h7,A7=v7,P7=w7,O7=x7,M7=I7;function ji(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}ji.prototype.clear=D7,ji.prototype.delete=A7,ji.prototype.get=P7,ji.prototype.has=O7,ji.prototype.set=M7;var ba=ji,C7=ba;function R7(){this.__data__=new C7,this.size=0}var T7=R7;function N7(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var F7=N7;function q7(r){return this.__data__.get(r)}var B7=q7;function L7(r){return this.__data__.has(r)}var j7=L7,U7=typeof Pn=="object"&&Pn&&Pn.Object===Object&&Pn,Hp=U7,z7=Hp,k7=typeof self=="object"&&self&&self.Object===Object&&self,H7=z7||k7||Function("return this")(),ts=H7,K7=ts,V7=K7.Symbol,Kp=V7,hd=Kp,Vp=Object.prototype,W7=Vp.hasOwnProperty,G7=Vp.toString,Cs=hd?hd.toStringTag:void 0;function J7(r){var e=W7.call(r,Cs),t=r[Cs];try{r[Cs]=void 0;var i=!0}catch{}var s=G7.call(r);return i&&(e?r[Cs]=t:delete r[Cs]),s}var Y7=J7,X7=Object.prototype,Z7=X7.toString;function Q7(r){return Z7.call(r)}var e_=Q7,ud=Kp,t_=Y7,r_=e_,i_="[object Null]",s_="[object Undefined]",fd=ud?ud.toStringTag:void 0;function n_(r){return r==null?r===void 0?s_:i_:fd&&fd in Object(r)?t_(r):r_(r)}var ga=n_;function a_(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var vi=a_,o_=ga,c_=vi,h_="[object AsyncFunction]",u_="[object Function]",f_="[object GeneratorFunction]",d_="[object Proxy]";function l_(r){if(!c_(r))return!1;var e=o_(r);return e==u_||e==f_||e==h_||e==d_}var Hc=l_,p_=ts,b_=p_["__core-js_shared__"],g_=b_,Ao=g_,dd=function(){var r=/[^.]+$/.exec(Ao&&Ao.keys&&Ao.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function v_(r){return!!dd&&dd in r}var y_=v_,m_=Function.prototype,w_=m_.toString;function __(r){if(r!=null){try{return w_.call(r)}catch{}try{return r+""}catch{}}return""}var E_=__,x_=Hc,S_=y_,$_=vi,I_=E_,D_=/[\\^$.*+?()[\]{}|]/g,A_=/^\[object .+?Constructor\]$/,P_=Function.prototype,O_=Object.prototype,M_=P_.toString,C_=O_.hasOwnProperty,R_=RegExp("^"+M_.call(C_).replace(D_,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function T_(r){if(!$_(r)||S_(r))return!1;var e=x_(r)?R_:A_;return e.test(I_(r))}var N_=T_;function F_(r,e){return r==null?void 0:r[e]}var q_=F_,B_=N_,L_=q_;function j_(r,e){var t=L_(r,e);return B_(t)?t:void 0}var Kc=j_,U_=Kc,z_=ts,k_=U_(z_,"Map"),Wp=k_,H_=Kc,K_=H_(Object,"create"),va=K_,ld=va;function V_(){this.__data__=ld?ld(null):{},this.size=0}var W_=V_;function G_(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var J_=G_,Y_=va,X_="__lodash_hash_undefined__",Z_=Object.prototype,Q_=Z_.hasOwnProperty;function eE(r){var e=this.__data__;if(Y_){var t=e[r];return t===X_?void 0:t}return Q_.call(e,r)?e[r]:void 0}var tE=eE,rE=va,iE=Object.prototype,sE=iE.hasOwnProperty;function nE(r){var e=this.__data__;return rE?e[r]!==void 0:sE.call(e,r)}var aE=nE,oE=va,cE="__lodash_hash_undefined__";function hE(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=oE&&e===void 0?cE:e,this}var uE=hE,fE=W_,dE=J_,lE=tE,pE=aE,bE=uE;function Ui(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}Ui.prototype.clear=fE,Ui.prototype.delete=dE,Ui.prototype.get=lE,Ui.prototype.has=pE,Ui.prototype.set=bE;var gE=Ui,pd=gE,vE=ba,yE=Wp;function mE(){this.size=0,this.__data__={hash:new pd,map:new(yE||vE),string:new pd}}var wE=mE;function _E(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var EE=_E,xE=EE;function SE(r,e){var t=r.__data__;return xE(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ya=SE,$E=ya;function IE(r){var e=$E(this,r).delete(r);return this.size-=e?1:0,e}var DE=IE,AE=ya;function PE(r){return AE(this,r).get(r)}var OE=PE,ME=ya;function CE(r){return ME(this,r).has(r)}var RE=CE,TE=ya;function NE(r,e){var t=TE(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var FE=NE,qE=wE,BE=DE,LE=OE,jE=RE,UE=FE;function zi(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}zi.prototype.clear=qE,zi.prototype.delete=BE,zi.prototype.get=LE,zi.prototype.has=jE,zi.prototype.set=UE;var zE=zi,kE=ba,HE=Wp,KE=zE,VE=200;function WE(r,e){var t=this.__data__;if(t instanceof kE){var i=t.__data__;if(!HE||i.length<VE-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new KE(i)}return t.set(r,e),this.size=t.size,this}var GE=WE,JE=ba,YE=T7,XE=F7,ZE=B7,QE=j7,ex=GE;function ki(r){var e=this.__data__=new JE(r);this.size=e.size}ki.prototype.clear=YE,ki.prototype.delete=XE,ki.prototype.get=ZE,ki.prototype.has=QE,ki.prototype.set=ex;var tx=ki,rx=Kc,ix=function(){try{var r=rx(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Gp=ix,bd=Gp;function sx(r,e,t){e=="__proto__"&&bd?bd(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Vc=sx,nx=Vc,ax=la;function ox(r,e,t){(t!==void 0&&!ax(r[e],t)||t===void 0&&!(e in r))&&nx(r,e,t)}var Jp=ox;function cx(r){return function(e,t,i){for(var s=-1,n=Object(e),a=i(e),o=a.length;o--;){var h=a[r?o:++s];if(t(n[h],h,n)===!1)break}return e}}var hx=cx,ux=hx,fx=ux(),dx=fx,lc={exports:{}};(function(r,e){var t=ts,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n?t.Buffer:void 0,o=a?a.allocUnsafe:void 0;function h(c,f){if(f)return c.slice();var l=c.length,v=o?o(l):new c.constructor(l);return c.copy(v),v}r.exports=h})(lc,lc.exports);var lx=ts,px=lx.Uint8Array,bx=px,gd=bx;function gx(r){var e=new r.constructor(r.byteLength);return new gd(e).set(new gd(r)),e}var vx=gx,yx=vx;function mx(r,e){var t=e?yx(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var wx=mx;function _x(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}var Ex=_x,xx=vi,vd=Object.create,Sx=function(){function r(){}return function(e){if(!xx(e))return{};if(vd)return vd(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),$x=Sx;function Ix(r,e){return function(t){return r(e(t))}}var Dx=Ix,Ax=Dx,Px=Ax(Object.getPrototypeOf,Object),Yp=Px,Ox=Object.prototype;function Mx(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Ox;return r===t}var Xp=Mx,Cx=$x,Rx=Yp,Tx=Xp;function Nx(r){return typeof r.constructor=="function"&&!Tx(r)?Cx(Rx(r)):{}}var Fx=Nx;function qx(r){return r!=null&&typeof r=="object"}var nn=qx,Bx=ga,Lx=nn,jx="[object Arguments]";function Ux(r){return Lx(r)&&Bx(r)==jx}var zx=Ux,yd=zx,kx=nn,Zp=Object.prototype,Hx=Zp.hasOwnProperty,Kx=Zp.propertyIsEnumerable,Vx=yd(function(){return arguments}())?yd:function(r){return kx(r)&&Hx.call(r,"callee")&&!Kx.call(r,"callee")},Qp=Vx,Wx=Array.isArray,e0=Wx,Gx=9007199254740991;function Jx(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Gx}var t0=Jx,Yx=Hc,Xx=t0;function Zx(r){return r!=null&&Xx(r.length)&&!Yx(r)}var Wc=Zx,Qx=Wc,eS=nn;function tS(r){return eS(r)&&Qx(r)}var rS=tS,Jn={exports:{}};function iS(){return!1}var sS=iS;(function(r,e){var t=ts,i=sS,s=e&&!e.nodeType&&e,n=s&&!0&&r&&!r.nodeType&&r,a=n&&n.exports===s,o=a?t.Buffer:void 0,h=o?o.isBuffer:void 0,c=h||i;r.exports=c})(Jn,Jn.exports);var nS=ga,aS=Yp,oS=nn,cS="[object Object]",hS=Function.prototype,uS=Object.prototype,r0=hS.toString,fS=uS.hasOwnProperty,dS=r0.call(Object);function lS(r){if(!oS(r)||nS(r)!=cS)return!1;var e=aS(r);if(e===null)return!0;var t=fS.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&r0.call(t)==dS}var pS=lS,bS=ga,gS=t0,vS=nn,yS="[object Arguments]",mS="[object Array]",wS="[object Boolean]",_S="[object Date]",ES="[object Error]",xS="[object Function]",SS="[object Map]",$S="[object Number]",IS="[object Object]",DS="[object RegExp]",AS="[object Set]",PS="[object String]",OS="[object WeakMap]",MS="[object ArrayBuffer]",CS="[object DataView]",RS="[object Float32Array]",TS="[object Float64Array]",NS="[object Int8Array]",FS="[object Int16Array]",qS="[object Int32Array]",BS="[object Uint8Array]",LS="[object Uint8ClampedArray]",jS="[object Uint16Array]",US="[object Uint32Array]",Pe={};Pe[RS]=Pe[TS]=Pe[NS]=Pe[FS]=Pe[qS]=Pe[BS]=Pe[LS]=Pe[jS]=Pe[US]=!0,Pe[yS]=Pe[mS]=Pe[MS]=Pe[wS]=Pe[CS]=Pe[_S]=Pe[ES]=Pe[xS]=Pe[SS]=Pe[$S]=Pe[IS]=Pe[DS]=Pe[AS]=Pe[PS]=Pe[OS]=!1;function zS(r){return vS(r)&&gS(r.length)&&!!Pe[bS(r)]}var kS=zS;function HS(r){return function(e){return r(e)}}var KS=HS,pc={exports:{}};(function(r,e){var t=Hp,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n&&t.process,o=function(){try{var h=s&&s.require&&s.require("util").types;return h||a&&a.binding&&a.binding("util")}catch{}}();r.exports=o})(pc,pc.exports);var VS=kS,WS=KS,md=pc.exports,wd=md&&md.isTypedArray,GS=wd?WS(wd):VS,i0=GS;function JS(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var s0=JS,YS=Vc,XS=la,ZS=Object.prototype,QS=ZS.hasOwnProperty;function e$(r,e,t){var i=r[e];(!(QS.call(r,e)&&XS(i,t))||t===void 0&&!(e in r))&&YS(r,e,t)}var t$=e$,r$=t$,i$=Vc;function s$(r,e,t,i){var s=!t;t||(t={});for(var n=-1,a=e.length;++n<a;){var o=e[n],h=i?i(t[o],r[o],o,t,r):void 0;h===void 0&&(h=r[o]),s?i$(t,o,h):r$(t,o,h)}return t}var n$=s$;function a$(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var o$=a$,c$=9007199254740991,h$=/^(?:0|[1-9]\d*)$/;function u$(r,e){var t=typeof r;return e=e??c$,!!e&&(t=="number"||t!="symbol"&&h$.test(r))&&r>-1&&r%1==0&&r<e}var n0=u$,f$=o$,d$=Qp,l$=e0,p$=Jn.exports,b$=n0,g$=i0,v$=Object.prototype,y$=v$.hasOwnProperty;function m$(r,e){var t=l$(r),i=!t&&d$(r),s=!t&&!i&&p$(r),n=!t&&!i&&!s&&g$(r),a=t||i||s||n,o=a?f$(r.length,String):[],h=o.length;for(var c in r)(e||y$.call(r,c))&&!(a&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||b$(c,h)))&&o.push(c);return o}var w$=m$;function _$(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var E$=_$,x$=vi,S$=Xp,$$=E$,I$=Object.prototype,D$=I$.hasOwnProperty;function A$(r){if(!x$(r))return $$(r);var e=S$(r),t=[];for(var i in r)i=="constructor"&&(e||!D$.call(r,i))||t.push(i);return t}var P$=A$,O$=w$,M$=P$,C$=Wc;function R$(r){return C$(r)?O$(r,!0):M$(r)}var a0=R$,T$=n$,N$=a0;function F$(r){return T$(r,N$(r))}var q$=F$,_d=Jp,B$=lc.exports,L$=wx,j$=Ex,U$=Fx,Ed=Qp,xd=e0,z$=rS,k$=Jn.exports,H$=Hc,K$=vi,V$=pS,W$=i0,Sd=s0,G$=q$;function J$(r,e,t,i,s,n,a){var o=Sd(r,t),h=Sd(e,t),c=a.get(h);if(c){_d(r,t,c);return}var f=n?n(o,h,t+"",r,e,a):void 0,l=f===void 0;if(l){var v=xd(h),w=!v&&k$(h),m=!v&&!w&&W$(h);f=h,v||w||m?xd(o)?f=o:z$(o)?f=j$(o):w?(l=!1,f=B$(h,!0)):m?(l=!1,f=L$(h,!0)):f=[]:V$(h)||Ed(h)?(f=o,Ed(o)?f=G$(o):(!K$(o)||H$(o))&&(f=U$(h))):l=!1}l&&(a.set(h,f),s(f,h,i,n,a),a.delete(h)),_d(r,t,f)}var Y$=J$,X$=tx,Z$=Jp,Q$=dx,eI=Y$,tI=vi,rI=a0,iI=s0;function o0(r,e,t,i,s){r!==e&&Q$(e,function(n,a){if(s||(s=new X$),tI(n))eI(r,e,a,t,o0,i,s);else{var o=i?i(iI(r,a),n,a+"",r,e,s):void 0;o===void 0&&(o=n),Z$(r,a,o)}},rI)}var sI=o0;function nI(r){return r}var c0=nI;function aI(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var oI=aI,cI=oI,$d=Math.max;function hI(r,e,t){return e=$d(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,n=$d(i.length-e,0),a=Array(n);++s<n;)a[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(a),cI(r,this,o)}}var uI=hI;function fI(r){return function(){return r}}var dI=fI,lI=dI,Id=Gp,pI=c0,bI=Id?function(r,e){return Id(r,"toString",{configurable:!0,enumerable:!1,value:lI(e),writable:!0})}:pI,gI=bI,vI=800,yI=16,mI=Date.now;function wI(r){var e=0,t=0;return function(){var i=mI(),s=yI-(i-t);if(t=i,s>0){if(++e>=vI)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var _I=wI,EI=gI,xI=_I,SI=xI(EI),$I=SI,II=c0,DI=uI,AI=$I;function PI(r,e){return AI(DI(r,e,II),r+"")}var OI=PI,MI=la,CI=Wc,RI=n0,TI=vi;function NI(r,e,t){if(!TI(t))return!1;var i=typeof e;return(i=="number"?CI(t)&&RI(e,t.length):i=="string"&&e in t)?MI(t[e],r):!1}var FI=NI,qI=OI,BI=FI;function LI(r){return qI(function(e,t){var i=-1,s=t.length,n=s>1?t[s-1]:void 0,a=s>2?t[2]:void 0;for(n=r.length>3&&typeof n=="function"?(s--,n):void 0,a&&BI(t[0],t[1],a)&&(n=s<3?void 0:n,s=1),e=Object(e);++i<s;){var o=t[i];o&&r(e,o,i,n)}return e})}var jI=LI,UI=sI,zI=jI,kI=zI(function(r,e,t){UI(r,e,t)}),HI=kI,KI=Object.defineProperty,VI=Object.defineProperties,WI=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,GI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,Ad=(r,e,t)=>e in r?KI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,On=(r,e)=>{for(var t in e||(e={}))GI.call(e,t)&&Ad(r,t,e[t]);if(Dd)for(var t of Dd(e))JI.call(e,t)&&Ad(r,t,e[t]);return r},YI=(r,e)=>VI(r,WI(e));function Bt(r,e,t){var i;const s=Vi(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${kp}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function yi(r){return r.includes(":")?r.split(":")[1]:r}function h0(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function XI(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function Po(r={},e={}){const t=Pd(r),i=Pd(e);return HI(t,i)}function Pd(r){var e,t,i,s;const n={};if(!Hs(r))return n;for(const[a,o]of Object.entries(r)){const h=Bc(a)?[a]:o.chains,c=o.methods||[],f=o.events||[],l=o.rpcMap||{},v=Ts(a);n[v]=YI(On(On({},n[v]),o),{chains:Nn(h,(e=n[v])==null?void 0:e.chains),methods:Nn(c,(t=n[v])==null?void 0:t.methods),events:Nn(f,(i=n[v])==null?void 0:i.events),rpcMap:On(On({},l),(s=n[v])==null?void 0:s.rpcMap)})}return n}function ZI(r){return r.includes(":")?r.split(":")[2]:r}function Od(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],a=i.accounts||[],o=Bc(t)?[t]:i.chains?i.chains:h0(i.accounts);e[t]={chains:o,methods:s,events:n,accounts:a}}return e}function Oo(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const u0={},ue=r=>u0[r],Mo=(r,e)=>{u0[r]=e};var QI=Object.defineProperty,eD=(r,e,t)=>e in r?QI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Di=(r,e,t)=>eD(r,typeof e!="symbol"?e+"":e,t);class tD{constructor(e){Di(this,"name","polkadot"),Di(this,"client"),Di(this,"httpProviders"),Di(this,"events"),Di(this,"namespace"),Di(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yi(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var rD=Object.defineProperty,iD=Object.defineProperties,sD=Object.getOwnPropertyDescriptors,Md=Object.getOwnPropertySymbols,nD=Object.prototype.hasOwnProperty,aD=Object.prototype.propertyIsEnumerable,bc=(r,e,t)=>e in r?rD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cd=(r,e)=>{for(var t in e||(e={}))nD.call(e,t)&&bc(r,t,e[t]);if(Md)for(var t of Md(e))aD.call(e,t)&&bc(r,t,e[t]);return r},Rd=(r,e)=>iD(r,sD(e)),Ai=(r,e,t)=>bc(r,typeof e!="symbol"?e+"":e,t);class oD{constructor(e){Ai(this,"name","eip155"),Ai(this,"client"),Ai(this,"chainId"),Ai(this,"namespace"),Ai(this,"httpProviders"),Ai(this,"events"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Bt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(yi(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const n=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),o=((s=a==null?void 0:a.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[n])return o==null?void 0:o[n];const h=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Rd(Cd({},a.sessionProperties||{}),{capabilities:Rd(Cd({},o||{}),{[n]:h})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return h}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const o=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(o,e)}catch(h){console.warn("Failed to fetch call status from bundler",h,o)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Kr("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${o7}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var cD=Object.defineProperty,hD=(r,e,t)=>e in r?cD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pi=(r,e,t)=>hD(r,typeof e!="symbol"?e+"":e,t);class uD{constructor(e){Pi(this,"name","solana"),Pi(this,"client"),Pi(this,"httpProviders"),Pi(this,"events"),Pi(this,"namespace"),Pi(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yi(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var fD=Object.defineProperty,dD=(r,e,t)=>e in r?fD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oi=(r,e,t)=>dD(r,typeof e!="symbol"?e+"":e,t);class lD{constructor(e){Oi(this,"name","cosmos"),Oi(this,"client"),Oi(this,"httpProviders"),Oi(this,"events"),Oi(this,"namespace"),Oi(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yi(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var pD=Object.defineProperty,bD=(r,e,t)=>e in r?pD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mi=(r,e,t)=>bD(r,typeof e!="symbol"?e+"":e,t);class gD{constructor(e){Mi(this,"name","algorand"),Mi(this,"client"),Mi(this,"httpProviders"),Mi(this,"events"),Mi(this,"namespace"),Mi(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Bt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Jt(new nr(i,ue("disableProviderPing")))}}var vD=Object.defineProperty,yD=(r,e,t)=>e in r?vD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ci=(r,e,t)=>yD(r,typeof e!="symbol"?e+"":e,t);class mD{constructor(e){Ci(this,"name","cip34"),Ci(this,"client"),Ci(this,"httpProviders"),Ci(this,"events"),Ci(this,"namespace"),Ci(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=yi(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var wD=Object.defineProperty,_D=(r,e,t)=>e in r?wD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ri=(r,e,t)=>_D(r,typeof e!="symbol"?e+"":e,t);class ED{constructor(e){Ri(this,"name","elrond"),Ri(this,"client"),Ri(this,"httpProviders"),Ri(this,"events"),Ri(this,"namespace"),Ri(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yi(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var xD=Object.defineProperty,SD=(r,e,t)=>e in r?xD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ti=(r,e,t)=>SD(r,typeof e!="symbol"?e+"":e,t);class $D{constructor(e){Ti(this,"name","multiversx"),Ti(this,"client"),Ti(this,"httpProviders"),Ti(this,"events"),Ti(this,"namespace"),Ti(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yi(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var ID=Object.defineProperty,DD=(r,e,t)=>e in r?ID(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ni=(r,e,t)=>DD(r,typeof e!="symbol"?e+"":e,t);class AD{constructor(e){Ni(this,"name","near"),Ni(this,"client"),Ni(this,"httpProviders"),Ni(this,"events"),Ni(this,"namespace"),Ni(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Bt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace);return typeof i>"u"?void 0:new Jt(new nr(i,ue("disableProviderPing")))}}var PD=Object.defineProperty,OD=(r,e,t)=>e in r?PD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fi=(r,e,t)=>OD(r,typeof e!="symbol"?e+"":e,t);class MD{constructor(e){Fi(this,"name","tezos"),Fi(this,"client"),Fi(this,"httpProviders"),Fi(this,"events"),Fi(this,"namespace"),Fi(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Bt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace);return typeof i>"u"?void 0:new Jt(new nr(i))}}var CD=Object.defineProperty,RD=(r,e,t)=>e in r?CD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qi=(r,e,t)=>RD(r,typeof e!="symbol"?e+"":e,t);class TD{constructor(e){qi(this,"name",Li),qi(this,"client"),qi(this,"httpProviders"),qi(this,"events"),qi(this,"namespace"),qi(this,"chainId"),this.namespace=e.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Yt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=Vi(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Bt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jt(new nr(i,ue("disableProviderPing")))}}var ND=Object.defineProperty,FD=Object.defineProperties,qD=Object.getOwnPropertyDescriptors,Td=Object.getOwnPropertySymbols,BD=Object.prototype.hasOwnProperty,LD=Object.prototype.propertyIsEnumerable,gc=(r,e,t)=>e in r?ND(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mn=(r,e)=>{for(var t in e||(e={}))BD.call(e,t)&&gc(r,t,e[t]);if(Td)for(var t of Td(e))LD.call(e,t)&&gc(r,t,e[t]);return r},Co=(r,e)=>FD(r,qD(e)),ir=(r,e,t)=>gc(r,typeof e!="symbol"?e+"":e,t);class Gc{constructor(e){ir(this,"client"),ir(this,"namespaces"),ir(this,"optionalNamespaces"),ir(this,"sessionProperties"),ir(this,"events",new _c),ir(this,"rpcProviders",{}),ir(this,"session"),ir(this,"providerOpts"),ir(this,"logger"),ir(this,"uri"),ir(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:tn(oa({level:(e==null?void 0:e.logger)||od})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Gc(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Mn({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(a=>t(null,ca(n,a))).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ve("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const a=Od(this.session.namespaces);this.namespaces=Po(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Od(s.namespaces);return this.namespaces=Po(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===Li?n.setDefaultChain(`${i}:${s}`,t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(mr(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await G9.init({core:this.providerOpts.core,logger:this.providerOpts.logger||od,relayUrl:this.providerOpts.relayUrl||s7,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>Ts(t)))];Mo("client",this.client),Mo("events",this.events),Mo("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=XI(t,this.session),s=h0(i),n=Po(this.namespaces,this.optionalNamespaces),a=Co(Mn({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new oD({namespace:a});break;case"algorand":this.rpcProviders[t]=new gD({namespace:a});break;case"solana":this.rpcProviders[t]=new uD({namespace:a});break;case"cosmos":this.rpcProviders[t]=new lD({namespace:a});break;case"polkadot":this.rpcProviders[t]=new tD({namespace:a});break;case"cip34":this.rpcProviders[t]=new mD({namespace:a});break;case"elrond":this.rpcProviders[t]=new ED({namespace:a});break;case"multiversx":this.rpcProviders[t]=new $D({namespace:a});break;case"near":this.rpcProviders[t]=new AD({namespace:a});break;case"tezos":this.rpcProviders[t]=new MD({namespace:a});break;default:this.rpcProviders[Li]?this.rpcProviders[Li].updateNamespace(a):this.rpcProviders[Li]=new TD({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if(i.name==="accountsChanged"){const s=i.data;s&&mr(s)&&this.events.emit("accountsChanged",s.map(ZI))}else if(i.name==="chainChanged"){const s=t.chainId,n=t.event.data,a=Ts(s),o=Oo(s)!==Oo(n)?`${a}:${Oo(n)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,n=(i=this.client)==null?void 0:i.session.get(e);this.session=Co(Mn({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Co(Mn({},ve("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Yt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Li]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>Ts(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=Ts(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${cd}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${cd}/${e}`)}}const jD=Gc,UD="wc",zD="ethereum_provider",kD=`${UD}@2:${zD}:`,HD="https://rpc.walletconnect.org/v1/",vc=["eth_sendTransaction","personal_sign"],KD=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],yc=["chainChanged","accountsChanged"],VD=["chainChanged","accountsChanged","message","disconnect","connect"];var WD=Object.defineProperty,GD=Object.defineProperties,JD=Object.getOwnPropertyDescriptors,Nd=Object.getOwnPropertySymbols,YD=Object.prototype.hasOwnProperty,XD=Object.prototype.propertyIsEnumerable,mc=(r,e,t)=>e in r?WD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hi=(r,e)=>{for(var t in e||(e={}))YD.call(e,t)&&mc(r,t,e[t]);if(Nd)for(var t of Nd(e))XD.call(e,t)&&mc(r,t,e[t]);return r},Ro=(r,e)=>GD(r,JD(e)),Tt=(r,e,t)=>mc(r,typeof e!="symbol"?e+"":e,t);function Yn(r){return Number(r[0].split(":")[1])}function Cn(r){return`0x${r.toString(16)}`}function ZD(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:n,optionalEvents:a,rpcMap:o}=r;if(!mr(e))throw new Error("Invalid chains");const h={chains:e,methods:i||vc,events:n||yc,rpcMap:Hi({},e.length?{[Yn(e)]:o[Yn(e)]}:{})},c=n==null?void 0:n.filter(w=>!yc.includes(w)),f=i==null?void 0:i.filter(w=>!vc.includes(w));if(!t&&!a&&!s&&!(c!=null&&c.length)&&!(f!=null&&f.length))return{required:e.length?h:void 0};const l=(c==null?void 0:c.length)&&(f==null?void 0:f.length)||!t,v={chains:[...new Set(l?h.chains.concat(t||[]):t)],methods:[...new Set(h.methods.concat(s!=null&&s.length?s:KD))],events:[...new Set(h.events.concat(a!=null&&a.length?a:VD))],rpcMap:o};return{required:e.length?h:void 0,optional:t.length?v:void 0}}class Jc{constructor(){Tt(this,"events",new Lt.EventEmitter),Tt(this,"namespace","eip155"),Tt(this,"accounts",[]),Tt(this,"signer"),Tt(this,"chainId",1),Tt(this,"modal"),Tt(this,"rpc"),Tt(this,"STORAGE_KEY",kD),Tt(this,"on",(e,t)=>(this.events.on(e,t),this)),Tt(this,"once",(e,t)=>(this.events.once(e,t),this)),Tt(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Tt(this,"off",(e,t)=>(this.events.off(e,t),this)),Tt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Jc;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:i}=ZD(this.rpc);try{const s=await new Promise(async(a,o)=>{var h;this.rpc.showQrModal&&((h=this.modal)==null||h.subscribeModal(c=>{!c.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),o(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Ro(Hi({namespaces:Hi({},t&&{[this.namespace]:t})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(c=>{a(c)}).catch(c=>{o(new Error(c.message))})});if(!s)return;const n=Su(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Cn(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async authenticate(e,t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(n,a)=>{var o;this.rpc.showQrModal&&((o=this.modal)==null||o.subscribeModal(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Ro(Hi({},e),{chains:this.rpc.chains}),t).then(h=>{n(h)}).catch(h=>{a(new Error(h.message))})}),s=i.session;if(s){const n=Su(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Cn(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Cn(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ro(Hi({},ve("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,i;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Cn(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=(t=e==null?void 0:e.chains)!=null?t:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],a=s.concat(n);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const o=s.length?(e==null?void 0:e.methods)||vc:[],h=s.length?(e==null?void 0:e.events)||yc:[],c=(e==null?void 0:e.optionalMethods)||[],f=(e==null?void 0:e.optionalEvents)||[],l=(e==null?void 0:e.rpcMap)||this.buildRpcMap(a,e.projectId),v=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(w=>this.formatChainId(w)),optionalChains:n.map(w=>this.formatChainId(w)),methods:o,events:h,optionalMethods:c,optionalEvents:f,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:v,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Yn(this.rpc.chains):Yn(this.rpc.optionalChains),this.signer=await jD.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:i}=await Fd(()=>import("./index-C889p4e7.js").then(s=>s.i),__vite__mapDeps([3,1,2]),import.meta.url);t=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Hi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&mr(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&mr(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${HD}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const bP=Jc;export{bP as EthereumProvider,VD as OPTIONAL_EVENTS,KD as OPTIONAL_METHODS,yc as REQUIRED_EVENTS,vc as REQUIRED_METHODS,Jc as default};
